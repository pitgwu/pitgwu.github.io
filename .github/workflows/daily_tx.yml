name: æ¯æ—¥å°è‚¡ç›¤å¾Œè³‡æ–™æ›´æ–°

# è¨­å®šè§¸ç™¼æ¢ä»¶
on:
  schedule:
    # èªªæ˜:
    # åˆ†é˜: 0, å°æ™‚: 6 (UTC) = å°ç£ 14:00
    # é€±ä¸€åˆ°é€±äº”
    - cron: '0 6 * * 1-5'
  # å…è¨±æ‰‹å‹•å¾ Actions é é¢è§¸ç™¼
  workflow_dispatch:
  
# âš ï¸ é‡è¦ï¼šè¨­å®šæ¬Šé™ï¼Œå…è¨± Actions å¯«å…¥ Repo
permissions:
  contents: write

jobs:
  update-data:
    runs-on: ubuntu-latest

    steps:
      # 1. ä¸‹è¼‰ç¨‹å¼ç¢¼
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
          cache: 'pip'

      # 3. å®‰è£ä¾è³´
      - name: Install dependencies
        run: |
          # é€™è£¡åŠ ä¸Š pandas requests ç¢ºä¿åŸºæœ¬ä¾è³´å­˜åœ¨ï¼Œé¿å… requirements.txt éºå¤±å°è‡´éŒ¯èª¤
          pip install pandas requests
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # 4. åŸ·è¡Œ Python è…³æœ¬
      - name: Run script
        run: python fetch_txf_5m_daily.py
      
      # 5-8. æäº¤èˆ‡æ¨é€ (é€™å°±æ˜¯åŸæœ¬å ±éŒ¯çš„åœ°æ–¹ï¼Œç¾åœ¨ä¿®å¾©äº†)
      - name: Commit and Push
        run: |
          # è¨­å®š Git ä½¿ç”¨è€…
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # åŠ å…¥æª”æ¡ˆ (æ³¨æ„ï¼šè«‹ç¢ºèªä½ çš„ python è…³æœ¬ç”Ÿæˆçš„æª”æ¡ˆè·¯å¾‘çœŸçš„æ˜¯é€™è£¡)
          git add stock_train/data_txf_5m_daily/txf_5m_daily.csv
          
          # æäº¤ (ä½¿ç”¨ %F ç°¡åŒ–æ—¥æœŸæ ¼å¼)
          git commit -m "ğŸ“ˆ Auto update TX data: $(date +%F)" || exit 0
          
          # æ¨é€
          git push
