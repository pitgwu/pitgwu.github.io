const olafQuotes = {
    bullish: [
        "é€™æ³¢æ¼²å‹¢å°±åƒå¤å¤©ä¸€æ¨£æº«æš–ï¼â˜€ï¸",
        "æœ‰äº›äººå€¼å¾—ç‚ºä»–èåŒ–ï¼Œé€™æª”è‚¡ç¥¨å€¼å¾—ç‚ºå®ƒé€²å ´ï¼â›„",
        "æˆ‘çœ‹è¦‹äº†é™½å…‰ã€å¤å¤©ï¼Œé‚„æœ‰ä¸Šæ¼²çš„ç›®æ¨™åƒ¹ï¼",
        "å˜¿ï¼Œçœ‹é‚£æ ¹ K ç·šï¼Œå®ƒåœ¨å°æˆ‘ç¬‘è€¶ï¼",
        "æˆ‘å€‘è¦å¾€ä¸Šå‡äº†ï¼Œå°±åƒè¢«é¢¨å¹æ•£çš„é›ªèŠ±ï½â„ï¸"
    ],
    bearish: [
        "å–”ä¸ï¼Œé€™æª”è‚¡ç¥¨éœ€è¦ä¸€å€‹æº«æš–çš„æŠ±æŠ±ï¼ˆæ­¢è·Œï¼‰ã€‚",
        "æˆ‘çš„è…¦è¢‹æ‰ä¸‹å»äº†ï¼å°±åƒé€™æ³¢è·Œå‹¢ä¸€æ¨£å¿«ã€‚ğŸ¥•",
        "é€™è£¡æ„Ÿè¦ºå†·å†°å†°çš„ï¼Œæˆ‘å€‘å…ˆèº²é€²å†°å ¡é¿é›£å§ã€‚",
        "è­¦æƒ•ï¼é€™çœ‹èµ·ä¾†åƒæ˜¯ä¸€å€‹æœƒè®“äººèåŒ–çš„é™·é˜±ã€‚",
        "çœ‹ä¾†æˆ‘å€‘éœ€è¦ä¸€é»é­”æ³•æ‰èƒ½è®“å®ƒåœä¸‹ä¾†ã€‚âœ¨"
    ],
    neutral: [
        "å®ƒåœ¨é‚£è£¡èµ°ä¾†èµ°å»ï¼Œå°±åƒæˆ‘åœ¨æ‰¾æˆ‘çš„é¼»å­ä¸€æ¨£ã€‚",
        "æˆ‘å€‘å°±éœéœåœ°çœ‹è‘—ï¼Œç›´åˆ°å®ƒæ±ºå®šè¦è®Šæˆä»€éº¼æ¨£å­ã€‚",
        "é€™æ˜¯åœ¨åšé›ªçƒå—ï¼Ÿæ»¾ä¾†æ»¾å»çš„ã€‚âšª",
        "è€å¿ƒç­‰å¾…ï¼Œé©šå–œç¸½æ˜¯åœ¨å†°é›ªæ¶ˆèå¾Œå‡ºç¾ï¼",
        "æˆ‘å–œæ­¡é€™å¹³éœçš„æ„Ÿè¦ºï¼Œé›–ç„¶æˆ‘æ›´å–œæ­¡å¤å¤©ã€‚"
    ]
};

// ==========================================
// 1. å‹æ…‹åˆ†é¡ç´¢å¼• (Category Index)
// ==========================================
const categoryIndex = {
    // ğŸ‚ çœ‹æ¼²å‹æ…‹ (13å€‹)
    bullish: [
        'vBottom', 'nBottom', 'hsBottom', 'complexHsBottom', 'doubleBottom', 
        'fryPanBottom', 'roundingBottom', 'ascRightTriBottom', 'descWedge', 
        'broadeningBottom', 'downBroadening', 'oneBarBottom', 'diamondBottom'
    ],
    // âš–ï¸ æ•´ç†å‹æ…‹ (17å€‹)
    neutral: [
        'box', 'descTriPrevDrop', 'descRightTri', 'ascTriPrevRise', 'ascRightTri',
        // å¿«è·Œ (Bearish Continuation)
        'bearFlagUp', 'bearFlagFlat', 'bearFlagDown', 
        'bearPennantUp', 'bearPennantFlat', 'bearPennantDown',
        // å¿«æ¼² (Bullish Continuation)
        'bullFlagUp', 'bullFlagFlat', 'bullFlagDown', 
        'bullPennantUp', 'bullPennantFlat', 'bullPennantDown'
    ],
    // ğŸ» ä¸‹è·Œå‹æ…‹ (10å€‹)
    bearish: [
        'vTop', 'nTop', 'hsTop', 'complexHsTop', 'doubleTop', 
        'roundingTop', 'ascRightTriTop', 'ascWedge', 'broadeningTop', 'diamondTop'
    ]
};

// ==========================================
// 2. å®Œæ•´å‹æ…‹è³‡æ–™åº« (Patterns Database)
// ==========================================
const patternsDB = {
    // ------------------------------------------
    // A. çœ‹æ¼²å‹æ…‹ (Bullish)
    // ------------------------------------------
    vBottom: {
        name: "1. Vå‹åº• (V-Bottom) - æ…£æ€§æ‰­è½‰",
        type: "bull",
        inputs: [
            { id: "neckline", label: "é ¸ç·š/èµ·è·Œé» (ç¶ ç·š)", default: 100 },
            { id: "low", label: "æœ€ä½é» (Vå°–)", default: 70 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹å‡ºç¾<strong>ã€Œæ€¥è·Œã€</strong>é é›¢ä¹–é›¢ï¼Œéš¨å¾Œåœ¨ä½æª”å‡ºç¾<strong>ã€Œçˆ†é‡ã€</strong>æ›æ‰‹ï¼Œä¸¦ä»¥åŒæ¨£é€Ÿåº¦<strong>ã€Œæ€¥æ¼²ã€</strong>å›åˆ°èµ·è·Œé»(é ¸ç·š)ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­ç‰¹åˆ¥æ¨™è¨»<strong>ã€Œæ€¥è·ŒåŠä½æª”çˆ†é‡ã€</strong>ã€‚Vå‹åè½‰é€Ÿåº¦æ¥µå¿«ï¼Œé€šå¸¸æ²’æœ‰æ˜é¡¯ç¯‰åº•éç¨‹ï¼Œä¾è³´ç±Œç¢¼çš„åŠ‡çƒˆæ›æ‰‹ä¾†æ‰­è½‰æ…£æ€§ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. æ¿€é€²ï¼šä½æª”çˆ†é‡æ”¶é•·ä¸‹å½±ç·šæ™‚ã€‚<br>
            2. ç©©å¥ï¼š<strong>çªç ´é ¸ç·š(ç¶ ç·š)ä¸¦å›æ¸¬ä¸ç ´æ™‚</strong> (åœ–ä¸­å³å´Nå­—è½‰æŠ˜è™•)ã€‚<br>
            3. æ¸¬å¹…ï¼šé ¸ç·šè‡³æœ€ä½é»çš„å‚ç›´è·é›¢ï¼Œå¾é ¸ç·šå‘ä¸Šç­‰å¹…æŠ•å°„ã€‚
        `,
        calc: (v) => {
            const h = v.neckline - v.low; // Vçš„æ·±åº¦
            const target = v.neckline + h;
            
            return {
                entry: v.neckline, 
                target: target, 
                stop: v.low,
                
                // èµ°å‹¢å„ªåŒ–ï¼šæ¨¡æ“¬ "æ€¥è·Œ -> Våº• -> æ€¥æ¼² -> çªç ´ -> å›æ¸¬ -> å™´å‡º"
                // æ¸›å°‘ä¸­é–“çš„ç›¤æ•´é»ï¼Œè®“ç·šæ¢çœ‹èµ·ä¾†æ›´é™¡å³­ (Sharp)
                points: [
                    v.neckline + h*0.5, // T0: èµ·å§‹é«˜é»
                    v.neckline,         // T1: è·Œç ´é ¸ç·š
                    v.neckline - h*0.6, // T2: æ€¥è·Œä¸­
                    v.low,              // T3: Våº• (ä½æª”çˆ†é‡å€)
                    v.neckline - h*0.4, // T4: æ€¥æ¼²ä¸­
                    v.neckline,         // T5: ä¾†åˆ°é ¸ç·š
                    v.neckline + h*0.2, // T6: çªç ´è¡é«˜
                    v.neckline,         // T7: å›æ¸¬é ¸ç·š (ç¢ºèªæ”¯æ’)
                    target              // T8: æŠµé”ç›®æ¨™
                ],
                
                trendlines: [
                    // 1. ç¶ è‰²é ¸ç·š (å£“åŠ›è½‰æ”¯æ’)
                    { 
                        x1: 0, x2: 8, 
                        y1: v.neckline, y2: v.neckline, 
                        color: '#2ecc71', // åœ–ç‰‡ä¸­çš„äº®ç¶ è‰²
                        label: 'é ¸ç·š (å£“åŠ›è½‰æ”¯æ’)' 
                    },
                    
                    // 2. è—è‰²æ¸¬å¹…è™›ç·š (å‘ä¸‹æ¸¬é‡æ·±åº¦)
                    { 
                        x1: 3, x2: 3, 
                        y1: v.neckline, y2: v.low, 
                        color: '#3498db', 
                        dashed: true, 
                        label: 'è·Œå¹…H' 
                    },
                    
                     // 3. è—è‰²æ¸¬å¹…è™›ç·š (å‘ä¸ŠæŠ•å°„ç›®æ¨™)
                     { 
                        x1: 8, x2: 8, 
                        y1: v.neckline, y2: target, 
                        color: '#3498db', 
                        dashed: true, 
                        label: 'ç­‰å¹…H' 
                    }
                ],
                
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 5, // å°æ‡‰ T5 (å‰›å¥½ç¢°åˆ°é ¸ç·šçªç ´)
                        yValue: v.neckline,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    nBottom: {
        name: "2. Nå­—åº• (N-Shaped Bottom) - ç­‰å¹…æ”»æ“Š",
        type: "bull",
        inputs: [
            { id: "h1", label: "ç¬¬ä¸€æ³¢é«˜é» (é ¸ç·š)", default: 30 },
            { id: "l1", label: "ç¬¬ä¸€æ³¢ä½é» (èµ·æ¼²)", default: 20 },
            { id: "l2", label: "å›æª”æ”¯æ’ (å»ºè­°1/2è™•)", default: 25 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹å‘ˆã€ŒNã€å­—å‹æ”»æ“Šã€‚é‡é»åœ¨æ–¼ç¬¬ä¸€æ³¢ä¸Šæ¼²å¾Œï¼Œ<strong>å›æª”ä¿®æ­£ä¸ç ´å‰ä½</strong>ï¼Œä¸”é€šå¸¸æœƒåœ¨æ¼²å¹…çš„ <strong>1/2 (50%)</strong> è™•ç²å¾—æ”¯æ’(ç´«è‰²ç·š)ï¼Œéš¨å¾Œå†æ¬¡è½‰å¼·ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­è—è‰²ç®­é ­å±•ç¤ºäº†<strong>ã€Œç­‰å¹…æ¸¬é‡ã€</strong>åŸå‰‡ï¼šç¬¬äºŒæ³¢æ¼²å¹…(ç›®æ¨™)é€šå¸¸ç­‰æ–¼ç¬¬ä¸€æ³¢æ¼²å¹…ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. ä½ˆå±€é»ï¼šå›æª”è‡³ 1/2 ä½ç½®å‡ºç¾æ­¢è·Œè¨Šè™Ÿæ™‚ã€‚<br>
            2. åŠ ç¢¼é»ï¼š<strong>çªç ´å‰æ³¢é«˜é»(è—é»è™•)</strong> æ™‚ã€‚<br>
            3. ç›®æ¨™åƒ¹ï¼šå›æª”ä½é» + ç¬¬ä¸€æ³¢æ¼²å¹…ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—ç¬¬ä¸€æ³¢æ¼²å¹…é«˜åº¦ (Amplitude)
            const amp = v.h1 - v.l1;
            // è¨ˆç®—ç›®æ¨™åƒ¹ (Target) = å›æª”é» + ç¬¬ä¸€æ³¢æ¼²å¹…
            const target = v.l2 + amp;
            
            // è¨ˆç®— 1/2 ä½ç½® (ç”¨æ–¼ç•«ç´«è‰²ç·š)
            const halfLevel = v.l1 + amp * 0.5;
            
            return {
                entry: v.h1, 
                target: target, 
                stop: v.l2,
                
                // èµ°å‹¢å„ªåŒ–ï¼šæ¨¡æ“¬ N å­—æ³¢å‹•
                // T0: èµ·æ¼² -> T1: é«˜é» -> T2: å›æª”(1/2) -> T3: çªç ´ -> T4: é”æ¨™
                points: [
                    v.l1,             // T0: èµ·æ¼² L1
                    v.h1,             // T1: é«˜é» H1
                    v.l2,             // T2: å›æª” L2 (ç†æƒ³ç‹€æ…‹ä¸‹æ¥è¿‘ halfLevel)
                    v.h1,             // T3: æŒ‘æˆ°é ¸ç·š
                    v.h1 + (target - v.h1) * 0.2, // T4: çªç ´ (è—é»ä½ç½®)
                    target            // T5: æŠµé”ç­‰å¹…ç›®æ¨™
                ],
                
                trendlines: [
                    // 1. ç¶ è‰²åˆ‡ç·šç¾¤
                    { x1: 0, x2: 2, y1: v.l1, y2: v.l1, color: '#2ecc71', label: 'åº•éƒ¨èµ·æ¼²' },
                    { x1: 0, x2: 5, y1: v.h1, y2: v.h1, color: '#2ecc71', label: 'é ¸ç·šå£“åŠ›' },
                    
                    // å›æª”æ”¯æ’ç·š (ç¶ è‰²) - ç©¿é T2
                    { x1: 1, x2: 4, y1: v.l2, y2: v.l2, color: '#2ecc71', label: 'å›æª”æ”¯æ’' },
                    
                    // ç›®æ¨™åƒ¹ç·š (ç¶ è‰²)
                    { x1: 4, x2: 5, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // 2. ç´«è‰² 1/2 æ”¯æ’ç·š
                    // æ¨™ç¤ºå‡ºå¹¾ä½•ä¸Šçš„ 50% ä½ç½®ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…æ¯”å°å›æª”æ·±åº¦
                    { 
                        x1: 1.5, x2: 2.5, 
                        y1: halfLevel, y2: halfLevel, 
                        color: '#9b59b6', 
                        label: '1/2 é—œå¡' 
                    },

                    // 3. è—è‰²ç­‰å¹…æ¸¬é‡è™›ç·š (æ¨¡æ“¬ç®­é ­)
                    // ç¬¬ä¸€æ³¢é«˜åº¦ (å·¦å´)
                    { x1: 0.5, x2: 0.5, y1: v.l1, y2: v.h1, color: '#3498db', dashed: true, label: 'æ¼²å¹…H' },
                    // ç¬¬äºŒæ³¢é«˜åº¦ (å³å´æŠ•å½±)
                    { x1: 3.5, x2: 3.5, y1: v.l2, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 3.2, // å‰›å¥½çªç ´é ¸ç·šçš„ä½ç½®
                        yValue: v.h1,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    hsBottom: {
        name: "3. é ­è‚©åº• (Head & Shoulders Bottom) - åº•éƒ¨åè½‰",
        type: "bull",
        inputs: [
            { id: "neck", label: "é ¸ç·šå£“åŠ›", default: 100 },
            { id: "head", label: "é ­éƒ¨æœ€ä½é»", default: 80 },
            { id: "shoulder", label: "è‚©éƒ¨ä½é» (å»ºè­°1/2è™•)", default: 90 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>ç”±å·¦è‚©ã€é ­éƒ¨ã€å³è‚©çµ„æˆã€‚ç‰¹å¾µæ˜¯ä¸­é–“é ­éƒ¨æœ€ä½ï¼Œå·¦å³å…©è‚©ä½é»å¤§è‡´å°ç¨±(åœ–ä¸­ç´«è‰²ç·š)ï¼Œä¸”æ·±åº¦ç´„ç‚ºé ­éƒ¨çš„ <strong>1/2</strong>ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­è—é»ç‚ºçªç ´é—œéµã€‚å³å´ç´…ç·šé¡¯ç¤ºï¼Œçªç ´é ¸ç·šå¾Œå¸¸æœ‰<strong>ã€Œå›æ¸¬ã€</strong>å‹•ä½œï¼Œç¢ºèªé ¸ç·šç”±å£“åŠ›è½‰ç‚ºæ”¯æ’å¾Œï¼Œæ‰é–‹å•Ÿä¸»å‡æ®µã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. æ½›ä¼é»ï¼šå³è‚©å›æª”è‡³å·¦è‚©å°ç¨±åƒ¹ä½(ç´«è‰²ç·š)æ­¢è·Œæ™‚ã€‚<br>
            2. è²·é»ï¼šå¸¶é‡çªç ´é ¸ç·š(è—é»è™•)æ™‚ã€‚<br>
            3. æ¸¬å¹…ï¼šæ¡ã€Œå‚ç›´ç­‰å¹…ã€æ¸¬é‡ã€‚ç›®æ¨™åƒ¹ = é ¸ç·š + (é ¸ç·š - é ­éƒ¨æœ€ä½é»)ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—é ­éƒ¨æ·±åº¦ (H)
            const h = v.neck - v.head;
            const target = v.neck + h;
            
            return {
                entry: v.neck, 
                target: target, 
                stop: v.shoulder,
                
                // èµ°å‹¢å„ªåŒ–ï¼šå·¦è‚© -> é ¸ç·š -> é ­ -> é ¸ç·š -> å³è‚© -> çªç ´ -> å›æ¸¬ -> ç›®æ¨™
                // T0: èµ·å§‹
                // T1: å·¦è‚©ä½
                // T2: é ¸ç·š
                // T3: é ­éƒ¨ä½
                // T4: é ¸ç·š
                // T5: å³è‚©ä½ (å°ç¨±å·¦è‚©)
                // T6: æŒ‘æˆ°é ¸ç·š
                // T7: çªç ´ (è—é»)
                // T8: å›æ¸¬
                // T9: é”æ¨™
                points: [
                    v.neck,             // T0
                    v.shoulder,         // T1 (å·¦è‚©)
                    v.neck,             // T2
                    v.head,             // T3 (é ­)
                    v.neck,             // T4
                    v.shoulder,         // T5 (å³è‚©)
                    v.neck,             // T6
                    v.neck + h * 0.2,   // T7 (çªç ´)
                    v.neck + h * 0.05,  // T8 (å›æ¸¬é ¸ç·š)
                    target              // T9
                ],
                
                trendlines: [
                    // 1. ä¸‰æ¢ç¶ è‰²æ°´å¹³ç·š
                    { x1: 3, x2: 3, y1: v.head, y2: v.head, color: '#2ecc71', label: 'åº•éƒ¨' },
                    { x1: 0, x2: 9, y1: v.neck, y2: v.neck, color: '#2ecc71', label: 'é ¸ç·š' },
                    { x1: 8, x2: 9, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // 2. ç´«è‰²è‚©éƒ¨å°ç¨±ç·š (1/2)
                    // é€£æ¥å·¦è‚©èˆ‡å³è‚©
                    { x1: 1, x2: 5, y1: v.shoulder, y2: v.shoulder, color: '#9b59b6', label: 'è‚©éƒ¨æ”¯æ’ (1/2)' },

                    // 3. è—è‰²ç­‰å¹…æ¸¬è·è™›ç·š
                    // æ¸¬é‡é ­éƒ¨æ·±åº¦ (å·¦å´)
                    { x1: 3.5, x2: 3.5, y1: v.head, y2: v.neck, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    // æŠ•å°„æ¼²å¹… (å³å´)
                    { x1: 6.5, x2: 6.5, y1: v.neck, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 6.2, // å‰›å¥½çªç ´é ¸ç·šçš„ä½ç½® (T6-T7ä¹‹é–“)
                        yValue: v.neck,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    complexHsBottom: {
        name: "4. è¤‡å¼é ­è‚©åº• (Complex H&S Bottom) - ç›¤æ•´è“„åŠ›",
        type: "bull",
        inputs: [
            { id: "neck", label: "é ¸ç·š (ç®±é ‚å£“åŠ›)", default: 100 },
            { id: "head", label: "é ­éƒ¨æœ€ä½é»", default: 75 },
            { id: "shoulder", label: "è‚©éƒ¨æ”¯æ’ (ç®±åº•/ç´«è‰²ç·š)", default: 88 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>é€™æ˜¯æ¨™æº–é ­è‚©åº•çš„è®Šå½¢èˆ‡å¢å¼·ç‰ˆã€‚ç‰¹å¾µåœ¨æ–¼å·¦å³è‚©éƒ¨ä¸æ˜¯å–®ä¸€ä½é»ï¼Œè€Œæ˜¯å‡ºç¾<strong>ã€ŒKç·šæ©«ç›¤ã€</strong>èˆ‡<strong>ã€Œå¯†é›†ç›¤æ•´å€ã€</strong>ã€‚é€™ä»£è¡¨ä¸»åŠ›åœ¨è‚©è†€ä½ç½®èŠ±æ›´å¤šæ™‚é–“å¸ç±Œã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­ç´«è‰²ç·šæ¨™ç¤º <strong>"1/2"</strong>ï¼Œé¡¯ç¤ºå·¦å³è‚©çš„ç®±åº•æ”¯æ’å…·æœ‰é«˜åº¦å°ç¨±æ€§ã€‚è‚©éƒ¨æ•´ç†è¶Šä¹…ï¼Œçªç ´å¾Œçš„çˆ†ç™¼åŠ›è¶Šå¼·ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è§€å¯Ÿï¼šå³è‚©é€²å…¥æ©«ç›¤æ•´ç†æ™‚ï¼Œé—œæ³¨ç®±åº•(ç´«è‰²ç·š)çš„æ”¯æ’åŠ›é“ã€‚<br>
            2. è²·é»ï¼šå¸¶é‡çªç ´é ¸ç·š(è—é»)æ™‚ã€‚<br>
            3. æ¸¬å¹…ï¼šé ¸ç·š + (é ¸ç·š - é ­éƒ¨æœ€ä½é»)ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—é ­éƒ¨æ·±åº¦ (H)
            const h = v.neck - v.head;
            const target = v.neck + h;
            
            return {
                entry: v.neck, 
                target: target, 
                stop: v.shoulder,
                
                // èµ°å‹¢å„ªåŒ–ï¼šæ¨¡æ“¬ "ç®±å‹å·¦è‚© -> æ·±Vé ­éƒ¨ -> ç®±å‹å³è‚© -> çªç ´"
                // å¢åŠ é»ä½ä¾†å‘ˆç¾ "æ©«ç›¤" (neutral) çš„æ„Ÿè¦º
                points: [
                    v.neck + 5,         // T0: èµ·å§‹
                    v.neck,             // T1: é€²å…¥å·¦è‚©
                    v.shoulder,         // T2: å·¦è‚©ç®±åº• (â˜…è¸©ç´«ç·š)
                    (v.neck+v.shoulder)/2, // T3: å·¦è‚©éœ‡ç›ª
                    v.neck,             // T4: å·¦è‚©ç®±é ‚ (â˜…é ‚ç¶ ç·š)
                    v.head,             // T5: é ­éƒ¨æœ€ä½ (æ·±è·Œ)
                    v.neck,             // T6: åå½ˆè‡³é ¸ç·š
                    (v.neck+v.shoulder)/2, // T7: å³è‚©éœ‡ç›ª
                    v.shoulder,         // T8: å³è‚©ç®±åº• (â˜…è¸©ç´«ç·š - 1/2è™•)
                    v.neck - 2,         // T9: å³è‚©ç›¤æ•´
                    v.neck,             // T10: æº–å‚™çªç ´
                    v.neck + h * 0.2,   // T11: çªç ´ (è—é»)
                    target              // T12: é”æ¨™
                ],
                
                trendlines: [
                    // 1. ç¶ è‰²é ¸ç·š (å£“åŠ›)
                    // å»¶ä¼¸è¦†è“‹æ•´å€‹å½¢æ…‹
                    { x1: 1, x2: 11, y1: v.neck, y2: v.neck, color: '#2ecc71', label: 'é ¸ç·šå£“åŠ›' },
                    
                    // 2. ç¶ è‰²é ­éƒ¨åº•ç·š & ç›®æ¨™ç·š
                    { x1: 5, x2: 5, y1: v.head, y2: v.head, color: '#2ecc71', label: 'é ­éƒ¨' },
                    { x1: 11, x2: 12, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // 3. ç´«è‰²è‚©éƒ¨é€£ç·š (1/2 æ”¯æ’)
                    // é€£æ¥å·¦è‚©ç®±åº• (T2) èˆ‡å³è‚©ç®±åº• (T8)
                    { x1: 2, x2: 8, y1: v.shoulder, y2: v.shoulder, color: '#9b59b6', label: 'è‚©éƒ¨ç®±åº• (1/2)' },
                    
                    // 4. æ–‡å­—æ¨™ç¤º (æ¨¡æ“¬åœ–ä¸­çš„ "Kç·šæ©«ç›¤" èˆ‡ "ç›¤æ•´")
                    // é€™è£¡ç”¨çŸ­è™›ç·šç¤ºæ„ç®±é«”ç¯„åœ
                    // å·¦è‚©ç®±é«”
                    { x1: 1, x2: 4, y1: v.neck, y2: v.neck, color: 'rgba(255,255,255,0.3)', dashed: true }, 
                    { x1: 1, x2: 4, y1: v.shoulder, y2: v.shoulder, color: 'rgba(255,255,255,0.3)', dashed: true },
                    // å³è‚©ç®±é«”
                    { x1: 6, x2: 10, y1: v.neck, y2: v.neck, color: 'rgba(255,255,255,0.3)', dashed: true },
                    { x1: 6, x2: 10, y1: v.shoulder, y2: v.shoulder, color: 'rgba(255,255,255,0.3)', dashed: true },

                    // 5. è—è‰²æ¸¬å¹…è™›ç·š
                    { x1: 5, x2: 5, y1: v.head, y2: v.neck, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    { x1: 11.5, x2: 11.5, y1: v.neck, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 10.3, // å‰›çªç ´é ¸ç·šçš„ä½ç½®
                        yValue: v.neck,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    doubleBottom: {
        name: "5. é›™æ¤¿åº•/Wåº• (Double Bottom) - é›™è…³ç¢ºç«‹",
        type: "bull",
        inputs: [
            { id: "neck", label: "é ¸ç·šå£“åŠ› (ä¸­é–“é«˜é»)", default: 60 },
            { id: "low", label: "åº•éƒ¨ä½é» (æ”¯æ’)", default: 50 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹å…©æ¬¡æ¢åº•ï¼Œå½¢æˆã€ŒWã€å­—å‹ã€‚åœ–ä¸­ç¶ ç·šé¡¯ç¤ºåº•éƒ¨æœ‰å¼·åŠ›æ”¯æ’ï¼Œä¸”å…©éš»è…³(é›™æ¤¿)ç¢ºç«‹äº†å¤šé ­é˜²ç·šã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­ç‰¹åˆ¥æ¨™ç¤º<strong>ã€Œé›™æ¤¿éœ€å¤§é‡ã€</strong>ï¼Œæ„æŒ‡åœ¨æ‰“ç¬¬äºŒéš»è…³æˆ–<strong>çªç ´é ¸ç·š(è—é»è™•)</strong>æ™‚ï¼Œå¿…é ˆæœ‰æˆäº¤é‡æ˜é¡¯æ”¾å¤§ï¼Œç¢ºèªä¸»åŠ›é€²å ´ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è²·é»ï¼šå¸¶é‡çªç ´é ¸ç·šæ™‚ã€‚<br>
            2. æ¸¬å¹…ï¼šæ¡ã€Œå‚ç›´ç­‰å¹…ã€æ¸¬é‡(è—è‰²è™›ç·š)ã€‚ç›®æ¨™åƒ¹ = é ¸ç·š + (é ¸ç·š - åº•éƒ¨)ã€‚
        `,
        calc: (v) => {
            const h = v.neck - v.low;
            const target = v.neck + h;
            return {
                entry: v.neck,
                target: target,
                stop: v.low,
                // èµ°å‹¢å„ªåŒ–ï¼šä¸‹è·Œ -> ç¬¬ä¸€è…³ -> åå½ˆ -> ç¬¬äºŒè…³ -> çªç ´ -> ç›®æ¨™
                points: [
                    v.neck + h*0.8, // èµ·å§‹é«˜é»
                    v.low,          // ç¬¬ä¸€éš»è…³ (æ¨)
                    v.neck,         // é ¸ç·š
                    v.low,          // ç¬¬äºŒéš»è…³ (æ¨)
                    v.neck,         // æŒ‘æˆ°é ¸ç·š
                    v.neck + h*0.2, // çªç ´ (è—é»ä½ç½®)
                    target          // é”æ¨™
                ],
                trendlines: [
                    // 1. ä¸‰æ¢ç¶ è‰²æ°´å¹³ç·š
                    { x1: 0, x2: 4, y1: v.low, y2: v.low, color: '#2ecc71', label: 'åº•éƒ¨æ”¯æ’' }, 
                    { x1: 1, x2: 5, y1: v.neck, y2: v.neck, color: '#2ecc71', label: 'é ¸ç·šå£“åŠ›' },
                    { x1: 5, x2: 6, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // 2. è—è‰²ç­‰å¹…æ¸¬è·è™›ç·š
                    // åº•éƒ¨åˆ°é ¸ç·šçš„é«˜åº¦
                    { x1: 2, x2: 2, y1: v.low, y2: v.neck, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    // é ¸ç·šåˆ°ç›®æ¨™çš„é«˜åº¦
                    { x1: 5.5, x2: 5.5, y1: v.neck, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 4.2, // å‰›å¥½çªç ´é ¸ç·šçš„ä½ç½® (ä»‹æ–¼æŒ‘æˆ°é ¸ç·šå’Œçªç ´å¾Œä¹‹é–“)
                        yValue: v.neck,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    fryPanBottom: {
        name: "6. ç…é‹åº• (Fry Pan Bottom) - åœ“å¼§ç¯‰åº•å¸¶æŸ„",
        type: "bull",
        inputs: [
            { id: "neck", label: "é ¸ç·šå£“åŠ› (é‹è“‹)", default: 20 },
            { id: "low", label: "é‹åº•æœ€ä½é»", default: 10 },
            { id: "handle_low", label: "é‹æŸ„å›æª”ä½é»", default: 17 } // æ–°å¢é‹æŸ„ä½é»è¼¸å…¥
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹ç¶“éé•·æ™‚é–“çš„åœ“å¼§åº•ç›¤æ•´ï¼Œå³å´ä¸Šæ¼²å¾Œå‡ºç¾å°å¹…å›æª”æ•´ç†ï¼Œå½¢æˆã€Œé‹æŸ„ã€ã€‚æ•´é«”å½¢ç‹€å¦‚å¹³åº•é‹ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>é‹æŸ„æ˜¯ä¸»åŠ›æ´—ç›¤çš„éç¨‹ï¼Œé‡èƒ½æ‡‰èç¸®ã€‚åœ–ä¸­ç¶ è‰²æ–œç·šé¡¯ç¤ºæ—©æœŸè¶¨å‹¢æ”¹è®Šï¼Œæ°´å¹³ç¶ ç·šç‚ºé ¸ç·šå£“åŠ›ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è²·é»ï¼šå¸¶é‡çªç ´é‹æŸ„é«˜é»(é ¸ç·š)æ™‚ (åœ–ä¸­è—é»)ã€‚<br>
            2. æ¸¬å¹…ï¼šæ¡ã€Œå‚ç›´ç­‰å¹…ã€æ¸¬é‡(è—è‰²è™›ç·š)ã€‚ç›®æ¨™åƒ¹ = é ¸ç·š + (é ¸ç·š - é‹åº•)ã€‚
        `,
        calc: (v) => {
            const h = v.neck - v.low;
            const target = v.neck + h;
            return {
                entry: v.neck,
                target: target,
                stop: v.handle_low, // åœæè¨­åœ¨é‹æŸ„ä½é»
                // èµ°å‹¢å„ªåŒ–ï¼šä¸‹è·Œ -> åœ“å¼§åº• -> ä¸Šæ¼²è‡³é ¸ç·š -> é‹æŸ„å›æª” -> çªç ´ -> ç›®æ¨™
                points: [
                    v.neck + h*0.5, // èµ·å§‹é«˜é»
                    v.neck,         // è·Œç ´é ¸ç·šä½ç½® (é›–å·¦å´ç„¡é ¸ç·šï¼Œä½†ä½œç‚ºåƒè€ƒé«˜åº¦)
                    v.low + h*0.2,  // ä¸‹è·Œä¸­
                    v.low,          // é‹åº• (æœ€ä½)
                    v.low + h*0.2,  // ç¯‰åº•å³å´
                    v.neck,         // ä¾†åˆ°é ¸ç·š (é‹æŸ„èµ·é»)
                    v.handle_low,   // é‹æŸ„å›æª”
                    v.neck,         // æŒ‘æˆ°é ¸ç·š (é‹æŸ„çµ‚é»)
                    v.neck + h*0.2, // çªç ´ (è—é»ä½ç½®)
                    target          // é”æ¨™
                ],
                trendlines: [
                    // 1. ç¶ è‰²åˆ‡ç·š
                    { x1: 3, x2: 3, y1: v.low, y2: v.low, color: '#2ecc71', label: 'é‹åº•' },
                    { x1: 5, x2: 7, y1: v.neck, y2: v.neck, color: '#2ecc71', label: 'é ¸ç·š (é‹è“‹)' },
                    // æ¨¡æ“¬åœ–ä¸­çš„ä¸‹é™è¶¨å‹¢ç·š (ç¤ºæ„)
                    { x1: 0, x2: 5, y1: v.neck + h*0.5, y2: v.neck, color: '#2ecc71', label: 'ä¸‹é™å£“åŠ›' }, 
                    { x1: 9, x2: 9, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // 2. è—è‰²ç­‰å¹…æ¸¬è·è™›ç·š
                    // é‹åº•åˆ°é ¸ç·šçš„é«˜åº¦
                    { x1: 3, x2: 3, y1: v.low, y2: v.neck, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    // é ¸ç·šåˆ°ç›®æ¨™çš„é«˜åº¦
                    { x1: 8.5, x2: 8.5, y1: v.neck, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 7.5, // å‰›å¥½çªç ´é ¸ç·šçš„ä½ç½®
                        yValue: v.neck,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    roundingBottom: {
        name: "7. åœ“å¼§åº• (Rounding Bottom) - é•·ç·šå¤§åº•",
        type: "bull",
        inputs: [
            { id: "neck", label: "é ¸ç·šå£“åŠ›", default: 20 },
            { id: "low", label: "åœ“å¼§æœ€ä½é»", default: 10 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹ç¶“éé•·æ™‚é–“çš„å¹³ç·©ä¸‹è·Œèˆ‡ç›¤æ•´ï¼Œå½¢æˆä¸€å€‹åœ“æ»‘çš„ç¢—ç‹€åº•éƒ¨(Uå‹)ã€‚åœ–ä¸­ç¶ ç·šç‚ºé ¸ç·šå£“åŠ›ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ç‰‡é¡¯ç¤ºçªç ´é ¸ç·šå¾Œï¼Œå¸¸æœƒå‡ºç¾<strong>ã€Œå›æ¸¬é ¸ç·šã€</strong>çš„å‹•ä½œ(ç´…è‰²è™›ç·šç®­é ­)ï¼Œç¢ºèªæ”¯æ’æœ‰æ•ˆå¾Œæ‰å±•é–‹ä¸»å‡æ®µã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è²·é»ï¼šå¸¶é‡çªç ´é ¸ç·šæ™‚(è—é»è™•)ã€‚<br>
            2. åŠ ç¢¼é»ï¼šçªç ´å¾Œå›æ¸¬é ¸ç·šä¸ç ´æ™‚ã€‚<br>
            3. æ¸¬å¹…ï¼šæ¡ã€Œå‚ç›´ç­‰å¹…ã€æ¸¬é‡(è—è‰²è™›ç·š)ã€‚ç›®æ¨™åƒ¹ = é ¸ç·š + (é ¸ç·š - åº•éƒ¨)ã€‚
        `,
        calc: (v) => {
            const h = v.neck - v.low;
            const target = v.neck + h;
            return {
                entry: v.neck,
                target: target,
                stop: v.low,
                // èµ°å‹¢å„ªåŒ–ï¼šç·©è·Œ -> å¹³ç·©åº•éƒ¨ -> ç·©æ¼² -> çªç ´ -> å›æ¸¬ -> ç›®æ¨™
                // ä½¿ç”¨æ›´å¤šé»ä½ä¾†æ¨¡æ“¬åœ“å¼§æ„Ÿ
                points: [
                    v.neck + h*0.3, // èµ·å§‹
                    v.neck - h*0.2, // ç·©è·Œ
                    v.low + h*0.1,  // æ¥è¿‘åº•éƒ¨
                    v.low,          // åº•éƒ¨
                    v.low + h*0.1,  // é›¢é–‹åº•éƒ¨
                    v.neck - h*0.2, // ç·©æ¼²
                    v.neck,         // æŠµé”é ¸ç·š
                    v.neck + h*0.2, // çªç ´å™´å‡º
                    v.neck + h*0.05,// å›æ¸¬é ¸ç·š (Retest)
                    target          // é”æ¨™
                ],
                trendlines: [
                    // 1. ç¶ è‰²åˆ‡ç·š
                    { x1: 0, x2: 9, y1: v.neck, y2: v.neck, color: '#2ecc71', label: 'é ¸ç·š (å£“åŠ›è½‰æ”¯æ’)' },
                    { x1: 2, x2: 5, y1: v.low, y2: v.low, color: '#2ecc71', label: 'åº•éƒ¨' },

                    // 2. è—è‰²ç­‰å¹…æ¸¬è·è™›ç·š
                    // åº•éƒ¨åˆ°é ¸ç·šçš„é«˜åº¦
                    { x1: 3.5, x2: 3.5, y1: v.low, y2: v.neck, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    // é ¸ç·šåˆ°ç›®æ¨™çš„é«˜åº¦ (ä½æ–¼å›æ¸¬å¾Œ)
                    { x1: 8.5, x2: 8.5, y1: v.neck, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 6.5, // å‰›å¥½çªç ´é ¸ç·šçš„ä½ç½®
                        yValue: v.neck,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    ascRightTriBottom: {
        name: "8. ä¸Šå‡ç›´è§’ä¸‰è§’åº• (Ascending Triangle) - å¤šé ­æ­¥æ­¥é€²é€¼",
        type: "bull",
        inputs: [
            { id: "res", label: "æ°´å¹³å£“åŠ›ç·š (é ‚)", default: 40 },
            { id: "low", label: "ä¸‰è§’å½¢èµ·é» (åº•)", default: 30 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>é€™æ˜¯ä¸€å€‹ã€Œå¤šé ­æ•²é–€ã€çš„å¼·å‹¢å‹æ…‹ï¼š<br>
            1. <strong>å¹³é ‚å£“åŠ›</strong>ï¼šç©ºæ–¹åœ¨å›ºå®šåƒ¹ä½é˜²å®ˆ(ç¶ è‰²æ°´å¹³ç·š)ï¼Œæ‰€æœ‰åå½ˆé«˜é»çš†ç²¾ç¢ºå°é½Šæ­¤ç·šã€‚<br>
            2. <strong>ä¸Šå‡æ”¯æ’</strong>ï¼šå¤šæ–¹è²·æ°£é€æ³¢å¢å¼·ï¼Œæ‰€æœ‰å›æª”ä½é»çš†ç²¾ç¢ºè½åœ¨ä¸Šå‡æ–œç·šä¸Šã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­ç´…è‰²è™›ç·šç®­é ­é¡¯ç¤ºï¼Œçªç ´å¾Œå¸¸æœ‰<strong>ã€Œå›æ¸¬æ°´å¹³ç·šã€</strong>çš„å‹•ä½œ(Throwback)ã€‚é€™æ˜¯ç¢ºèªå£“åŠ›è½‰æ”¯æ’çš„é‡è¦è¨Šè™Ÿã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è²·é»ï¼šå¸¶é‡è¡éæ°´å¹³å£“åŠ›ç·š(è—é»)ã€‚<br>
            2. åŠ ç¢¼ï¼šå›æ¸¬æ°´å¹³ç·šä¸ç ´æ™‚ã€‚<br>
            3. æ¸¬å¹…ï¼šä¸‰è§’å½¢æœ€å¯¬è™•çš„é«˜åº¦å‘ä¸Šç­‰å¹…æŠ•å°„ã€‚
        `,
        calc: (v) => {
            const h = v.res - v.low; // ä¸‰è§’å½¢é«˜åº¦
            const target = v.res + h;
            
            // ==========================================
            // ğŸ“ å¹¾ä½•é‹ç®—æ ¸å¿ƒ
            // ==========================================
            
            // 1. å®šç¾©æ™‚é–“è»¸
            // T0:èµ·é» | T2:å¢Šé«˜1 | T4:å¢Šé«˜2 | T7:æ”¶æ–‚é ‚é»
            const t_start = 0;
            const t_intersect = 7; // å‡è¨­åœ¨ T7 äº¤æœƒ

            // 2. å»ºç«‹ã€ä¸Šå‡æ”¯æ’ç·šã€‘æ–¹ç¨‹å¼ (y = mx + c)
            // é€šé (0, low) å’Œ (7, res)
            const m = (v.res - v.low) / (t_intersect - t_start);
            const c = v.low;
            
            // å‡½æ•¸ï¼šè¨ˆç®—ä»»æ„æ™‚é–“é»çš„æ”¯æ’ä½ (ç²¾ç¢ºè½åœ¨æ–œç·šä¸Š)
            const getSupportPrice = (t) => (m * t) + c;

            return {
                entry: v.res,
                target: target,
                stop: getSupportPrice(2), // åœæè¨­åœ¨ç¬¬ä¸€å€‹å¢Šé«˜çš„ä½é»
                
                // èµ°å‹¢å„ªåŒ–ï¼šé»ç·šåˆä¸€
                // T0: èµ·å§‹ä½
                // T1: è§¸é ‚ (å¹³)
                // T2: å¢Šé«˜ (æ–œ)
                // T3: è§¸é ‚ (å¹³)
                // T4: å†å¢Šé«˜ (æ–œ)
                // T5: çªç ´ (è—é»)
                // T6: å›æ¸¬ (ç²¾ç¢ºè¸©é ‚ - æ¨¡æ“¬ç´…è™›ç·šç®­é ­)
                // T7: é”æ¨™
                points: [
                    getSupportPrice(0),     // T0: èµ·é» (â˜…å°é½Šæ–œç·š)
                    v.res,                  // T1: è§¸é ‚ (â˜…å°é½Šæ°´å¹³)
                    getSupportPrice(2),     // T2: å¢Šé«˜ (â˜…å°é½Šæ–œç·š)
                    v.res,                  // T3: è§¸é ‚ (â˜…å°é½Šæ°´å¹³)
                    getSupportPrice(4),     // T4: å†å¢Šé«˜ (â˜…å°é½Šæ–œç·š)
                    v.res + h * 0.25,       // T5: çªç ´è¡é«˜
                    v.res,                  // T6: å›æ¸¬æ°´å¹³ç·š (â˜…ç²¾ç¢ºæ”¯æ’ç¢ºèª)
                    target                  // T7: é”æ¨™
                ],
                
                trendlines: [
                    // A. æ°´å¹³å£“åŠ›ç·š (é ‚) - å»¶ä¼¸è¦†è“‹æ•´å€‹éç¨‹
                    { 
                        x1: 0, x2: 7, 
                        y1: v.res, y2: v.res, 
                        color: '#2ecc71', 
                        label: 'æ°´å¹³å£“åŠ›' 
                    },
                    
                    // B. ä¸Šå‡æ”¯æ’ç·š (åº•) - é€£æ¥ä½é»æŒ‡å‘äº¤æœƒè™•
                    { 
                        x1: 0, x2: 6, 
                        y1: getSupportPrice(0), 
                        y2: getSupportPrice(6), 
                        color: '#2ecc71', 
                        label: 'ä¸Šå‡æ”¯æ’' 
                    },

                    // C. ç›®æ¨™åƒ¹ç·š
                    { x1: 6, x2: 7.5, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // D. æ¸¬å¹…è™›ç·š (å·¦å´ H)
                    { x1: 0.2, x2: 0.2, y1: v.low, y2: v.res, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // E. æ¸¬å¹…è™›ç·š (å³å´æŠ•å°„)
                    { x1: 7, x2: 7, y1: v.res, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                // è—è‰²çªç ´é»
                // æˆ‘å€‘æŠŠå®ƒæ”¾åœ¨å‰›çªç ´æ°´å¹³ç·šçš„ä½ç½® (T4 å’Œ T5 ä¹‹é–“)
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 4.6, 
                        yValue: v.res,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    descWedge: {
        name: "9. ä¸‹é™æ¥”å‹ (Falling Wedge) - æœ«ç«¯æ”¶æ–‚",
        type: "bull",
        inputs: [
            { id: "breakout", label: "çªç ´é» (å£“åŠ›ç·š)", default: 45 },
            { id: "low", label: "æ¥”å‹å°–ç«¯ä½é»", default: 35 },
            { id: "width", label: "é–‹å£é«˜åº¦ (H)", default: 15 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>é«˜é»èˆ‡ä½é»åŒæ™‚ä¸‹é™ï¼Œä½†ã€Œä¸Šæ–¹å£“åŠ›ç·š(é™¡)ã€æ¯”ã€Œä¸‹æ–¹æ”¯æ’ç·š(ç·©)ã€ä¸‹é™å¾—æ›´å¿«ï¼Œå°è‡´å‹æ…‹å‘å³æ”¶æ–‚ã€‚é€™ä»£è¡¨ç©ºé ­é›–å¼·ï¼Œä½†åŠ›é“æ­£åœ¨è¡°ç«­ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­ç´…è‰²è™›ç·šç®­é ­é¡¯ç¤ºï¼Œçªç ´ä¸‹é™è¶¨å‹¢ç·šå¾Œï¼Œå¸¸æœ‰<strong>ã€Œå›æ¸¬ã€</strong>å‹•ä½œ(Throwback)ã€‚ç¢ºèªæ”¯æ’ä¸ç ´å¾Œï¼Œæ‰æ˜¯æœ€ç©©å¥çš„åŠ ç¢¼é»ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è²·é»ï¼šçªç ´ä¸Šæ–¹å£“åŠ›ç·šæ™‚(è—é»)ã€‚<br>
            2. æ¸¬å¹…ï¼šæ¡ã€Œå‚ç›´ç­‰å¹…ã€æ¸¬é‡(è—è‰²è™›ç·š)ã€‚ç›®æ¨™åƒ¹ = çªç ´é» + æ¥”å‹æœ€å¯¬è™•é«˜åº¦ã€‚
        `,
        calc: (v) => {
            const target = v.breakout + v.width;
            
            // ==========================================
            // ğŸ“ é›™è»Œå¹¾ä½•é‹ç®— (Falling Wedge)
            // ==========================================
            
            // å®šç¾©æ™‚é–“è»¸
            // T0:èµ·è·Œ | T1:ä½ | T2:é«˜ | T3:å°–ç«¯ä½ | T4:çªç ´ | T5:è¡é«˜ | T6:å›æ¸¬
            const t0 = 0;
            const t3 = 3;
            const t4 = 4;

            // 1. å»ºç«‹ã€ä¸Šæ–¹å£“åŠ›ç·šã€‘æ–¹ç¨‹å¼ (é™¡)
            // é€šé T4 (Breakout)
            const p4 = v.breakout;
            // è¨­å®š T0 (èµ·è·Œé») çš„é«˜åº¦ = çªç ´é» + é–‹å£å¯¬åº¦
            const p0 = v.breakout + v.width;
            
            // è¨ˆç®—æ–œç‡ m_high (è¼ƒé™¡çš„è² æ–œç‡)
            const m_high = (p4 - p0) / (t4 - t0);
            const getHighLine = (t) => p0 + m_high * (t - t0);

            // 2. å»ºç«‹ã€ä¸‹æ–¹æ”¯æ’ç·šã€‘æ–¹ç¨‹å¼ (ç·©)
            // é€šé T3 (Low)
            const p3 = v.low;
            // è¨­å®š T1 (å‰ä½)
            // ç‚ºäº†æ”¶æ–‚ï¼Œæ”¯æ’ç·šæ–œç‡å¿…é ˆæ¯”å£“åŠ›ç·šã€Œå¹³ç·©ã€
            // ä¹Ÿå°±æ˜¯ m_low çš„çµ•å°å€¼è¦å°æ–¼ m_high
            // æˆ‘å€‘è¨­å®š m_low ç‚º m_high çš„ 40%
            const m_low = m_high * 0.4; 
            
            // åæ¨æ”¯æ’ç·šæˆªè·: y = mx + c => c = y - mx
            // c_low = p3 - m_low * t3
            const c_low = p3 - (m_low * t3);
            const getLowLine = (t) => (m_low * t) + c_low;

            // 3. è¨ˆç®—é—œéµé»ä½
            // T1 (å‰ä½): å¿…é ˆåœ¨æ”¯æ’ç·šä¸Š
            const p1 = getLowLine(1);
            // T2 (å‰é«˜): å¿…é ˆåœ¨å£“åŠ›ç·šä¸Š
            const p2 = getHighLine(2);
            // T6 (å›æ¸¬é»): å›åˆ°çªç ´é»é™„è¿‘ (æ¨¡æ“¬å›æ¸¬è¶¨å‹¢ç·š)
            const p6 = v.breakout;

            return {
                entry: v.breakout,
                target: target,
                stop: v.low,
                
                // èµ°å‹¢å„ªåŒ–ï¼šé»ç·šåˆä¸€ï¼Œæ”¶æ–‚å¹¾ä½•
                // T0: èµ·å§‹é«˜é»
                // T1: å‰ä½ (â˜…å°é½Šæ”¯æ’)
                // T2: å‰é«˜ (â˜…å°é½Šå£“åŠ›)
                // T3: å°–ç«¯ä½ (â˜…å°é½Šæ”¯æ’)
                // T4: çªç ´ (â˜…å°é½Šå£“åŠ› - è—é»)
                // T5: è¡é«˜
                // T6: å›æ¸¬ (æ¨¡æ“¬ç´…è‰²è™›ç·šç®­é ­)
                // T7: é”æ¨™
                points: [
                    p0,                 // T0
                    p1,                 // T1
                    p2,                 // T2
                    p3,                 // T3
                    p4,                 // T4
                    p4 + v.width * 0.25,// T5
                    p6,                 // T6 (å›æ¸¬)
                    target              // T7
                ],
                
                trendlines: [
                    // A. ä¸Šæ–¹å£“åŠ›ç·š (é™¡) - é€£æ¥ T0 -> T4
                    { 
                        x1: 0, x2: 4.5, 
                        y1: p0, y2: getHighLine(4.5), 
                        color: '#2ecc71', 
                        label: 'ä¸‹é™å£“åŠ› (é™¡)' 
                    },
                    
                    // B. ä¸‹æ–¹æ”¯æ’ç·š (ç·©) - é€£æ¥ T1 -> T3 -> å»¶ä¼¸é¡¯ç¤ºæ”¶æ–‚
                    { 
                        x1: 0.5, x2: 6, 
                        y1: getLowLine(0.5), y2: getLowLine(6), 
                        color: '#2ecc71', 
                        label: 'æ”¶æ–‚æ”¯æ’ (ç·©)' 
                    },

                    // C. ç›®æ¨™åƒ¹ç·š
                    { x1: 6, x2: 7.5, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // D. æ¸¬å¹…è™›ç·š (å·¦å´é–‹å£ H)
                    // æ¸¬é‡ T0 åˆ° å°æ‡‰ä¸‹æ–¹çš„è·é›¢
                    { x1: 0.2, x2: 0.2, y1: getLowLine(0), y2: p0, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // E. æ¸¬å¹…è™›ç·š (å³å´æŠ•å°„)
                    { x1: 7, x2: 7, y1: p4, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 4, // T4
                        yValue: p4,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    broadeningBottom: {
        name: "10. æ”¾å°„æ“´å¼µå–‡å­åº• (Broadening Bottom) - æ³¢å‹•çˆ†ç™¼",
        type: "bull",
        inputs: [
            { id: "breakout", label: "çªç ´é» (å£“åŠ›ç·š)", default: 60 },
            { id: "low", label: "æœ€å¾Œä½é» (æ”¯æ’ç·š)", default: 40 },
            { id: "amp", label: "æœ€å¾Œä¸€æ³¢æŒ¯å¹… (H)", default: 20 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>é«˜é»ä¸€æ³¢æ¯”ä¸€æ³¢é«˜ï¼Œä½é»ä¸€æ³¢æ¯”ä¸€æ³¢ä½ï¼Œå½¢æˆå‘å³é–‹å£çš„å–‡å­ç‹€ã€‚é€™ä»£è¡¨å¸‚å ´æƒ…ç·’å¾çŒ¶è±«è½‰ç‚ºæ¥µåº¦æ¿€å‹•ï¼Œç±Œç¢¼æ­£åœ¨å¤§æ›æ‰‹ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­ç´«è‰²ç·šæ¨™ç¤ºæœ€å¾Œä¸€æ³¢æ”»æ“Šçš„<strong>ã€Œ1/2 ä½ç½®ã€</strong>ã€‚é€™æ˜¯å¤šé ­åæ”»çš„ä¸­ç¹¼ç«™ã€‚æ­¤å¤–ï¼Œçªç ´æ“´å¼µå£“åŠ›ç·šå¾Œï¼Œå¸¸æœ‰<strong>ã€Œå›æ¸¬ã€</strong>å‹•ä½œ(ç´…è‰²è™›ç·š)ï¼Œæ˜¯ç¢ºèªè²·é»ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è²·é»ï¼šå¸¶é‡çªç ´ä¸Šæ–¹æ“´å¼µå£“åŠ›ç·š(è—é»)ã€‚<br>
            2. æ¸¬å¹…ï¼šæ¡ã€Œå‚ç›´ç­‰å¹…ã€æ¸¬é‡ã€‚ç›®æ¨™åƒ¹ = çªç ´é» + æœ€å¾Œä¸€æ³¢æŒ¯å¹…ã€‚
        `,
        calc: (v) => {
            const target = v.breakout + v.amp;
            
            // ==========================================
            // ğŸ“ é›™è»Œå¹¾ä½•é‹ç®— (Broadening)
            // ==========================================

            // å®šç¾©æ™‚é–“è»¸
            // T1:å‰ä½ | T2:å‰é«˜ | T3:æœ€ä½ | T4:è¡é1/2 | T6:çªç ´ | T7:å›æ¸¬
            const t2 = 2; // å‰é«˜
            const t3 = 3; // æœ€ä½
            const t6 = 6; // çªç ´é» (è—é»)

            // 1. å»ºç«‹ã€ä¸Šæ–¹å£“åŠ›ç·šã€‘æ–¹ç¨‹å¼ (y = m_high * x + c_high)
            // é€šé T6 (Breakout)
            // ç‚ºäº†ç•«å‡ºæ“´å¼µï¼ŒT2 (å‰é«˜) å¿…é ˆæ¯” T6 ä½
            // è¨­å®š T2 æ¯” T6 ä½ 30% çš„æŒ¯å¹…
            const p6 = v.breakout;
            const p2 = v.breakout - (v.amp * 0.3); 
            
            // è¨ˆç®—æ–œç‡ m_high (æ­£æ–œç‡)
            const m_high = (p6 - p2) / (t6 - t2);
            const getHighLine = (t) => p2 + m_high * (t - t2);

            // 2. å»ºç«‹ã€ä¸‹æ–¹æ”¯æ’ç·šã€‘æ–¹ç¨‹å¼ (y = m_low * x + c_low)
            // é€šé T3 (Low)
            // ç‚ºäº†ç•«å‡ºæ“´å¼µï¼ŒT1 (å‰ä½) å¿…é ˆæ¯” T3 é«˜
            const p3 = v.low;
            const p1 = v.low + (v.amp * 0.3); 
            const t1 = 1;

            // è¨ˆç®—æ–œç‡ m_low (è² æ–œç‡)
            const m_low = (p3 - p1) / (t3 - t1);
            const getLowLine = (t) => p1 + m_low * (t - t1);

            // 3. è¨ˆç®— 1/2 é—œéµä½
            const halfLevel = v.low + (v.breakout - v.low) * 0.5;

            // 4. è¨ˆç®—å›æ¸¬é» (T7)
            // çªç ´å¾Œå›è¸©å»¶ä¼¸çš„å£“åŠ›ç·š
            const t_retest = 7.5;
            const p_retest = getHighLine(t_retest);

            return {
                entry: v.breakout,
                target: target,
                stop: v.low,
                
                // èµ°å‹¢å„ªåŒ–ï¼šé»ç·šåˆä¸€
                // T0: èµ·å§‹
                // T1: å‰ä½ (â˜…å°é½Šæ”¯æ’)
                // T2: å‰é«˜ (â˜…å°é½Šå£“åŠ›)
                // T3: æœ€ä½ (â˜…å°é½Šæ”¯æ’)
                // T4: åå½ˆè‡³ 1/2 é™„è¿‘éœ‡ç›ª
                // T5: çºŒæ”»
                // T6: çªç ´ (â˜…å°é½Šå£“åŠ› - è—é»)
                // T7: è¡é«˜
                // T8: å›æ¸¬ (â˜…ç²¾ç¢ºè¸©åœ¨å£“åŠ›ç·šä¸Š - æ¨¡æ“¬ç´…è™›ç·š)
                // T9: é”æ¨™
                points: [
                    getHighLine(0.5),   // T0
                    p1,                 // T1
                    p2,                 // T2
                    p3,                 // T3
                    halfLevel,          // T4 (ç¶“é 1/2)
                    v.breakout - 2,     // T5 (æ¥è¿‘çªç ´)
                    p6,                 // T6 (çªç ´)
                    p6 + v.amp * 0.2,   // T7 (è¡é«˜)
                    p_retest,           // T8 (å›æ¸¬å»¶ä¼¸å£“åŠ›ç·š)
                    target              // T9
                ],
                
                trendlines: [
                    // A. ä¸Šæ–¹æ“´å¼µå£“åŠ›ç·š (é€£æ¥ T2 -> T6 -> å»¶ä¼¸)
                    { 
                        x1: 1.5, x2: 8, 
                        y1: getHighLine(1.5), y2: getHighLine(8), 
                        color: '#2ecc71', 
                        label: 'æ“´å¼µå£“åŠ›' 
                    },
                    
                    // B. ä¸‹æ–¹æ“´å¼µæ”¯æ’ç·š (é€£æ¥ T1 -> T3)
                    { 
                        x1: 0.5, x2: 4, 
                        y1: getLowLine(0.5), y2: getLowLine(4), 
                        color: '#2ecc71', 
                        label: 'æ“´å¼µæ”¯æ’' 
                    },
                    
                    // C. 1/2 é—œéµä½ (ç´«è‰²)
                    { x1: 3, x2: 6, y1: halfLevel, y2: halfLevel, color: '#9b59b6', label: '1/2 é—œå¡' },

                    // D. ç›®æ¨™åƒ¹ç·š
                    { x1: 8.5, x2: 9.5, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // E. æ¸¬å¹…è™›ç·š (ä¸­é–“æŒ¯å¹… H)
                    { x1: 4.5, x2: 4.5, y1: v.low, y2: getHighLine(4.5), color: '#3498db', dashed: true, label: 'æŒ¯å¹…H' },
                    
                    // F. æ¸¬å¹…è™›ç·š (å³å´æŠ•å°„ H)
                    { x1: 9, x2: 9, y1: p6, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 6, // T6
                        yValue: p6,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    downBroadening: {
        name: "11. å‘ä¸‹æ“´å¼µå–‡å­åº• (Descending Broadening) - æœ«ç«¯è“„åŠ›",
        type: "bull",
        inputs: [
            { id: "breakout", label: "çªç ´é» (å£“åŠ›ç·š)", default: 50 },
            { id: "low", label: "æœ€å¾Œä½é» (æ”¯æ’ç·š)", default: 40 },
            { id: "amp", label: "æœ€å¾Œä¸€æ³¢æŒ¯å¹… (H)", default: 15 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>å…©æ¢ç¶ è‰²è¶¨å‹¢ç·šåŒæ™‚å‘ä¸‹ï¼Œä½†ä¸‹æ–¹æ”¯æ’ç·šè·Œå‹¢æ›´çŒ›(æ›´é™¡)ï¼Œå½¢æˆæ“´å¼µç‹€ã€‚é€™é€šå¸¸ç™¼ç”Ÿåœ¨ç©ºé ­æœ«ç«¯çš„éç†æ€§æ®ºç›¤ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>è«‹æ³¨æ„åœ–ä¸­ç´«è‰²ç·šæ¨™ç¤ºçš„<strong>ã€Œ1/2ã€</strong>ã€‚è‚¡åƒ¹åœ¨è§¸ç¢°å£“åŠ›ç·šå¾Œï¼Œå›æª”<strong>ä¸å†ç ´åº•</strong>ï¼Œè€Œæ˜¯å®ˆåœ¨æ¼²å¹…çš„ 1/2 è™•è“„åŠ›ã€‚é€™æ˜¯å¤šé ­æ¥ç®¡æˆ°å ´çš„è¨Šè™Ÿã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. æ½›ä¼é»ï¼šå›æ¸¬ 1/2 ç´«è‰²ç·šä¸ç ´æ™‚ã€‚<br>
            2. è²·é»ï¼šå¸¶é‡çªç ´ä¸Šæ–¹å£“åŠ›ç·š(è—é»)ã€‚<br>
            3. æ¸¬å¹…ï¼šçªç ´é» + æœ€å¾Œä¸€æ³¢æŒ¯å¹…(è—è‰²è™›ç·š)ã€‚
        `,
        calc: (v) => {
            const target = v.breakout + v.amp;
            
            // ==========================================
            // ğŸ“ é›™è»Œå¹¾ä½•é‹ç®—
            // ==========================================
            
            // å®šç¾©æ™‚é–“è»¸
            // T1:å‰ä½ | T2:å‰é«˜ | T3:æœ€ä½ | T4:è§¸å£“(è“„åŠ›èµ·é») | T5:å›æ¸¬1/2 | T6:çªç ´
            const t2 = 2; // å‰é«˜
            const t3 = 3; // æœ€ä½
            const t4 = 4; // è§¸å£“
            const t6 = 6; // çªç ´

            // 1. å»ºç«‹ã€ä¸Šæ–¹å£“åŠ›ç·šã€‘æ–¹ç¨‹å¼ (y = m_high * x + c_high)
            // é€šé T6 (Breakout)
            // è¨­å®šæ–œç‡ç‚ºè²  (å‘ä¸‹)ï¼Œä½†è¼ƒç·©
            const p6 = v.breakout;
            // å‡è¨­ T2 (å‰é«˜) æ¯” T6 é«˜ (å› ç‚ºæ˜¯å‘ä¸‹è¶¨å‹¢)
            // è¨­å®š T2 æ¯” T6 é«˜å‡ºæŒ¯å¹…çš„ 20%
            const p2 = v.breakout + (v.amp * 0.2); 
            
            const m_high = (p6 - p2) / (t6 - t2); // è² æ–œç‡
            const getHighLine = (t) => p2 + m_high * (t - t2);

            // 2. å»ºç«‹ã€ä¸‹æ–¹æ”¯æ’ç·šã€‘æ–¹ç¨‹å¼ (y = m_low * x + c_low)
            // é€šé T3 (Low)
            // æ–œç‡è¦æ¯”ä¸Šæ–¹æ›´é™¡ (å‘ä¸‹æ“´å¼µ)
            const p3 = v.low;
            // T1 (å‰ä½) æ¯” T3 é«˜
            // ä¸”æ“´å¼µå¹…åº¦è¦å¤ æ˜é¡¯
            const p1 = v.low + (v.amp * 0.4); 
            const t1 = 1;

            const m_low = (p3 - p1) / (t3 - t1); // è² æ–œç‡ (æ›´é™¡)
            const getLowLine = (t) => p1 + m_low * (t - t1);

            // 3. è¨ˆç®—é—œéµé»ä½ï¼šT4 (çªç ´å‰çš„åå½ˆè§¸å£“)
            // T4 å¿…é ˆå‰›å¥½æ‰“åœ¨å£“åŠ›ç·šä¸Š
            const p4 = getHighLine(t4);

            // 4. è¨ˆç®— 1/2 ä¸­é—œ (è“„åŠ›é»)
            // é€™æ˜¯å¾ T3(ä½) åˆ° T4(é«˜) é€™ä¸€æ®µåå½ˆçš„ 1/2
            // å…¬å¼: p3 + (p4 - p3) * 0.5
            const halfLevel = p3 + (p4 - p3) * 0.5;

            return {
                entry: v.breakout,
                target: target,
                stop: v.low,
                
                // èµ°å‹¢å„ªåŒ–ï¼šé»ç·šåˆä¸€ï¼Œå®Œç¾æ¼”ç¹¹è“„åŠ›çªç ´
                // T0: èµ·å§‹
                // T1: å‰ä½ (â˜…è²¼æ”¯æ’)
                // T2: å‰é«˜ (â˜…è²¼å£“åŠ›)
                // T3: æœ€ä½ (â˜…è²¼æ”¯æ’)
                // T4: è§¸å£“ (â˜…è²¼å£“åŠ› - æº–å‚™è“„åŠ›)
                // T5: 1/2 (â˜…è¸©ç´«ç·š - Higher Low)
                // T6: çªç ´ (è—é»)
                // T7: é”æ¨™
                points: [
                    getHighLine(0.5),   // T0
                    p1,                 // T1: å‰ä½
                    p2,                 // T2: å‰é«˜
                    p3,                 // T3: æœ€ä½é»
                    p4,                 // T4: è§¸ç¢°å£“åŠ›ç·š (High)
                    halfLevel,          // T5: å›æ¸¬ 1/2 (Higher Low)
                    p6,                 // T6: çªç ´å£“åŠ›ç·š (è—é»)
                    p6 + v.amp * 0.2,   // T7: è¡é«˜
                    p6,                 // T8: å›æ¸¬çªç ´é»
                    target              // T9: é”æ¨™
                ],
                
                trendlines: [
                    // A. ä¸Šæ–¹å£“åŠ›ç·š (é€£æ¥ T2 -> T4 -> T6)
                    { 
                        x1: 1.5, x2: 7, 
                        y1: getHighLine(1.5), y2: getHighLine(7), 
                        color: '#2ecc71', 
                        label: 'å‘ä¸‹å£“åŠ›' 
                    },
                    
                    // B. ä¸‹æ–¹æ”¯æ’ç·š (é€£æ¥ T1 -> T3)
                    { 
                        x1: 0.5, x2: 4, 
                        y1: getLowLine(0.5), y2: getLowLine(4), 
                        color: '#2ecc71', 
                        label: 'å‘ä¸‹æ”¯æ’ (é™¡)' 
                    },
                    
                    // C. 1/2 é—œéµè“„åŠ›ä½ (ç´«è‰²)
                    // ç•«åœ¨ T4 å’Œ T6 ä¹‹é–“ï¼Œä½æ–¼å£“åŠ›ç·šä¸‹æ–¹
                    { x1: 4, x2: 6, y1: halfLevel, y2: halfLevel, color: '#9b59b6', label: '1/2 è“„åŠ›' },

                    // D. ç›®æ¨™åƒ¹ç·š
                    { x1: 8, x2: 9, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // E. æ¸¬å¹…è™›ç·š (å·¦å´ H)
                    { x1: 3, x2: 3, y1: p3, y2: getHighLine(3), color: '#3498db', dashed: true, label: 'æŒ¯å¹…H' },
                    
                    // F. æ¸¬å¹…è™›ç·š (å³å´æŠ•å°„)
                    { x1: 8.5, x2: 8.5, y1: p6, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 6, // T6
                        yValue: p6,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    oneBarBottom: {
        name: "12. ä¸€å­—åº• (One-Bar Bottom) - æ©«ç›¤çˆ†ç™¼",
        type: "bull",
        inputs: [
            { id: "boxHigh", label: "ç›¤æ•´å€é«˜é» (å£“åŠ›)", default: 35 },
            { id: "boxLow", label: "ç›¤æ•´å€ä½é» (æ”¯æ’)", default: 30 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹é€²å…¥ä¸€å€‹æ¥µåº¦ç‹¹çª„çš„ç®±é«”ï¼Œå¦‚æ­»æ°´èˆ¬æ³¢å‹•æ¥µå°ã€‚åœ–ä¸­å¼·èª¿<strong>ã€Œç‹¹å¹…ç›¤æ•´ 2 å€‹æœˆä»¥ä¸Šã€</strong>ï¼Œæ™‚é–“è¶Šé•·ï¼Œç±Œç¢¼æ›æ‰‹è¶Šä¹¾æ·¨ï¼Œçˆ†ç™¼åŠ›è¶Šå¼·ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>é€™æ˜¯ä¸€å€‹è€åŠ›æˆ°ã€‚åœ–ä¸­è—é»ç‚ºçªç ´è¨Šè™Ÿï¼Œçªç ´å¾Œå¸¸ä¼´éš¨<strong>å›æ¸¬ç®±é ‚</strong>(ç´…è‰²ç®­é ­è™•)ï¼Œé€™æ˜¯æœ€å¾Œçš„ä¸Šè»Šæ©Ÿæœƒã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è§€æœ›ï¼šç›¤æ•´æœŸé–“è³‡é‡‘æ•ˆç‡æ¥µä½ï¼Œä¸å»ºè­°é€²å ´ã€‚<br>
            2. è²·é»ï¼šå¸¶é‡çªç ´ç®±é«”ä¸Šç·£(è—é»)ã€‚<br>
            3. æ¸¬å¹…ï¼šæ©«ç›¤æœ‰å¤šé•·ï¼Œè±èµ·ä¾†å°±æœ‰å¤šé«˜ (é•·æœŸç›®æ¨™)ã€‚
        `,
        calc: (v) => {
            const range = v.boxHigh - v.boxLow;
            const target = v.boxHigh + range * 2; // æ©«ç›¤è¶Šä¹…ï¼Œæ¼²å¹…é€šå¸¸è¶Šå¤§
            
            return {
                entry: v.boxHigh,
                target: target,
                stop: v.boxLow,
                
                // èµ°å‹¢å„ªåŒ–ï¼šæ¨¡æ“¬æ¼«é•·çš„ "2å€‹æœˆ" ç›¤æ•´
                // ä½¿ç”¨å¤šå€‹é»ä½ä¾†å›éœ‡ç›ªï¼Œä¸”ç²¾ç¢ºå°é½Šä¸Šä¸‹ç·£
                points: [
                    v.boxHigh + range * 2,   // T0: ä¸‹è·Œå…¥å ´
                    v.boxLow,                // T1: è¸©åº• (â˜…å°é½Š)
                    v.boxHigh,               // T2: è§¸é ‚ (â˜…å°é½Š)
                    v.boxLow,                // T3: è¸©åº• (â˜…å°é½Š)
                    v.boxHigh,               // T4: è§¸é ‚ (â˜…å°é½Š)
                    v.boxLow,                // T5: è¸©åº• (â˜…å°é½Š)
                    v.boxHigh,               // T6: è§¸é ‚ (â˜…å°é½Š)
                    v.boxLow,                // T7: è¸©åº• (â˜…å°é½Š)
                    v.boxHigh,               // T8: è§¸é ‚ (â˜…å°é½Š)
                    v.boxLow,                // T9: è¸©åº• (â˜…å°é½Š)
                    v.boxHigh,               // T10: è§¸é ‚ (æº–å‚™çªç ´)
                    v.boxLow + range * 0.5,  // T11: æœ€å¾Œè¹²è·³ (è“„åŠ›)
                    v.boxHigh,               // T12: çªç ´ (è—é»)
                    v.boxHigh + range * 0.3, // T13: è¡é«˜
                    v.boxHigh,               // T14: å›æ¸¬ç®±é ‚ (â˜…ç²¾ç¢ºæ”¯æ’ç¢ºèª)
                    target                   // T15: å™´å‡ºé”æ¨™
                ],
                
                trendlines: [
                    // A. ç®±é«”ä¸Šç·£ (å£“åŠ›) - å»¶ä¼¸è¦†è“‹æ•´å€‹ç›¤æ•´å€
                    { 
                        x1: 1, x2: 12, 
                        y1: v.boxHigh, y2: v.boxHigh, 
                        color: '#2ecc71', 
                        label: 'ç®±é«”å£“åŠ›' 
                    },
                    
                    // B. ç®±é«”ä¸‹ç·£ (æ”¯æ’)
                    { 
                        x1: 1, x2: 12, 
                        y1: v.boxLow, y2: v.boxLow, 
                        color: '#2ecc71', 
                        label: 'ç®±é«”æ”¯æ’' 
                    },

                    // C. ç›®æ¨™åƒ¹ç·š
                    { x1: 14, x2: 15, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },
                    
                    // D. æ™‚é–“æ¨™ç¤º (æ¨¡æ“¬åœ–ä¸­çš„æ–‡å­—æ¦‚å¿µ)
                    { 
                        x1: 2, x2: 10, 
                        y1: (v.boxHigh + v.boxLow)/2, y2: (v.boxHigh + v.boxLow)/2, 
                        color: 'rgba(155, 89, 182, 0.5)', 
                        dashed: true, 
                        label: 'ç›¤æ•´2å€‹æœˆä»¥ä¸Š' 
                    }
                ],
                
                // è—è‰²çªç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 12, // T12
                        yValue: v.boxHigh,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
    diamondBottom: {
        name: "13. è±å½¢åº• (Diamond Bottom) - æ··äº‚è½‰æŠ˜",
        type: "bull",
        inputs: [
            { id: "breakout", label: "çªç ´é»åƒ¹æ ¼", default: 50 },
            { id: "midHigh", label: "è±å½¢æœ€é«˜é»", default: 55 },
            { id: "midLow", label: "è±å½¢æœ€ä½é»", default: 35 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>é€™æ˜¯ä¸€å€‹çµåˆã€Œæ“´å¼µå–‡å­ã€èˆ‡ã€Œå°ç¨±ä¸‰è§’ã€çš„ç¨€æœ‰å‹æ…‹ï¼Œå½¢ç‹€å¦‚é‘½çŸ³ã€‚ä»£è¡¨å¸‚å ´å¾ã€Œæ¥µåº¦æ··äº‚(å·¦åŠ)ã€è½‰ç‚ºã€Œå†·éœè§€æœ›(å³åŠ)ã€ï¼Œæ˜¯å¼·çƒˆåè½‰è¨Šè™Ÿã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­å³å´é¡¯ç¤ºï¼Œçªç ´å³ä¸Šæ–¹çš„å£“åŠ›ç·šå¾Œï¼Œå¸¸æœ‰<strong>ã€Œå›æ¸¬ã€</strong>å‹•ä½œ(ç´…è‰²è™›ç·šç®­é ­)ã€‚ç›®æ¨™åƒ¹è¨ˆç®—æ–¹å¼ç‚ºã€Œè±å½¢æœ€å¯¬è™•ã€çš„å‚ç›´é«˜åº¦ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è§€æœ›ï¼šè±å½¢å…§éƒ¨å¤šç©ºä¸æ˜ï¼Œåˆ‡å‹¿è¿½åƒ¹ã€‚<br>
            2. è²·é»ï¼šå¸¶é‡çªç ´å³ä¸Šæ–¹å£“åŠ›ç·š(è—é»)ã€‚<br>
            3. æ¸¬å¹…ï¼šçªç ´é» + è±å½¢ä¸­é–“æœ€å¤§æŒ¯å¹…ã€‚
        `,
        calc: (v) => {
            const height = v.midHigh - v.midLow;
            const p_center = (v.midHigh + v.midLow) / 2;

            // ==========================================
            // ğŸ“ è±å½¢å¹¾ä½•é‹ç®— (è·Œå‹¢å…¥å ´ç‰ˆ)
            // ==========================================

            // å®šç¾©æ™‚é–“è»¸
            // å¹¾ä½•èµ·é»è¨­åœ¨ t=0.5 (è®“ T0 å¯ä»¥ç•«åœ¨ t=0 çš„é«˜è™•)
            const t_geom_start = 0.5; 
            const t_top = 3;    // T3: é ‚é»
            const t_btm = 4;    // T4: åº•é»
            const t_conv = 11;  // æ”¶æ–‚é»

            // --- 1. å·¦å´æ“´å¼µæ–¹ç¨‹å¼ (å¾ 0.5 é–‹å§‹) ---
            // å·¦ä¸Šç·š: (0.5, p_center) -> (3, midHigh)
            const m_lu = (v.midHigh - p_center) / (t_top - t_geom_start);
            const getLeftUpper = (t) => p_center + m_lu * (t - t_geom_start);

            // å·¦ä¸‹ç·š: (0.5, p_center) -> (4, midLow)
            const m_ld = (v.midLow - p_center) / (t_btm - t_geom_start);
            const getLeftLower = (t) => p_center + m_ld * (t - t_geom_start);

            // --- 2. å³å´æ”¶æ–‚æ–¹ç¨‹å¼ ---
            // å³ä¸Šç·š: (3, midHigh) -> (11, p_center)
            const m_ru = (p_center - v.midHigh) / (t_conv - t_top);
            const getRightUpper = (t) => v.midHigh + m_ru * (t - t_top);

            // å³ä¸‹ç·š: (4, midLow) -> (11, p_center)
            const m_rd = (p_center - v.midLow) / (t_conv - t_btm);
            const getRightLower = (t) => v.midLow + m_rd * (t - t_btm);


            // --- 3. è¨ˆç®—é»ä½ ---
            
            // T0: å…¥å ´é» (äººç‚ºè¨­å®šæ¯” T1 é«˜ï¼Œæ¨¡æ“¬è·Œå‹¢)
            // ä¸ä»£å…¥æ–¹ç¨‹å¼ï¼Œç›´æ¥è¨­åœ¨ LeftUpper(1) ä¹‹ä¸Š
            const p1 = getLeftUpper(1);
            const p0 = p1 + (v.midHigh - v.midLow) * 0.3; 

            // å…¶ä»–é»ä½ä»£å…¥æ–¹ç¨‹å¼ (ä¿æŒå°é½Š)
            const p2 = getLeftLower(2);
            const p3 = v.midHigh;
            const p4 = v.midLow;
            const p5 = getRightUpper(5); // T5: Lower High
            const p6 = getRightLower(6); // T6: Higher Low
            const p_entry = getRightUpper(7); // Entry
            const target = p_entry + height;
            const p_retest = getRightUpper(7.5);

            return {
                entry: p_entry,
                target: target,
                stop: v.midLow,
                
                // points å°æ‡‰:
                // T0: å…¥å ´ (é«˜)
                // T1: å·¦ä¸Šç¢°ç·š
                // T2: å·¦ä¸‹ç¢°ç·š
                // T3: é ‚
                // T4: åº•
                // T5: å³é«˜ (è²¼ç·š)
                // T6: å³ä½ (è²¼ç·š)
                // T7: çªç ´ (è²¼ç·š)
                points: [
                    p0,             // T0: â˜…é«˜æ–¼ T1 (è·Œå‹¢å…¥å ´)
                    p1,             // T1: â˜…å°é½Šå·¦ä¸Š
                    p2,             // T2: â˜…å°é½Šå·¦ä¸‹
                    p3,             // T3: â˜…å°é½Šé ‚
                    p4,             // T4: â˜…å°é½Šåº•
                    p5,             // T5: â˜…å°é½Šå³ä¸Š
                    p6,             // T6: â˜…å°é½Šå³ä¸‹
                    p_entry,        // T7: â˜…å°é½Šå³ä¸Š (çªç ´)
                    p_entry + height*0.2, 
                    p_retest,       // T9: å›æ¸¬
                    target          // T10
                ],
                
                trendlines: [
                    // A. å·¦ä¸Šé‚Šç•Œ (å¾ 0.5 é–‹å§‹ç•«)
                    { x1: 0.5, x2: 3, y1: p_center, y2: v.midHigh, color: '#2ecc71', label: 'æ“´å¼µ' },
                    
                    // B. å·¦ä¸‹é‚Šç•Œ (å¾ 0.5 é–‹å§‹ç•«)
                    { x1: 0.5, x2: 4, y1: p_center, y2: v.midLow, color: '#2ecc71' },
                    
                    // C. å³ä¸Šé‚Šç•Œ
                    { x1: 3, x2: 8, y1: v.midHigh, y2: getRightUpper(8), color: '#2ecc71', label: 'æ”¶æ–‚å£“åŠ›' },
                    
                    // D. å³ä¸‹é‚Šç•Œ
                    { x1: 4, x2: 8, y1: v.midLow, y2: getRightLower(8), color: '#2ecc71', label: 'æ”¶æ–‚æ”¯æ’' },

                    // E. ç›®æ¨™åƒ¹
                    { x1: 8, x2: 9, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // F. æ¸¬å¹… H
                    { x1: 3.5, x2: 3.5, y1: v.midLow, y2: v.midHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. æŠ•å°„ H
                    { x1: 7.5, x2: 7.5, y1: p_entry, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 7, 
                        yValue: p_entry,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },

    // ------------------------------------------
    // B. æ•´ç†å‹æ…‹ (neutral)
    // ------------------------------------------
    box: {
        name: "1. ç®±å‹æ•´ç† (Rectangle) - å€é–“éœ‡ç›ª",
        type: "neutral", // æ”¹ç‚ºä¸­æ€§ï¼Œä»£è¡¨æ–¹å‘æœªå®š
        inputs: [
            { id: "boxHigh", label: "ç®±é«”é ‚éƒ¨ (å£“åŠ›)", default: 50 },
            { id: "boxLow", label: "ç®±é«”åº•éƒ¨ (æ”¯æ’)", default: 40 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹é™åˆ¶åœ¨å…©æ¢å¹³è¡Œç·šä¹‹é–“ï¼Œå¤šç©ºåŠ›é‡æš«æ™‚å‡è¡¡ã€‚åœ–å·¦é¡¯ç¤ºè‚¡åƒ¹æ€¥è·Œå¾Œé€²å…¥æ•´ç†ï¼Œä½†å¾Œå¸‚æ–¹å‘æœªå®šã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤å‹æ…‹ç‚ºã€Œä¸­æ€§ã€ã€‚åœ–ä¸­å³å´é¡¯ç¤ºäº†<strong>é›™å‘åŠ‡æœ¬</strong>ï¼šå¯èƒ½å‘ä¸Šçªç ´ï¼Œä¹Ÿå¯èƒ½å‘ä¸‹ç ´åº•ã€‚å‹™å¿…ç­‰å¾…æ–¹å‘ç¢ºèªã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (é›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹åŠ‡æœ¬</strong>ï¼šçªç ´ç®±é ‚(è—é»)é€²å ´ã€‚ç›®æ¨™åƒ¹ = ç®±é ‚ + ç®±é«˜(H)ã€‚<br>
            2. <strong>ç©ºæ–¹åŠ‡æœ¬</strong>ï¼šè·Œç ´ç®±åº•æ”¾ç©ºã€‚ç›®æ¨™åƒ¹ = ç®±åº• - ç®±é«˜(H)ã€‚<br>
            3. æ¸¬å¹…ï¼šä¸è«–æ–¹å‘ï¼Œæ»¿è¶³é»çš†ç‚ºã€Œä¸€å€ç®±é«”é«˜åº¦ã€ã€‚
        `,
        calc: (v) => {
            const height = v.boxHigh - v.boxLow;
            const targetBull = v.boxHigh + height; // å¤šæ–¹ç›®æ¨™
            const targetBear = v.boxLow - height;  // ç©ºæ–¹ç›®æ¨™
            
            // ==========================================
            // ğŸ“ é›™å‘å¹¾ä½•é‹ç®—
            // ==========================================
            
            return {
                entry: v.boxHigh, // é è¨­é¡¯ç¤ºå¤šæ–¹çªç ´é»
                target: targetBull,
                stop: v.boxLow,
                
                // èµ°å‹¢å„ªåŒ–ï¼šæ€¥è·Œå…¥å ´ -> ç®±å…§éœ‡ç›ª -> ä¾†åˆ°é—œéµæ±ºç­–é»
                // T0: å…¥å ´
                // T1~T5: ç¢°è§¸ä¸Šä¸‹ç·£ (å¹¾ä½•å°é½Š)
                // T6: æ±ºç­–é» (Decision Point)
                // T7: å¤šæ–¹è·¯å¾‘ (å¯¦ç·š)
                // T8: å¤šæ–¹é”æ¨™
                points: [
                    v.boxHigh + height * 0.8, // T0: æ€¥è·Œå…¥å ´
                    v.boxLow,                 // T1: æ¸¬æ”¯æ’ (â˜…å°é½Š)
                    v.boxHigh,                // T2: æ¸¬å£“åŠ› (â˜…å°é½Š)
                    v.boxLow,                 // T3: æ¸¬æ”¯æ’ (â˜…å°é½Š)
                    v.boxHigh,                // T4: æ¸¬å£“åŠ› (â˜…å°é½Š)
                    v.boxLow,                 // T5: æ¸¬æ”¯æ’ (â˜…å°é½Š)
                    (v.boxHigh + v.boxLow)/2, // T6: å›åˆ°ä¸­é–“ (è§€æœ›æœŸ)
                    v.boxHigh,                // T7: æº–å‚™æ¸¬è©¦ç®±é ‚
                    v.boxHigh + height * 0.3, // T8: å‡å®šå‘ä¸Šçªç ´ (ç¤ºæ„)
                    targetBull                // T9: é”æ¨™
                ],
                
                trendlines: [
                    // A. ç®±é«”ä¸Šç·£ (å£“åŠ›)
                    { x1: 1, x2: 7, y1: v.boxHigh, y2: v.boxHigh, color: '#2ecc71', label: 'ç®±é ‚å£“åŠ›' },
                    
                    // B. ç®±é«”ä¸‹ç·£ (æ”¯æ’)
                    { x1: 1, x2: 7, y1: v.boxLow, y2: v.boxLow, color: '#2ecc71', label: 'ç®±åº•æ”¯æ’' },

                    // C. å¤šæ–¹ç›®æ¨™ç·š (ä¸Šæ–¹)
                    { x1: 7, x2: 9, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'å¤šæ–¹ç›®æ¨™ (+H)' },

                    // D. ç©ºæ–¹ç›®æ¨™ç·š (ä¸‹æ–¹)
                    { x1: 7, x2: 9, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç©ºæ–¹ç›®æ¨™ (-H)' },

                    // E. æ¸¬å¹…è™›ç·š (ç®±å…§é«˜åº¦ H)
                    { x1: 3.5, x2: 3.5, y1: v.boxLow, y2: v.boxHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // F. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š)
                    { x1: 7, x2: 7, y1: v.boxHigh, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // G. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    // å¾ç®±åº•ç•«åˆ°ç©ºæ–¹ç›®æ¨™ï¼Œæ¨¡æ“¬åœ–ç‰‡ä¸­çš„å‘ä¸‹ç®­é ­
                    { x1: 7, x2: 7, y1: v.boxLow, y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' },

                    // H. ç©ºæ–¹èµ°å‹¢æ¨¡æ“¬ (ç´…è‰²è™›ç·š)
                    // ç‚ºäº†è®“ä½¿ç”¨è€…çœ‹åˆ°å¦ä¸€ç¨®å¯èƒ½ï¼Œæˆ‘å€‘ç•«ä¸€æ¢éš±ç´„çš„è·Œç ´ç·š
                    { x1: 6, x2: 6.5, y1: (v.boxHigh+v.boxLow)/2, y2: v.boxLow, color: 'rgba(231, 76, 60, 0.5)', dashed: true },
                    { x1: 6.5, x2: 7.5, y1: v.boxLow, y2: targetBear, color: 'rgba(231, 76, 60, 0.5)', dashed: true }
                ],
                
                // æ¨™ç¤ºå…©å€‹é—œéµçªç ´é»
                extraMarkers: [
                    // å¤šæ–¹çªç ´é» (è—é»)
                    {
                        type: 'point',
                        xValue: 7.2, // ç´„ç•¥ä½ç½®
                        yValue: v.boxHigh,
                        backgroundColor: '#3498db',
                        radius: 5,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // ç©ºæ–¹è·Œç ´é» (ç°é»/ç´…é»ç¤ºæ„)
                    {
                        type: 'point',
                        xValue: 6.5, 
                        yValue: v.boxLow,
                        backgroundColor: '#95a5a6', // ç°è‰²ä»£è¡¨å¦ä¸€ç¨®å¯èƒ½
                        radius: 4,
                        borderColor: 'white',
                        borderWidth: 1
                    }
                ]
            };
        }
    },
	descTriPrevDrop: {
        name: "2. å‰è·Œä¸‰è§’å½¢ (Descending Triangle/Wedge) - è·Œå‹¢æ”¶æ–‚",
        type: "bear", // å®šç¾©ç‚ºä¸­æ€§åç©ºï¼Œç­‰å¾…æ–¹å‘
        inputs: [
            { id: "high", label: "é–‹å£é«˜é» (å£“åŠ›)", default: 50 },
            { id: "low", label: "é–‹å£ä½é» (æ”¯æ’)", default: 35 },
            { id: "duration", label: "æ”¶æ–‚é•·åº¦", default: 8 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹ç¶“æ­·ä¸€æ®µæ€¥è·Œå¾Œï¼Œæ³¢å¹…é–‹å§‹ç¸®å°ã€‚é«˜é»è¶Šä¾†è¶Šä½(å£“åŠ›ç·šä¸‹é™)ï¼Œä½é»ä¹Ÿç·©æ­¥èµ°ä½æˆ–æŒå¹³ï¼Œå½¢æˆæ”¶æ–‚ä¸‰è§’å½¢ã€‚é€™ä»£è¡¨å¸‚å ´æ­£åœ¨è§€æœ›ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åç©ºã€</strong>å‹æ…‹ã€‚åœ–ä¸­é¡¯ç¤ºçªç ´æ–¹å‘æœªå®šï¼Œå› æ­¤å¿…é ˆè¨­å®š<strong>ã€Œé›™å‘åŠ‡æœ¬ã€</strong>ã€‚ç›´åˆ°å¸¶é‡çªç ´å…¶ä¸­ä¸€æ¢ç·šï¼Œæ–¹å‘æ‰ç®—ç¢ºç«‹ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (é›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹ç›®æ¨™</strong>ï¼šçªç ´ä¸Šæ–¹å£“åŠ›ç·šé€²å ´ã€‚ç›®æ¨™ = çªç ´é» + é–‹å£é«˜åº¦(H)ã€‚<br>
            2. <strong>ç©ºæ–¹ç›®æ¨™</strong>ï¼šè·Œç ´ä¸‹æ–¹æ”¯æ’ç·šé€²å ´ã€‚ç›®æ¨™ = è·Œç ´é» - é–‹å£é«˜åº¦(H)ã€‚<br>
            3. æ¸¬å¹…ï¼šä¾æ“šåœ–ä¸­è—è‰²è™›ç·šï¼Œå–ä¸‰è§’å½¢æœ€å·¦å´é–‹å£çš„é«˜åº¦åšç­‰å¹…æ¸¬é‡ã€‚
        `,
        calc: (v) => {
            const height = v.high - v.low; // é–‹å£ H
            
            // æ™‚é–“è»¸
            const t_break = 7; // æ”¶æ–‚æœ«ç«¯
            const t_target = v.duration - 1;

            // 1. å»ºç«‹å¹¾ä½•æ–¹ç¨‹å¼
            // è¨­æ”¶æ–‚æœ«ç«¯é–‹å£å‰© 20%
            const spread_end = height * 0.2;
            const mid = (v.high + v.low) / 2;
            const res_end = mid + spread_end / 2;
            const sup_end = mid - spread_end / 2;
            
            // å£“åŠ›ç·š (Top)
            const m_top = (res_end - v.high) / t_break;
            const getTopLine = (t) => v.high + m_top * t;

            // æ”¯æ’ç·š (Btm)
            const m_btm = (sup_end - v.low) / t_break;
            const getBtmLine = (t) => v.low + m_btm * t;

            // 2. è¨ˆç®—ç›®æ¨™åƒ¹
            const breakPrice = mid; 
            const targetBull = breakPrice + height;
            const targetBear = breakPrice - height;

            // 3. å»ºæ§‹ K ç·š
            let chartPoints = [];
            
            // å‰è·Œæ®µ (å¾ä¸Šè·Œä¸‹ä¾†)
            chartPoints[0] = v.high + (height * 0.5); 
            
            // æ”¶æ–‚éœ‡ç›ª (å¹¾ä½•å°é½Š)
            chartPoints[1] = v.low;         // T1: ç¢°åº•
            chartPoints[2] = getTopLine(2); // T2: ç¢°é ‚
            chartPoints[3] = getBtmLine(3); // T3: ç¢°åº•
            chartPoints[4] = getTopLine(4); // T4: ç¢°é ‚
            chartPoints[5] = getBtmLine(5); // T5: ç¢°åº•
            chartPoints[6] = getTopLine(6); // T6: ç¢°é ‚
            chartPoints[7] = breakPrice;    // T7: æ”¶æ–‚ä¸­å¿ƒ

            // å¡«å……ç©ºç™½ä»¥é¡¯ç¤ºé æ¸¬ç·š
            for (let i = 8; i <= t_target; i++) {
                chartPoints.push(null); 
            }

            return {
                entry: breakPrice, // ç³»çµ±é‹ç®—ç”¨ï¼Œä½†ä¸é¡¯ç¤º Marker
                target: targetBear,
                stop: sup_end,
                
                points: chartPoints,
                
                trendlines: [
                    // A. å£“åŠ›ç·š
                    { x1: 1, x2: t_break, y1: v.low, y2: sup_end, color: '#2ecc71', label: 'æ”¶æ–‚æ”¯æ’' },
                    // ç‚ºäº†ç¾è§€ï¼Œå¾ T0 ä¹‹å¾Œé–‹å§‹ç•«å£“åŠ›
                    { x1: 0.5, x2: t_break, y1: v.high, y2: res_end, color: '#2ecc71', label: 'æ”¶æ–‚å£“åŠ›' },

                    // B. å‰è·Œè¶¨å‹¢ç·š (T0 -> T1)
                    { x1: 0, x2: 1, y1: chartPoints[0], y2: v.low, color: '#2ecc71', label: 'å‰è·Œæ®µ' },

                    // C. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // D. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // E. æ¸¬å¹… H
                    { x1: 1, x2: 1, y1: v.low, y2: v.high, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // F. å¤šæ–¹è·¯å¾‘ (è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // G. ç©ºæ–¹è·¯å¾‘ (è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´' }
                ],
                
                extraMarkers: [
                    // â˜… ç§»é™¤äº†æ±ºç­–é» (Entry Point)
                    
                    // 1. å¤šæ–¹ç›®æ¨™é» (ç´…è‰²)
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    // 2. ç©ºæ–¹ç›®æ¨™é» (ç¶ è‰²)
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
    descRightTri: {
        name: "3. ä¸‹è·Œç›´è§’ä¸‰è§’å½¢ (Descending Triangle) - è³£å£“æ¸¬è©¦",
        type: "bear", // ä¸­æ€§åç©ºå‹æ…‹
        inputs: [
            { id: "high", label: "é–‹å£é«˜é» (èµ·è·Œ)", default: 50 },
            { id: "flatLow", label: "æ°´å¹³æ”¯æ’ (åº•)", default: 35 },
            { id: "duration", label: "æ”¶æ–‚é•·åº¦", default: 8 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>é€™æ˜¯ä¸€å€‹ã€Œç©ºæ–¹æ­¥æ­¥é€²é€¼ã€çš„å‹æ…‹ã€‚ä¸‹æ–¹æ”¯æ’æ˜¯ä¸€æ¢æ°´å¹³ç·š(å¤šé ­é˜²å®ˆ)ï¼Œä½†ä¸Šæ–¹é«˜é»ä¸æ–·é™ä½(ç©ºæ–¹å£“åƒ¹)ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åç©ºã€</strong>å‹æ…‹ã€‚é›–ç„¶åç‚ºä¸‹è·Œä¸‰è§’ï¼Œä½†è‹¥æ°´å¹³æ”¯æ’ä¸ç ´ï¼Œå¸‚å ´å¯èƒ½åè½‰ã€‚åœ–ä¸­è—è‰²è™›ç·šé¡¯ç¤ºï¼Œç„¡è«–æ˜¯å¾€ä¸Šçªç ´æˆ–å¾€ä¸‹è·Œç ´ï¼Œ<strong>ç›®æ¨™åƒ¹çš†ç‚ºä¸€å€‹é–‹å£é«˜åº¦(H)</strong>ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (é›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹åŠ‡æœ¬</strong>ï¼šå¸¶é‡çªç ´ä¸‹é™å£“åŠ›ç·šã€‚ç›®æ¨™ = çªç ´é» + é–‹å£é«˜åº¦ã€‚<br>
            2. <strong>ç©ºæ–¹åŠ‡æœ¬</strong>ï¼šæ”¶ç›¤è·Œç ´æ°´å¹³æ”¯æ’ç·šã€‚ç›®æ¨™ = æ°´å¹³ç·š - é–‹å£é«˜åº¦ã€‚<br>
            3. è§€æœ›ï¼šåœ¨ä¸‰è§’å½¢æ”¶æ–‚æœ«ç«¯(æ±ºç­–é»)å‰ï¼Œåˆ‡å‹¿é‡å€‰æŠ¼æ³¨ã€‚
        `,
        calc: (v) => {
            const height = v.high - v.flatLow; // H
            
            // ==========================================
            // ğŸ“ å¹¾ä½•å°é½Šæ ¸å¿ƒé‹ç®—
            // ==========================================
            
            // è¨­å®šæ±ºç­–é»åœ¨ Index 7 (T7)
            const t_break = 7; 
            const t_target = v.duration - 1; // ç•«å¸ƒæœ€å³é‚Š

            // 1. å»ºç«‹å£“åŠ›ç·šæ–¹ç¨‹å¼ (Start -> Break)
            // æ–œç‡ m = (y2 - y1) / (x2 - x1)
            const m_res = (v.flatLow - v.high) / t_break; 
            
            // å‡½æ•¸ï¼šè¼¸å…¥æ™‚é–“ tï¼Œç®—å‡ºå£“åŠ›ç·šä¸Šç²¾ç¢ºçš„åƒ¹æ ¼
            const getResLine = (t) => v.high + m_res * t;

            // 2. è¨ˆç®—ç›®æ¨™åƒ¹
            const breakPrice = v.flatLow; 
            const targetBull = breakPrice + height; 
            const targetBear = breakPrice - height;

            // 3. æ‰‹å‹•æ§‹å»ºå¹¾ä½•å®Œç¾çš„ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // --- å¹¾ä½•ç´„æŸå€ (0 ~ 7) ---
            chartPoints[0] = v.high;          // T0: èµ·è·Œé» (åœ¨ç·šä¸Š)
            chartPoints[1] = v.flatLow;       // T1: æ¸¬åº•
            
            chartPoints[2] = getResLine(2);   // T2: â˜…å¼·åˆ¶å°é½Šå£“åŠ›ç·š
            
            chartPoints[3] = v.flatLow;       // T3: æ¸¬åº•
            chartPoints[4] = v.flatLow;       // T4: ç›¤æ•´æ¸¬åº• (æ‹‰é•·åº•éƒ¨)
            
            chartPoints[5] = getResLine(5);   // T5: â˜…å¼·åˆ¶å°é½Šå£“åŠ›ç·š
            
            chartPoints[6] = v.flatLow;       // T6: æ¸¬åº•
            chartPoints[7] = breakPrice;      // T7: æ±ºç­–é» (æ”¶æ–‚æœ«ç«¯)

            // --- é æ¸¬è·¯å¾‘å€ (8 ~ End) ---
            // ç”¨ null å¡«å……ï¼Œæ’é–‹åœ–è¡¨å¯¬åº¦ä»¥é¡¯ç¤ºè™›ç·š
            for (let i = 8; i <= t_target; i++) {
                chartPoints.push(null); 
            }

            return {
                entry: breakPrice,
                target: targetBear,
                stop: v.high,
                
                points: chartPoints,
                
                trendlines: [
                    // A. ä¸Šæ–¹å£“åŠ›ç·š (é€£æ¥ T0 -> T2 -> T5 -> T7)
                    // ä½¿ç”¨æ•¸å­¸è¨ˆç®—çš„åº§æ¨™ï¼Œä¿è­‰é€£æˆä¸€ç·š
                    { x1: 0, x2: t_break, y1: v.high, y2: v.flatLow, color: '#2ecc71', label: 'ä¸‹é™å£“åŠ›' },
                    
                    // B. ä¸‹æ–¹æ”¯æ’ç·š
                    { x1: 0, x2: t_break, y1: v.flatLow, y2: v.flatLow, color: '#2ecc71', label: 'æ°´å¹³æ”¯æ’' },

                    // C. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // D. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // E. æ¸¬å¹…è™›ç·š (H)
                    { x1: 0.5, x2: 0.5, y1: v.flatLow, y2: v.high, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // F. å¤šæ–¹èµ°å‹¢æ¨¡æ“¬
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´è·¯å¾‘' },
                    
                    // G. ç©ºæ–¹èµ°å‹¢æ¨¡æ“¬
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´è·¯å¾‘' }
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é»
                    {
                        type: 'point',
                        xValue: t_break, 
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™é»
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹ç›®æ¨™'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™é»
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹ç›®æ¨™'
                    }
                ]
            };
        }
    },
	ascTriPrevRise: {
        name: "4. å‰æ¼²ä¸‰è§’å½¢ (Symmetrical Triangle) - ä¸­ç¹¼å†æ¼²",
        type: "bull", // ä¸­æ€§åå¤šå‹æ…‹ï¼Œç­‰å¾…çªç ´
        inputs: [
            { id: "high", label: "é–‹å£é«˜é» (å£“åŠ›)", default: 55 },
            { id: "low", label: "é–‹å£ä½é» (æ”¯æ’)", default: 35 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹ç¶“æ­·ä¸€æ³¢ä¸Šæ¼²å¾Œé€²å…¥ä¼‘æ¯ã€‚é«˜é»é™ä½(å£“åŠ›é™)ã€ä½é»å¢Šé«˜(æ”¯æ’å‡)ï¼Œå¤šç©ºé›™æ–¹åœ¨ä¸€å€‹æ”¶æ–‚çš„ä¸‰è§’å€é–“å…§æ‹‰é‹¸ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>é€™æ˜¯ä¸€å€‹å…¸å‹çš„<strong>ä¸­æ€§åå¤š</strong>ã€‚åœ–ä¸­ç°è‰²é»ç‚ºæ±ºç­–é»ï¼Œé›–ç„¶å‰å‹¢æ˜¯æ¼²çš„ï¼Œä½†æ”¶æ–‚æœ«ç«¯ä»å¯èƒ½å‡ºç¾åè½‰ï¼Œå‹™å¿…è¨­å®š<strong>é›™å‘åŠ‡æœ¬</strong>ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (é›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹(ç´…)</strong>ï¼šå¸¶é‡çªç ´ä¸‹é™å£“åŠ›ç·šã€‚ç›®æ¨™ = çªç ´é» + Hã€‚<br>
            2. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šæ”¶ç›¤è·Œç ´ä¸Šå‡æ”¯æ’ç·šã€‚ç›®æ¨™ = çªç ´é» - Hã€‚<br>
            (H ç‚ºå·¦å´é–‹å£é«˜åº¦)
        `,
        calc: (v) => {
            const height = v.high - v.low; // é–‹å£é«˜åº¦ H
            
            // ==========================================
            // ğŸ“ å¹¾ä½•å°é½Šæ ¸å¿ƒé‹ç®—
            // ==========================================
            
            // æ™‚é–“è»¸è¨­å®š
            // T0: èµ·æ¼²é»
            // T1: é€²å…¥ä¸‰è§’å½¢çš„ç¬¬ä¸€å€‹é«˜é» (Trend Start)
            // T7: æ±ºç­–é»
            const t_start = 1; // ä¸‰è§’å½¢å¾ T1 é–‹å§‹ç®—
            const t_break = 7; 
            const t_target = v.duration - 1;

            // è¨ˆç®—æ”¶æ–‚ä¸­å¿ƒé»
            const midPoint = (v.high + v.low) / 2;

            // 1. å»ºç«‹å…©æ¢æ–¹ç¨‹å¼
            // å£“åŠ›ç·š (Top): å¾ (1, high) åˆ° (7, midPoint)
            const m_top = (midPoint - v.high) / (t_break - t_start);
            const getTopLine = (t) => v.high + m_top * (t - t_start);

            // æ”¯æ’ç·š (Btm): å¾ (1, low) åˆ° (7, midPoint)
            const m_btm = (midPoint - v.low) / (t_break - t_start);
            const getBtmLine = (t) => v.low + m_btm * (t - t_start);

            // 2. è¨ˆç®—é›™å‘ç›®æ¨™åƒ¹
            const breakPrice = midPoint;
            const targetBull = breakPrice + height;
            const targetBear = breakPrice - height;

            // 3. å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // T0: èµ·æ¼²é» (ä½æ–¼ T1ï¼Œç‡Ÿé€ ä¸Šæ¼²å…¥å ´æ°£å‹¢)
            // è¨­å®šç‚ºæ¯” low å†ä½ä¸€é»çš„ä½ç½®
            chartPoints[0] = v.low - (height * 0.3); 

            // T1: ä¸‰è§’å½¢é ‚é» (é«˜)
            chartPoints[1] = v.high;
            
            // T2: ä¸‰è§’å½¢åº•é» (ä½) - å°é½Šæ”¯æ’ç·š
            chartPoints[2] = getBtmLine(2);
            
            // T3: Lower High - å°é½Šå£“åŠ›ç·š
            chartPoints[3] = getTopLine(3);
            
            // T4: Higher Low - å°é½Šæ”¯æ’ç·š
            chartPoints[4] = getBtmLine(4);
            
            // T5: Lower High - å°é½Šå£“åŠ›ç·š
            chartPoints[5] = getTopLine(5);
            
            // T6: Higher Low - å°é½Šæ”¯æ’ç·š
            chartPoints[6] = getBtmLine(6);
            
            // T7: æ±ºç­–é» (ä¸­å¿ƒ)
            chartPoints[7] = breakPrice;

            // å¡«å……é æ¸¬å€
            for (let i = 8; i <= t_target; i++) {
                chartPoints.push(null); 
            }

            return {
                entry: breakPrice,
                target: targetBull,
                stop: v.low,
                
                points: chartPoints,
                
                trendlines: [
                    // A. ä¸Šæ–¹å£“åŠ›ç·š (å¾ T1 é–‹å§‹ç•«)
                    { x1: 1, x2: t_break, y1: v.high, y2: midPoint, color: '#2ecc71', label: 'æ”¶æ–‚å£“åŠ›' },
                    
                    // B. ä¸‹æ–¹æ”¯æ’ç·š (å¾ T1 çš„ x åº§æ¨™é–‹å§‹å°é½Šè¦–è¦ºï¼Œå¯¦éš›é€£ç·šæ˜¯ T2, T4...)
                    // ç‚ºäº†ç¾è§€ï¼Œæˆ‘å€‘å¾ x=1 é–‹å§‹ç•«ï¼Œé€™æœƒå½¢æˆä¸€å€‹æ¨™æº–é–‹å£
                    { x1: 1, x2: t_break, y1: v.low, y2: midPoint, color: '#2ecc71', label: 'æ”¶æ–‚æ”¯æ’' },

                    // C. é€²å ´è¶¨å‹¢ç·š (T0 -> T1)
                    { x1: 0, x2: 1, y1: chartPoints[0], y2: v.high, color: '#e74c3c', label: 'å‰æ¼²æ®µ' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹…è™›ç·š (H) - ç•«åœ¨ T1 ä½ç½®
                    { x1: 1, x2: 1, y1: v.low, y2: v.high, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘æ¨¡æ“¬
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´è·¯å¾‘' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘æ¨¡æ“¬
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´è·¯å¾‘' }
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é»
                    {
                        type: 'point',
                        xValue: t_break, 
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™é»
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹ç›®æ¨™'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™é»
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹ç›®æ¨™'
                    }
                ]
            };
        }
    },
	ascRightTri: {
        name: "5. ä¸Šå‡ç›´è§’ä¸‰è§’å½¢ (Ascending Triangle) - å¤šé ­ç·©æ”»",
        type: "bull", // ä¸­æ€§åå¤šç­‰å¾…è¡¨æ…‹
        inputs: [
            { id: "flatHigh", label: "æ°´å¹³å£“åŠ› (é ‚)", default: 50 },
            { id: "low", label: "èµ·æ¼²ä½é» (åº•)", default: 35 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>å¤šé ­æ­¥æ­¥é€²é€¼ï¼Œå›æª”ä½é»ä¸æ–·å¢Šé«˜(ä¸Šå‡æ”¯æ’)ï¼Œä½†ç©ºæ–¹æ­»å®ˆç‰¹å®šåƒ¹ä½(å¹³é ­å£“åŠ›)ã€‚é€™æ˜¯ä¸€å€‹ã€Œè²·æ–¹ç©æ¥µã€è³£æ–¹è¢«å‹•ã€çš„æ”¶æ–‚å‹æ…‹ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åå¤šã€</strong>å‹æ…‹ã€‚åœ–ä¸­<strong>ç°è‰²é»</strong>ç‚ºæ±ºç­–é»ã€‚é›–ç„¶æ­¤å‹æ…‹çœ‹æ¼²æ©Ÿç‡è¼ƒé«˜ï¼Œä½†è‹¥è·Œç ´ä¸Šå‡è¶¨å‹¢ç·šï¼Œä»é ˆåŸ·è¡Œ<strong>ç©ºæ–¹åŠ‡æœ¬</strong>ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (é›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´æ°´å¹³å£“åŠ›ç·šã€‚ç›®æ¨™ = çªç ´é» + Hã€‚<br>
            2. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šè·Œç ´ä¸Šå‡æ”¯æ’ç·šã€‚ç›®æ¨™ = çªç ´é» - Hã€‚<br>
            (H ç‚ºå·¦å´é–‹å£é«˜åº¦)
        `,
        calc: (v) => {
            const height = v.flatHigh - v.low; // é–‹å£é«˜åº¦ H
            
            // ==========================================
            // ğŸ“ å¹¾ä½•å°é½Šæ ¸å¿ƒé‹ç®—
            // ==========================================
            
            // è¨­å®šæ±ºç­–é»åœ¨ Index 7 (T7)
            const t_break = 7; 
            const t_target = v.duration - 1; // ç•«å¸ƒæœ€å³é‚Š

            // 1. å»ºç«‹ä¸Šå‡æ”¯æ’ç·šæ–¹ç¨‹å¼ (Start -> Break)
            // èµ·é» (0, low) -> çµ‚é» (7, flatHigh)
            // æ–œç‡ m = (y2 - y1) / (x2 - x1)
            const m_sup = (v.flatHigh - v.low) / t_break;
            
            // å‡½æ•¸ï¼šè¼¸å…¥æ™‚é–“ tï¼Œç®—å‡ºä¸Šå‡æ”¯æ’ç·šä¸Šç²¾ç¢ºçš„åƒ¹æ ¼
            const getSupLine = (t) => v.low + m_sup * t;

            // 2. è¨ˆç®—é›™å‘ç›®æ¨™åƒ¹
            // åŸºæº–çªç ´åƒ¹ (è¨­å®šç‚ºæ”¶æ–‚æœ«ç«¯çš„æ°´å¹³ä½ï¼Œå³ flatHigh)
            const breakPrice = v.flatHigh; 
            
            const targetBull = breakPrice + height; // ä¸Šæ–¹ç›®æ¨™ (+H)
            const targetBear = breakPrice - height; // ä¸‹æ–¹ç›®æ¨™ (-H)

            // 3. æ‰‹å‹•æ§‹å»ºå¹¾ä½•å®Œç¾çš„ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // --- å¹¾ä½•ç´„æŸå€ (0 ~ 7) ---
            // æ¨¡æ“¬ï¼šä½ -> é«˜ -> é«˜åº• -> é«˜ -> é«˜åº•...
            chartPoints[0] = v.low;           // T0: èµ·æ¼²é» (åœ¨æ”¯æ’ç·šä¸Š)
            chartPoints[1] = v.flatHigh;      // T1: ç¬¬ä¸€æ¬¡æ¸¬é ‚ (Flat)
            
            chartPoints[2] = getSupLine(2);   // T2: â˜…å¼·åˆ¶å°é½Šä¸Šå‡æ”¯æ’ç·š (Higher Low)
            
            chartPoints[3] = v.flatHigh;      // T3: äºŒæ¬¡æ¸¬é ‚ (Flat)
            
            chartPoints[4] = getSupLine(4);   // T4: â˜…å¼·åˆ¶å°é½Šä¸Šå‡æ”¯æ’ç·š (Higher Low)
            
            chartPoints[5] = v.flatHigh;      // T5: ä¸‰æ¬¡æ¸¬é ‚ (Flat)
            
            chartPoints[6] = getSupLine(6);   // T6: â˜…å¼·åˆ¶å°é½Šä¸Šå‡æ”¯æ’ç·š (Higher Low)
            
            chartPoints[7] = breakPrice;      // T7: æ±ºç­–é» (æ”¶æ–‚æœ«ç«¯ï¼Œé ‚åˆ°åº•)

            // --- é æ¸¬è·¯å¾‘å€ (8 ~ End) ---
            // ç”¨ null å¡«å……ï¼Œæ’é–‹åœ–è¡¨å¯¬åº¦ä»¥é¡¯ç¤ºè™›ç·š
            for (let i = 8; i <= t_target; i++) {
                chartPoints.push(null); 
            }

            return {
                entry: breakPrice,
                target: targetBull,
                stop: v.low,
                
                points: chartPoints,
                
                trendlines: [
                    // A. ä¸Šæ–¹å£“åŠ›ç·š (æ°´å¹³)
                    { x1: 0, x2: t_break, y1: v.flatHigh, y2: v.flatHigh, color: '#2ecc71', label: 'æ°´å¹³å£“åŠ›' },
                    
                    // B. ä¸‹æ–¹æ”¯æ’ç·š (ä¸Šå‡)
                    // ä½¿ç”¨å¹¾ä½•åº§æ¨™ï¼Œä¿è­‰ T0, T2, T4, T6 å®Œç¾é€£ç·š
                    { x1: 0, x2: t_break, y1: v.low, y2: v.flatHigh, color: '#2ecc71', label: 'ä¸Šå‡æ”¯æ’' },

                    // C. ç›®æ¨™åƒ¹ç·š-å¤š (ç´…ç·š)
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // D. ç›®æ¨™åƒ¹ç·š-ç©º (ç¶ ç·š)
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // E. æ¸¬å¹…è™›ç·š (H)
                    { x1: 1.5, x2: 1.5, y1: getSupLine(1.5), y2: v.flatHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // F. å¤šæ–¹èµ°å‹¢æ¨¡æ“¬ (ç´…è‰²è™›ç·šè·¯å¾‘)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´è·¯å¾‘' },
                    
                    // G. ç©ºæ–¹èµ°å‹¢æ¨¡æ“¬ (ç¶ è‰²è™›ç·šè·¯å¾‘)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´è·¯å¾‘' }
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é» (ç°è‰²ä¸­æ€§)
                    {
                        type: 'point',
                        xValue: t_break, 
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™é» (ç´…è‰²)
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹ç›®æ¨™'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™é» (ç¶ è‰²)
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹ç›®æ¨™'
                    }
                ]
            };
        }
    },

    // --- å¿«è·Œé£„æ——ç³»åˆ— (Bear Flags) ---
    bearFlagUp: {
        name: "6. å¿«è·Œä¸Šå‡é£„æ—— (Ascending Bear Flag) - æ€¥è·Œç·©æ¼²",
        type: "bear", // ä¸­æ€§åç©º
        inputs: [
            { id: "startHigh", label: "èµ·è·Œé» (é«˜)", default: 60 },
            { id: "flagLow", label: "æ——æ¡¿åº• (ä½)", default: 35 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>å…ˆæ˜¯ä¸€æ®µã€Œæ–·å´–å¼æ€¥è·Œã€(æ——æ¡¿)ï¼Œéš¨å¾Œé€²å…¥å‘å³ä¸Šå‚¾æ–œçš„å¹³è¡Œé€šé“(æ——é¢)ã€‚é€™é€šå¸¸æ˜¯ç©ºæ–¹ä¼‘æ¯çš„ä¸­ç¹¼ç«™ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åç©ºã€</strong>å‹æ…‹ã€‚é€šé“é›–å‘ä¸Šï¼Œä½†é‚£æ˜¯è™›æ¼²ã€‚ä¸»åŠ›éš¨æ™‚å¯èƒ½ç™¼å‹•ä¸‹ä¸€æ³¢æ®ºç›¤ã€‚åœ–ä¸­å±•ç¤ºäº†<strong>ç´…ç¶ é›™å‘åŠ‡æœ¬</strong>ï¼Œç›®æ¨™åƒ¹çš†ä»¥ã€Œæ——æ¡¿é«˜åº¦ã€é€²è¡Œç­‰å¹…æ¸¬è·ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. <strong>ç©ºæ–¹(ç¶  - ä¸»è¶¨å‹¢)</strong>ï¼šè·Œç ´ä¸Šå‡æ”¯æ’ç·šã€‚ç›®æ¨™ = é€šé“ä¸Šç·£ - æ——æ¡¿é•·ã€‚<br>
            2. <strong>å¤šæ–¹(ç´… - åè½‰)</strong>ï¼šçªç ´ä¸Šå‡å£“åŠ›ç·šã€‚ç›®æ¨™ = é€šé“ä¸‹ç·£ + æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            const poleHeight = v.startHigh - v.flagLow; // H
            
            // æ™‚é–“è»¸
            const t_pole_end = 1;   
            const t_break = 7;      // æ±ºç­–é»
            const t_target = v.duration - 1;

            // é€šé“åƒæ•¸
            const channelWidth = poleHeight * 0.25; 
            const slope = (poleHeight * 0.2) / (t_break - t_pole_end);

            // é€šé“æ–¹ç¨‹å¼
            const getBtmLine = (t) => v.flagLow + slope * (t - t_pole_end);
            const getTopLine = (t) => getBtmLine(t) + channelWidth;

            // â˜…é—œéµä¿®æ­£ï¼šç›®æ¨™åƒ¹è¨ˆç®—é‚è¼¯
            // å–å¾—æ±ºç­–é»ç•¶ä¸‹çš„é€šé“ä¸Šä¸‹ç·£åƒ¹æ ¼
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // ç©ºæ–¹ç›®æ¨™ = é€šé“ä¸Šç·£ - H
            let targetBear = getTopLine(t_break-1) - poleHeight;
            if (targetBear < 0) targetBear = 0; // é˜²å‘†

            // å¤šæ–¹ç›®æ¨™ = é€šé“ä¸‹ç·£ + H
            const targetBull = priceBtmAtBreak + poleHeight;

            // æ±ºç­–é» (è²¼åº•)
            const breakPrice = priceBtmAtBreak;

            // å»ºæ§‹ K ç·š
            let chartPoints = [];
            chartPoints[0] = v.startHigh;
            chartPoints[1] = v.flagLow; 
            chartPoints[2] = getTopLine(2);
            chartPoints[3] = getBtmLine(3);
            chartPoints[4] = getTopLine(4);
            chartPoints[5] = getBtmLine(5);
            chartPoints[6] = getTopLine(6);
            chartPoints[7] = breakPrice;      

            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBear,
                stop: getTopLine(t_break),
                
                points: chartPoints,
                
                trendlines: [
                    { x1: 0, x2: 1, y1: v.startHigh, y2: v.flagLow, color: '#2ecc71', label: 'æ——æ¡¿' },
                    { x1: 1.5, x2: t_break, y1: getTopLine(1.5), y2: getTopLine(t_break), color: '#2ecc71', label: 'ä¸Šå‡å£“åŠ›' },
                    { x1: 1, x2: t_break, y1: v.flagLow, y2: breakPrice, color: '#2ecc71', label: 'ä¸Šå‡æ”¯æ’' },

                    // ç›®æ¨™åƒ¹ç·š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.flagLow, y2: v.startHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // è·¯å¾‘æ¨¡æ“¬ (èµ·é»ä¿®æ­£ç‚ºæ±ºç­–é» breakPrice)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´' },
					
					// I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š)
                    { x1: 7, x2: 7, y1: priceBtmAtBreak, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: 6, x2: 6, y1: getTopLine(t_break-1), y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' },
                ],
                
                extraMarkers: [
                    { type: 'point', xValue: t_break, yValue: breakPrice, backgroundColor: '#95a5a6', radius: 6, borderColor: 'white', borderWidth: 2 },
                    { type: 'point', xValue: t_target, yValue: targetBull, backgroundColor: '#e74c3c', radius: 8, borderColor: 'white', borderWidth: 2, label: 'å¤šæ–¹' },
                    { type: 'point', xValue: t_target, yValue: targetBear, backgroundColor: '#2ecc71', radius: 8, borderColor: 'white', borderWidth: 2, label: 'ç©ºæ–¹' }
                ]
            };
        }
    },
	bearFlagFlat: {
        name: "7. å¿«è·Œæ°´å¹³é£„æ—— (Horizontal Bear Flag) - æ€¥è·Œæ•´ç†",
        type: "bear", // ä¸­æ€§åç©º
        inputs: [
            { id: "poleTop", label: "èµ·è·Œé» (é«˜)", default: 100 },
            { id: "boxHigh", label: "æ——é¢é ‚ (å£“åŠ›)", default: 60 },
            { id: "boxLow", label: "æ——é¢åº• (æ”¯æ’)", default: 50 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ–·å´–å¼æ€¥è·Œ(æ——æ¡¿)å¾Œï¼Œé€²å…¥æ°´å¹³çš„ç®±å‹æ•´ç†(æ——é¢)ã€‚èˆ‡ä¸Šå‡é£„æ——ä¸åŒï¼Œæ­¤è™•å¤šç©ºåŠ›é‡å®Œå…¨å‹¢å‡åŠ›æ•µï¼Œå‘ˆç¾çŸ©å½¢éœ‡ç›ªã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åç©ºã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>ç®±é«”ä¸‹ç·£</strong>(æ”¯æ’ç·š)ã€‚é€™æ˜¯ä¸€å€‹ä¸­æ€§çµæ§‹ï¼Œå¿…é ˆç­‰å¾…å¯¦è³ªçªç ´ç®±é ‚æˆ–è·Œç ´ç®±åº•ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (é›™è»Œ)ã€‘</strong><br>
            1. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šæœ‰æ•ˆè·Œç ´ç®±åº•ã€‚ç›®æ¨™ = ç®±é«”ä¸Šç·£ - æ——æ¡¿é•·ã€‚<br>
            2. <strong>å¤šæ–¹(ç´…)</strong>ï¼šå¸¶é‡çªç ´ç®±é ‚ã€‚ç›®æ¨™ = ç®±é«”ä¸‹ç·£ + æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.poleTop - v.boxLow; 
            
            // ==========================================
            // ğŸ“ å¹¾ä½•é‹ç®—
            // ==========================================
            
            // æ™‚é–“è»¸
            const t_break = 7;      // æ±ºç­–é» (T7)
            const t_target = v.duration - 1;

            // 1. è¨­å®šç›®æ¨™åƒ¹ (åŠ å…¥ Math.max é˜²æ­¢è² å€¼)
            let targetBear = v.boxHigh - poleHeight;
            if (targetBear < 0) targetBear = 0; // â˜…é—œéµä¿®æ­£ï¼šæœ€ä½ 0 å…ƒ

            // å¤šæ–¹ç›®æ¨™ (åŸºæº–é»æ˜¯ boxHigh)
            const targetBull = v.boxLow + poleHeight;

            // 2. å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // T0: èµ·è·Œé»
            chartPoints[0] = v.poleTop;
            
            // T1: æ€¥è·Œè‡³ç®±åº•
            chartPoints[1] = v.boxLow; 

            // T2~T6: ç®±å‹å…§éœ‡ç›ª
            chartPoints[2] = v.boxHigh;   // é ‚
            chartPoints[3] = v.boxLow;    // åº•
            chartPoints[4] = v.boxHigh;   // é ‚
            chartPoints[5] = v.boxLow;    // åº•
            chartPoints[6] = v.boxHigh;   // é ‚
            
            // T7: æ±ºç­–é» (è²¼åº•)
            chartPoints[7] = v.boxLow;      

            // å¡«å……é æ¸¬å€
            for (let i = 8; i <= t_target; i++) {
                chartPoints.push(null); 
            }

            return {
                entry: v.boxLow,
                target: targetBear,
                stop: v.boxHigh,
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿ (æ€¥è·Œæ®µ)
                    { x1: 0, x2: 1, y1: v.poleTop, y2: v.boxLow, color: '#2ecc71', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š
                    { x1: 1, x2: t_break, y1: v.boxHigh, y2: v.boxHigh, color: '#2ecc71', label: 'æ°´å¹³å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š
                    { x1: 1, x2: t_break, y1: v.boxLow, y2: v.boxLow, color: '#2ecc71', label: 'æ°´å¹³æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š (ç´…)
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º (ç¶ )
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹…è™›ç·š (æ——æ¡¿é«˜ H)
                    { x1: 0.5, x2: 0.5, y1: v.boxLow, y2: v.poleTop, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘æ¨¡æ“¬
                    { x1: t_break, x2: t_target, y1: v.boxHigh, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘æ¨¡æ“¬
                    { x1: t_break, x2: t_target, y1: v.boxLow, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´' },
					
					// I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š)
                    { x1: 7, x2: 7, y1: v.boxLow, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: 6, x2: 6, y1: v.boxHigh, y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' },
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é»
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: v.boxLow,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™é»
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™é»
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
	bearFlagDown: {
        name: "8. å¿«è·Œä¸‹é™é£„æ—— (Descending Bear Flag) - æ¥µåº¦ç–²å¼±",
        type: "bear", // ä¸­æ€§åç©º
        inputs: [
            { id: "poleTop", label: "èµ·è·Œé» (é«˜)", default: 80 },
            { id: "flagStartHigh", label: "æ——é¢èµ·é» (é ‚)", default: 55 },
            { id: "flagStartLow", label: "æ——é¢èµ·é» (åº•)", default: 45 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>ç¶“æ­·æ–·å´–å¼æ€¥è·Œ(æ——æ¡¿)å¾Œï¼Œè‚¡åƒ¹é€£åå½ˆéƒ½ç„¡åŠ›ï¼Œå½¢æˆé«˜ä½é»æŒçºŒé™ä½çš„ä¸‹é™é€šé“(æ——é¢)ã€‚é€™é¡¯ç¤ºå¸‚å ´æ¥µåº¦ç–²å¼±ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åç©ºã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>ä¸‹é™æ”¯æ’ç·š</strong>ä¸Šã€‚é›–ç„¶è¶¨å‹¢å‘ä¸‹ï¼Œä½†ä¸‹é™æ¥”å‹æœ‰æ™‚ä¹Ÿæ˜¯åè½‰è¨Šè™Ÿï¼Œæ•…æ¡ç”¨é›™å‘ç­–ç•¥ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šè·Œç ´ä¸‹é™æ”¯æ’ã€‚ç›®æ¨™ = é€šé“ä¸Šç·£ - æ——æ¡¿é•·ã€‚<br>
            2. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´ä¸‹é™å£“åŠ›ã€‚ç›®æ¨™ = é€šé“ä¸‹ç·£ + æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H (èµ·è·Œé» - æ——é¢èµ·é»çš„åº•)
            const poleHeight = v.poleTop - v.flagStartLow; 
            
            // ==========================================
            // ğŸ“ ä¸‹é™é€šé“å¹¾ä½•é‹ç®—
            // ==========================================
            
            // æ™‚é–“è»¸
            const t_pole_end = 1;   
            const t_break = 7;      // æ±ºç­–é» (T7)
            const t_target = v.duration - 1;

            // é€šé“åƒæ•¸
            // è¨ˆç®—é€šé“å¯¬åº¦
            const channelWidth = v.flagStartHigh - v.flagStartLow;
            // è¨­å®šä¸‹é™æ–œç‡ (æ¯å–®ä½æ™‚é–“è·Œå¤šå°‘)
            // é€™è£¡è¨­å®šä¸€å€‹é©ä¸­çš„ä¸‹é™å¹…åº¦ï¼Œä¾‹å¦‚ 7 æ ¹ K æ£’è·Œæ‰ 10 é»
            const slope = -1.5; 

            // é€šé“æ–¹ç¨‹å¼ (å¾ t_pole_end é–‹å§‹)
            const getBtmLine = (t) => v.flagStartLow + slope * (t - t_pole_end);
            const getTopLine = (t) => getBtmLine(t) + channelWidth;

            // â˜…é—œéµä¿®æ­£ï¼šç›®æ¨™åƒ¹è¨ˆç®—é‚è¼¯ (ä¿å®ˆç‰ˆ)
            // å–å¾—æ±ºç­–é»ç•¶ä¸‹çš„é€šé“ä¸Šä¸‹ç·£åƒ¹æ ¼
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // ç©ºæ–¹ç›®æ¨™ = é€šé“ä¸Šç·£(è¼ƒé«˜é») - H
            // é‚è¼¯ï¼šé›–ç„¶æ˜¯ç©ºæ–¹ï¼Œä½†æˆ‘å€‘å¾æ¯”è¼ƒé«˜çš„ä½ç½®èµ·ç®—æ‰£é™¤ï¼Œè®“ç›®æ¨™åƒ¹æ¯”è¼ƒä¸å®¹æ˜“å¤ªæ·±(ä¿å®ˆ)
            let targetBear = getTopLine(t_break-1) - poleHeight;
            if (targetBear < 0) targetBear = 0; // é˜²å‘†

            // å¤šæ–¹ç›®æ¨™ = é€šé“ä¸‹ç·£(è¼ƒä½é») + H
            // é‚è¼¯ï¼šå¾ä½é»èµ·ç®—åŠ å›å»ï¼Œè®“æ¼²å¹…ç›®æ¨™æ¯”è¼ƒä¿å®ˆ
            const targetBull = priceBtmAtBreak + poleHeight;

            // æ±ºç­–é» (è²¼åº•)
            const breakPrice = priceBtmAtBreak;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // T0: èµ·è·Œé»
            chartPoints[0] = v.poleTop;
            
            // T1: æ€¥è·Œè‡³æ——é¢èµ·é»åº•
            chartPoints[1] = v.flagStartLow; 

            // T2~T6: ä¸‹é™é€šé“å…§éœ‡ç›ª (å¹¾ä½•å°é½Š)
            chartPoints[2] = getTopLine(2);   // ç¢°é ‚
            chartPoints[3] = getBtmLine(3);   // ç¢°åº•
            chartPoints[4] = getTopLine(4);   // ç¢°é ‚
            chartPoints[5] = getBtmLine(5);   // ç¢°åº•
            chartPoints[6] = getTopLine(6);   // ç¢°é ‚
            
            // T7: â˜…æ±ºç­–é» (å¼·åˆ¶å°é½Šä¸‹é™æ”¯æ’)
            chartPoints[7] = breakPrice;      

            // å¡«å……é æ¸¬å€
            for (let i = 8; i <= t_target; i++) {
                chartPoints.push(null); 
            }

            return {
                entry: breakPrice,
                target: targetBear,
                stop: priceTopAtBreak, // åœæè¨­åœ¨ä¸Šç·£
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿ (æ€¥è·Œæ®µ)
                    { x1: 0, x2: 1, y1: v.poleTop, y2: v.flagStartLow, color: '#2ecc71', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (ä¸‹é™)
                    { x1: 1, x2: t_break, y1: v.flagStartHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'ä¸‹é™å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (ä¸‹é™)
                    { x1: 1, x2: t_break, y1: v.flagStartLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'ä¸‹é™æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š (ç´…)
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º (ç¶ )
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹…è™›ç·š (æ——æ¡¿é«˜ H)
                    { x1: 0.5, x2: 0.5, y1: v.flagStartLow, y2: v.poleTop, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘æ¨¡æ“¬ (ç´…è™›ç·š) - çªç ´å¾Œå‘ä¸Š
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘æ¨¡æ“¬ (ç¶ è™›ç·š) - è·Œç ´å¾Œå‘ä¸‹
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´' },
					
					// I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š)
                    { x1: 7, x2: 7, y1: priceBtmAtBreak, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: 6, x2: 6, y1: getTopLine(t_break-1), y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' },
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é» (ç°è‰²ï¼Œä½æ–¼ä¸‹é™æ”¯æ’ç·šä¸Š)
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™é»
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™é»
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
    // --- å¿«è·Œä¸‰è§’é£„æ——ç³»åˆ— (Bear Pennants) ---
	bearPennantUp: {
        name: "9. å¿«è·Œä¸Šå‡ä¸‰è§’é£„æ—— (Rising Wedge Flag) - ä¸­ç¹¼å†è·Œ",
        type: "bear", // ä¸­æ€§åç©º
        inputs: [
            { id: "poleTop", label: "èµ·è·Œé» (é«˜)", default: 80 },
            { id: "flagStartHigh", label: "æ——é¢èµ·é» (é ‚)", default: 50 },
            { id: "flagStartLow", label: "æ——é¢èµ·é» (åº•)", default: 30 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ€¥è·Œ(æ——æ¡¿)å¾Œï¼Œé€²å…¥é«˜ä½é»åŒæ™‚å¢Šé«˜çš„ã€Œä¸Šå‡æ¥”å‹ã€æ•´ç†ã€‚ä¸‹æ–¹æ”¯æ’ç·šæ¯”ä¸Šæ–¹å£“åŠ›ç·šæ›´é™¡ï¼Œé›–çœ‹ä¼¼ä¸Šæ¼²ï¼Œå¯¦ç‚ºå¤šé ­åŠ›ç«­çš„æ”¶æ–‚ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åç©ºã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>ä¸Šå‡æ”¯æ’ç·š</strong>ä¸Šã€‚æ­¤å‹æ…‹åœ¨ç©ºé ­è¶¨å‹¢ä¸­å¸¸ç‚ºã€Œä¸­ç¹¼å†è·Œã€è¨Šè™Ÿï¼Œä½†ä»éœ€é˜²ç¯„å¤šé ­å¼·å‹¢Vè½‰ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šè·Œç ´ä¸Šå‡æ”¯æ’ã€‚ç›®æ¨™ = å£“åŠ›ç·š(ä¸Šç·£) - æ——æ¡¿é•·ã€‚<br>
            2. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´ä¸Šå‡å£“åŠ›ã€‚ç›®æ¨™ = æ”¯æ’ç·š(ä¸‹ç·£) + æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.poleTop - v.flagStartLow; 
            
            // ==========================================
            // ğŸ“ ä¸Šå‡æ¥”å‹å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // æ±ºç­–é» (T7)
            const t_target = v.duration - 1;

            // å¹¾ä½•åƒæ•¸è¨­å®š (æ”¶æ–‚)
            // å…©æ¢ç·šéƒ½å‘ä¸Šï¼Œä½†ä¸‹æ–¹ (Btm) å‡å¾—æ¯”ä¸Šæ–¹ (Top) å¿« -> å½¢æˆæ¥”å‹
            const slopeTop = 1.0; // ç·©å‡
            const slopeBtm = 2.5; // é™¡å‡

            // å»ºç«‹æ–¹ç¨‹å¼
            const getTopLine = (t) => v.flagStartHigh + slopeTop * (t - t_pole_end);
            const getBtmLine = (t) => v.flagStartLow + slopeBtm * (t - t_pole_end);

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // â˜… T7 æ±ºç­–é»ï¼šå¼·åˆ¶è²¼åœ¨ã€Œä¸Šå‡æ”¯æ’ç·šã€
            const breakPrice = priceBtmAtBreak;

            // â˜… ä¿å®ˆç›®æ¨™åƒ¹è¨ˆç®— (å¾åå‘é‚Šç•Œèµ·ç®—)
            // ç©ºæ–¹ï¼šå¾è¼ƒé«˜çš„å£“åŠ›ç·šæ‰£é™¤ H (å› æ¥”å‹å‘ä¸Šï¼Œå£“åŠ›ç·šå¾ˆé«˜ï¼Œé€™æ¨£ç®—ç›®æ¨™åƒ¹æ¯”è¼ƒä¿å®ˆ)
            let targetBear = getTopLine(t_break-1) - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            // å¤šæ–¹ï¼šå¾è¼ƒä½çš„æ”¯æ’ç·šåŠ ä¸Š H
            const targetBull = priceBtmAtBreak + poleHeight;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            chartPoints[0] = v.poleTop;
            chartPoints[1] = v.flagStartLow; 
            
            // æ¥”å‹éœ‡ç›ª (é«˜ä½é»å¢Šé«˜)
            chartPoints[2] = getTopLine(2);   
            chartPoints[3] = getBtmLine(3);   
            chartPoints[4] = getTopLine(4);   
            chartPoints[5] = getBtmLine(5);   
            chartPoints[6] = getTopLine(6);   
            
            // T7: è²¼åº•
            chartPoints[7] = breakPrice;      

            // å¡«å……é æ¸¬å€
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBear,
                stop: priceTopAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleTop, y2: v.flagStartLow, color: '#2ecc71', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (ç·©å‡)
                    { x1: 1, x2: t_break, y1: v.flagStartHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'ä¸Šå‡å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (é™¡å‡)
                    { x1: 1, x2: t_break, y1: v.flagStartLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'ä¸Šå‡æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.flagStartLow, y2: v.poleTop, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (ç´…è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (ç¶ è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´' },
					
					// I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š)
                    { x1: t_break, x2: t_break, y1: priceBtmAtBreak, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: t_break-1, x2: t_break-1, y1: getTopLine(t_break-1), y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' },
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é» (T7ï¼Œä½æ–¼ä¸Šå‡æ”¯æ’)
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
	bearPennantFlat: {
        name: "10. å¿«è·Œæ°´å¹³ä¸‰è§’é£„æ—— (Symmetrical Triangle Flag) - ä¸‰è§’æ”¶æ–‚",
        type: "bear", // ä¸­æ€§åç©º
        inputs: [
            { id: "poleTop", label: "èµ·è·Œé» (é«˜)", default: 80 },
            { id: "flagHigh", label: "æ——é¢èµ·é» (é ‚)", default: 60 },
            { id: "flagLow", label: "æ——é¢èµ·é» (åº•)", default: 40 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>ç¶“æ­·æ–·å´–å¼æ€¥è·Œ(æ——æ¡¿)å¾Œï¼Œå¤šç©ºåŠ›é“é–‹å§‹æ”¶æ–‚ã€‚é«˜é»é™ä½ã€ä½é»å¢Šé«˜ï¼Œå½¢æˆå°ç¨±ä¸‰è§’å½¢(æ——é¢)ã€‚èƒ½é‡å£“ç¸®è‡³æ¥µè‡´ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åç©ºã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼ä¸‰è§’å½¢çš„<strong>æ”¶æ–‚å°–ç«¯</strong>ã€‚æ­¤ç‚ºä¸­æ€§å‹æ…‹ï¼Œå¿…é ˆç­‰å¾…å¯¦è³ªçªç ´ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šè·Œç ´ä¸Šå‡æ”¯æ’ç·šã€‚ç›®æ¨™ = å£“åŠ›ç·š(ä¸Šç·£) - æ——æ¡¿é•·ã€‚<br>
            2. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´ä¸‹é™å£“åŠ›ç·šã€‚ç›®æ¨™ = æ”¯æ’ç·š(ä¸‹ç·£) + æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.poleTop - v.flagLow; 
            
            // ==========================================
            // ğŸ“ å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // æ±ºç­–é» (T7)
            const t_target = v.duration - 1;

            // è¨­å®šè™›æ“¬å°–ç«¯åœ¨ T10
            const t_apex = 10; 

            // ç†è«–æ”¶æ–‚ä¸­å¿ƒ
            const midPoint = (v.flagHigh + v.flagLow) / 2;

            // å»ºç«‹æ–¹ç¨‹å¼
            const slopeTop = (midPoint - v.flagHigh) / (t_apex - t_pole_end);
            const getTopLine = (t) => v.flagHigh + slopeTop * (t - t_pole_end);

            const slopeBtm = (midPoint - v.flagLow) / (t_apex - t_pole_end);
            const getBtmLine = (t) => v.flagLow + slopeBtm * (t - t_pole_end);

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // â˜…é—œéµä¿®æ­£ï¼šæ±ºç­–é» T7 å¼·åˆ¶è¨­å®šåœ¨ã€Œä¸Šå‡æ”¯æ’ç·šã€ä¸Š
            const breakPrice = priceBtmAtBreak;

            // ç›®æ¨™åƒ¹è¨ˆç®— (ä¿å®ˆåŸå‰‡ï¼šå¾åå‘é‚Šç•Œèµ·ç®—)
            let targetBear = getTopLine(t_break-1) - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            const targetBull = priceBtmAtBreak + poleHeight;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            chartPoints[0] = v.poleTop;
            chartPoints[1] = v.flagLow; 
            
            // æ”¶æ–‚éœ‡ç›ª
            chartPoints[2] = getTopLine(2);   
            chartPoints[3] = getBtmLine(3);   
            chartPoints[4] = getTopLine(4);   
            chartPoints[5] = getBtmLine(5);   
            chartPoints[6] = getTopLine(6);   
            
            // T7: è²¼åœ¨åº•éƒ¨
            chartPoints[7] = breakPrice;      

            // å¡«å……é æ¸¬å€
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBear,
                stop: priceTopAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleTop, y2: v.flagLow, color: '#2ecc71', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (è™›ç·šå»¶ä¼¸è‡³å°–ç«¯)
                    { x1: 1, x2: t_apex, y1: v.flagHigh, y2: midPoint, color: 'rgba(46, 204, 113, 0.5)', dashed: true },
                    { x1: 1, x2: t_break, y1: v.flagHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'æ”¶æ–‚å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (è™›ç·šå»¶ä¼¸è‡³å°–ç«¯)
                    { x1: 1, x2: t_apex, y1: v.flagLow, y2: midPoint, color: 'rgba(46, 204, 113, 0.5)', dashed: true },
                    { x1: 1, x2: t_break, y1: v.flagLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'æ”¶æ–‚æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.flagLow, y2: v.poleTop, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (å¾åº•éƒ¨å‘ä¸Šå™´å‡º)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (å¾åº•éƒ¨ç›´æ¥è·Œç ´)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´' },
					
					// I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š)
                    { x1: t_break, x2: t_break, y1: priceBtmAtBreak, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: t_break-1, x2: t_break-1, y1: getTopLine(t_break-1), y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' },
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é» (T7ï¼Œä½æ–¼åº•éƒ¨)
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
    bearPennantDown: {
        name: "11. å¿«è·Œä¸‹é™ä¸‰è§’é£„æ—— (Falling Wedge Flag) - ä¿å®ˆæ¸¬å¹…",
        type: "bear", // ä¸­æ€§åç©º
        inputs: [
            { id: "poleTop", label: "èµ·è·Œé» (é«˜)", default: 80 },
            { id: "flagStartHigh", label: "æ——é¢èµ·é» (é ‚)", default: 60 },
            { id: "flagStartLow", label: "æ——é¢èµ·é» (åº•)", default: 40 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ€¥è·Œ(æ——æ¡¿)å¾Œï¼Œé€²å…¥é«˜ä½é»åŒæ™‚é™ä½çš„ã€Œä¸‹é™æ¥”å‹ã€æ•´ç†ã€‚ä¸Šæ–¹å£“åŠ›ç·šæ¯”ä¸‹æ–¹æ”¯æ’ç·šæ›´é™¡ï¼Œåƒ¹æ ¼æ³¢å‹•å€é–“é€æ¼¸æ”¶çª„ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åç©ºã€</strong>å‹æ…‹ã€‚ä¸‹é™æ¥”å‹å¸¸è¢«è¦–ç‚ºæ½›åœ¨çš„å¤šé ­åè½‰è¨Šè™Ÿ(è·Œç„¡å¯è·Œ)ï¼Œä½†è¶¨å‹¢å°šæœªæ”¹è®Šå‰ä»å±¬ç©ºæ–¹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>ä¸‹é™æ”¯æ’ç·š</strong>ä¸Šã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šè·Œç ´ä¸‹é™æ”¯æ’ã€‚ç›®æ¨™ = å£“åŠ›ç·š(ä¸Šç·£) - æ——æ¡¿é•·ã€‚<br>
            2. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´ä¸‹é™å£“åŠ›ã€‚ç›®æ¨™ = æ”¯æ’ç·š(ä¸‹ç·£) + æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.poleTop - v.flagStartLow; 
            
            // ==========================================
            // ğŸ“ ä¸‹é™æ¥”å‹å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // æ±ºç­–é» (T7)
            const t_target = v.duration - 1;

            // å¹¾ä½•åƒæ•¸è¨­å®š (æ”¶æ–‚)
            // ä¸Šæ–¹è·Œå¾—å¿« (-2.5)ï¼Œä¸‹æ–¹è·Œå¾—æ…¢ (-1.0) -> å½¢æˆæ¥”å‹
            const slopeTop = -2.5; 
            const slopeBtm = -1.0; 

            // å»ºç«‹æ–¹ç¨‹å¼
            const getTopLine = (t) => v.flagStartHigh + slopeTop * (t - t_pole_end);
            const getBtmLine = (t) => v.flagStartLow + slopeBtm * (t - t_pole_end);

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // â˜… T7 æ±ºç­–é»ï¼šå¼·åˆ¶è²¼åœ¨ã€Œä¸‹é™æ”¯æ’ç·šã€
            const breakPrice = priceBtmAtBreak;

            // â˜… ä¿å®ˆç›®æ¨™åƒ¹è¨ˆç®— (å¾åå‘é‚Šç•Œèµ·ç®—)
            // ç©ºæ–¹ï¼šå¾è¼ƒé«˜çš„å£“åŠ›ç·šæ‰£é™¤ H
            let targetBear = getTopLine(t_break-1) - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            // å¤šæ–¹ï¼šå¾è¼ƒä½çš„æ”¯æ’ç·šåŠ ä¸Š H
            const targetBull = priceBtmAtBreak + poleHeight;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            chartPoints[0] = v.poleTop;
            chartPoints[1] = v.flagStartLow; 
            
            // æ¥”å‹éœ‡ç›ª
            chartPoints[2] = getTopLine(2);   
            chartPoints[3] = getBtmLine(3);   
            chartPoints[4] = getTopLine(4);   
            chartPoints[5] = getBtmLine(5);   
            chartPoints[6] = getTopLine(6);   
            
            // T7: è²¼åº•
            chartPoints[7] = breakPrice;      

            // å¡«å……é æ¸¬å€
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBear,
                stop: priceTopAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleTop, y2: v.flagStartLow, color: '#2ecc71', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (é™¡é™)
                    { x1: 1, x2: t_break, y1: v.flagStartHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'ä¸‹é™å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (ç·©é™)
                    { x1: 1, x2: t_break, y1: v.flagStartLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'ä¸‹é™æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.flagStartLow, y2: v.poleTop, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (ç´…è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (ç¶ è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'è·Œç ´' },
					
					// I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š)
                    { x1: t_break, x2: t_break, y1: priceBtmAtBreak, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: t_break-1, x2: t_break-1, y1: getTopLine(t_break-1), y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' },
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é» (T7ï¼Œä½æ–¼ä¸‹é™æ”¯æ’)
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },

    // --- å¿«æ¼²é£„æ——ç³»åˆ— (Bull Flags) ---
	bullFlagUp: {
        name: "12. å¿«æ¼²ä¸Šå‡é£„æ—— (Rising Flag) - é›™å‘ç­–ç•¥",
        type: "bull", // ä¸­æ€§åå¤š
        inputs: [
            { id: "poleBtm", label: "èµ·æ¼²é» (ä½)", default: 10 },
            { id: "flagStartHigh", label: "æ——é¢èµ·é» (é ‚)", default: 90 },
            { id: "flagStartLow", label: "æ——é¢èµ·é» (åº•)", default: 45 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ€¥æ¼²(æ——æ¡¿)å¾Œï¼Œé€²å…¥é«˜ä½é»åŒæ™‚å¢Šé«˜çš„ã€Œä¸Šå‡é£„æ——ã€æ•´ç†ã€‚é›–ç„¶è¶¨å‹¢å‘ä¸Šï¼Œä½†æ–œç‡è¶¨ç·©ï¼Œæš—ç¤ºå¤šé ­å‹•èƒ½å¯èƒ½é€æ¼¸è€—ç›¡(æˆ–ç‚ºèª˜å¤š)ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åå¤šã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>ä¸Šå‡æ”¯æ’ç·š</strong>ä¸Šã€‚æ­¤è™•æ˜¯å¤šé ­æ ¼å±€çš„ç”Ÿå‘½ç·šï¼Œå®ˆä½å‰‡çºŒæ”»ï¼Œè·Œç ´å‰‡ç¢ºèªåè½‰ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´ä¸Šå‡å£“åŠ›ã€‚ç›®æ¨™ = æ”¯æ’ç·š(ä¸‹ç·£) + æ——æ¡¿é•·ã€‚<br>
            2. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šè·Œç ´ä¸Šå‡æ”¯æ’ã€‚ç›®æ¨™ = å£“åŠ›ç·š(ä¸Šç·£) - æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.flagStartHigh - v.poleBtm; 
            
            // ==========================================
            // ğŸ“ ä¸Šå‡é£„æ——å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // â˜… æ±ºç­–é»ç§»è‡³ T7 (ä½”æ¯” 50%)
            const t_target = v.duration - 1;

            // å¹¾ä½•åƒæ•¸è¨­å®š
            const slope = 1.5; 

            // å»ºç«‹æ–¹ç¨‹å¼
            const getTopLine = (t) => v.flagStartHigh + slope * (t - t_pole_end);
            const getBtmLine = (t) => v.flagStartLow + slope * (t - t_pole_end);

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹
            const priceTopAtBreak = getTopLine(t_break); 
            const priceBtmAtBreak = getBtmLine(t_break);

            // â˜… T7 æ±ºç­–é»ï¼šå¼·åˆ¶è²¼åœ¨ã€Œä¸Šå‡å£“åŠ›ç·šã€
            const breakPrice = priceTopAtBreak;

            // â˜… ä¿å®ˆç›®æ¨™åƒ¹è¨ˆç®—
            const targetBull = getBtmLine(t_break-2) + poleHeight;

            let targetBear = getTopLine(t_break) - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            // å»ºæ§‹ K ç·šè·¯å¾‘ (å¯¬ç‰ˆ W)
            let chartPoints = [];
            
            chartPoints[0] = v.poleBtm;       // T0
            chartPoints[1] = v.flagStartHigh; // T1: Wèµ·é» (é ‚)
            
            // --- ç¬¬ä¸€éš»è…³ ---
            chartPoints[2] = getBtmLine(2);   // T2: æ€¥æ®ºè‡³åº•
            // T3: ç·©æ¼²ä¸­ç¹¼ (ä»‹æ–¼ T2åº• èˆ‡ T4é ‚ ä¹‹é–“)
            chartPoints[3] = (getBtmLine(2) + getTopLine(4)) / 2;
            chartPoints[4] = getTopLine(4);   // T4: æ”»é ‚ (Wä¸­é–“å³°)
            
            // --- ç¬¬äºŒéš»è…³ ---
            chartPoints[5] = getBtmLine(5);   // T5: æ€¥æ®ºè‡³åº•
            // T6: ç·©æ¼²ä¸­ç¹¼ (ä»‹æ–¼ T5åº• èˆ‡ T7é ‚ ä¹‹é–“)
            chartPoints[6] = (getBtmLine(5) + getTopLine(7)) / 2;
            
            // T7: â˜…æ±ºç­–é» (æ”»é ‚ - å³è‚©çªç ´)
            chartPoints[7] = breakPrice;      

            // å¡«ç©º
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBull,
                stop: priceBtmAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleBtm, y2: v.flagStartHigh, color: '#e74c3c', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (T1 -> T7)
                    { x1: 1, x2: t_break, y1: v.flagStartHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'ä¸Šå‡å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (T2 -> T5 çš„å»¶ä¼¸)
                    { x1: 1, x2: t_break, y1: v.flagStartLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'ä¸Šå‡æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.poleBtm, y2: v.flagStartHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (ç´…è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (ç¶ è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'åè½‰' },
                    
                    // I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸Š)
                    { x1: t_break-2, x2: t_break-2, y1: getBtmLine(t_break-2), y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: t_break, x2: t_break, y1: getTopLine(t_break), y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' }
                ],
                
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
    bullFlagFlat: {
        name: "13. å¿«æ¼²æ°´å¹³é£„æ—— (Horizontal Flag) - å¯¬ç‰ˆMæ”»é ‚",
        type: "bull", // ä¸­æ€§åå¤š
        inputs: [
            { id: "poleBtm", label: "èµ·æ¼²é» (ä½)", default: 10 },
            { id: "boxHigh", label: "ç®±å‹é ‚ (å£“åŠ›)", default: 90 }, // æ‹‰å¤§ç®±é«”é«˜åº¦
            { id: "boxLow", label: "ç®±å‹åº• (æ”¯æ’)", default: 45 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ€¥æ¼²(æ——æ¡¿)å¾Œï¼Œè‚¡åƒ¹åœ¨æ°´å¹³ç®±é«”å…§é€²è¡Œã€Œå¯¬ç‰ˆ M å‹ã€éœ‡ç›ªã€‚é«˜é»èˆ‡ä½é»åˆ†åˆ¥åœ¨å›ºå®šçš„æ°´å¹³åƒ¹ä½ä¸Šåè¦†æ¸¬è©¦ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åå¤šã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>ç®±å‹é ‚éƒ¨(å£“åŠ›ç·š)</strong>ã€‚è¿™æ˜¯å¤šé ­ç¬¬ä¸‰æ¬¡å˜—è©¦çªç ´ï¼Œæ˜¯ã€Œé£›è¶Šéç‰†ã€é‚„æ˜¯ã€Œå‡çªç ´æ‹‰å›ã€çš„é—œéµæ™‚åˆ»ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´ç®±é ‚å£“åŠ›ã€‚ç›®æ¨™ = ç®±åº•(ä¸‹ç·£) + æ——æ¡¿é•·ã€‚<br>
            2. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šå£“åŠ›å—é˜»å›è·Œã€‚ç›®æ¨™ = ç®±é ‚(ä¸Šç·£) - æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H (ç®±é ‚ - èµ·æ¼²é»)
            const poleHeight = v.boxHigh - v.poleBtm; 
            
            // ==========================================
            // ğŸ“ æ°´å¹³é£„æ——å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // â˜… æ±ºç­–é» T7 (ä½”æ¯” 50%)
            const t_target = v.duration - 1;

            // ç®±å‹åƒæ•¸ (æ°´å¹³)
            // ä¸éœ€è¦ slopeï¼Œç›´æ¥ç”¨ boxHigh å’Œ boxLow

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹ (å°±æ˜¯å›ºå®šçš„ç®±é ‚ç®±åº•)
            const priceTopAtBreak = v.boxHigh;
            const priceBtmAtBreak = v.boxLow;

            // â˜… T7 æ±ºç­–é»ï¼šå¼·åˆ¶è²¼åœ¨ã€Œç®±é ‚ (å£“åŠ›ç·š)ã€
            const breakPrice = priceTopAtBreak;

            // â˜… ä¿å®ˆç›®æ¨™åƒ¹è¨ˆç®— (å¾åå‘é‚Šç•Œèµ·ç®—)
            // å¤šæ–¹ï¼šå¾è¼ƒä½çš„ç®±åº•åŠ ä¸Š H
            const targetBull = priceBtmAtBreak + poleHeight;

            // ç©ºæ–¹ï¼šå¾è¼ƒé«˜çš„ç®±é ‚æ‰£é™¤ H
            let targetBear = priceTopAtBreak - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            // å»ºæ§‹ K ç·šè·¯å¾‘ (å¯¬ç‰ˆ M å‹)
            let chartPoints = [];
            
            chartPoints[0] = v.poleBtm; // T0: èµ·æ¼²
            chartPoints[1] = v.boxHigh; // T1: æ”»é ‚ (Mèµ·é»)
            
            // --- ç¬¬ä¸€æ³¢å›æª” ---
            chartPoints[2] = v.boxLow;  // T2: æ¸¬åº•
            // T3: ä¸­ç¹¼
            chartPoints[3] = (v.boxHigh + v.boxLow) / 2;
            
            // --- ç¬¬äºŒæ³¢æ”»é ‚ ---
            chartPoints[4] = v.boxHigh; // T4: æ”»é ‚ (Mä¸­é–“å³°)
            
            // --- ç¬¬äºŒæ³¢å›æª” ---
            chartPoints[5] = v.boxLow;  // T5: æ¸¬åº•
            // T6: ä¸­ç¹¼
            chartPoints[6] = (v.boxHigh + v.boxLow) / 2;
            
            // --- ç¬¬ä¸‰æ³¢æ”»é ‚ (æ±ºç­–) ---
            chartPoints[7] = breakPrice;// T7: æ”»é ‚ (æ±ºç­–é»)

            // å¡«ç©º
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBull,
                stop: priceBtmAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleBtm, y2: v.boxHigh, color: '#e74c3c', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (æ°´å¹³)
                    { x1: 1, x2: t_break, y1: v.boxHigh, y2: v.boxHigh, color: '#2ecc71', label: 'æ°´å¹³å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (æ°´å¹³)
                    { x1: 1, x2: t_break, y1: v.boxLow, y2: v.boxLow, color: '#2ecc71', label: 'æ°´å¹³æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.poleBtm, y2: v.boxHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (ç´…è™›ç·š - çªç ´å™´å‡º)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (ç¶ è™›ç·š - å‡çªç ´åè½‰)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'åè½‰' },
                    
                    // I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸Š)
                    { x1: t_break-2, x2: t_break-2, y1: priceBtmAtBreak, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    // å¾ T7 (Top) ç›´æ¥ç•«ä¸‹ä¾†
                    { x1: t_break, x2: t_break, y1: priceTopAtBreak, y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' }
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é» (T7 - åœ¨é ‚éƒ¨)
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
	bullFlagDown: {
        name: "14. å¿«æ¼²ä¸‹é™é£„æ—— (Bull Flag) - å¯¬ç‰ˆæ´—ç›¤æ”»é ‚",
        type: "bull", // ä¸­æ€§åå¤š
        inputs: [
            { id: "poleBtm", label: "èµ·æ¼²é» (ä½)", default: 10 },
            { id: "flagStartHigh", label: "æ——é¢èµ·é» (é ‚)", default: 90 },
            { id: "flagStartLow", label: "æ——é¢èµ·é» (åº•)", default: 60 }, // è¨­å®šé€šé“å¯¬åº¦
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ€¥æ¼²(æ——æ¡¿)å¾Œï¼Œé€²å…¥å‘å³ä¸‹æ–¹å‚¾æ–œçš„ã€Œä¸‹é™é£„æ——ã€æ•´ç†ã€‚æ¡ç”¨å¯¬ç‰ˆä½ˆå±€ï¼Œé¡¯ç¤ºä¸»åŠ›é€²è¡Œæ·±å¹…æ´—ç›¤ï¼Œé«˜ä½é»æœ‰åºé™ä½ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åå¤šã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>ä¸‹é™å£“åŠ›ç·š(ä¸Šç·£)</strong>ã€‚é€™æ˜¯ã€Œç‰›æ——ã€çš„æ¨™æº–çªç ´ä½ç½®ï¼Œè‹¥å¸¶é‡çªç ´å°‡é‡å•Ÿæ¼²å‹¢ï¼›è‹¥çªç ´å¤±æ•—å‰‡å¯èƒ½è½‰ç‚ºç©ºé ­ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´ä¸‹é™å£“åŠ›ã€‚ç›®æ¨™ = æ”¯æ’ç·š(ä¸‹ç·£) + æ——æ¡¿é•·ã€‚<br>
            2. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šå£“åŠ›å—é˜»å›è·Œã€‚ç›®æ¨™ = å£“åŠ›ç·š(ä¸Šç·£) - æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.flagStartHigh - v.poleBtm; 
            
            // ==========================================
            // ğŸ“ ä¸‹é™é£„æ——å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // â˜… æ±ºç­–é» T7 (ä½”æ¯” 50%)
            const t_target = v.duration - 1;

            // å¹¾ä½•åƒæ•¸è¨­å®š (ä¸‹é™ slope)
            const slope = -2.0; // ä¸‹é™æ–œç‡

            // å»ºç«‹æ–¹ç¨‹å¼
            const getTopLine = (t) => v.flagStartHigh + slope * (t - t_pole_end);
            const getBtmLine = (t) => v.flagStartLow + slope * (t - t_pole_end);

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // â˜… T7 æ±ºç­–é»ï¼šå¼·åˆ¶è²¼åœ¨ã€Œä¸‹é™å£“åŠ›ç·š (ä¸Šç·£)ã€
            const breakPrice = priceTopAtBreak;

            // â˜… ä¿å®ˆç›®æ¨™åƒ¹è¨ˆç®— (å¾åå‘é‚Šç•Œèµ·ç®—)
            // å¤šæ–¹ï¼šå¾è¼ƒä½çš„æ”¯æ’ç·šåŠ ä¸Š H (ç‰›æ——ä¿å®ˆæ¸¬å¹…)
            const targetBull = getBtmLine(t_break-2) + poleHeight;

            // ç©ºæ–¹ï¼šå¾è¼ƒé«˜çš„å£“åŠ›ç·šæ‰£é™¤ H
            let targetBear = getTopLine(t_break) - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            // å»ºæ§‹ K ç·šè·¯å¾‘ (å¯¬ç‰ˆä¸‹é™éœ‡ç›ª)
            let chartPoints = [];
            
            chartPoints[0] = v.poleBtm;       // T0: èµ·æ¼²
            chartPoints[1] = v.flagStartHigh; // T1: æ——é¢èµ·é» (é ‚)
            
            // --- ç¬¬ä¸€æ³¢æ´—ç›¤ ---
            chartPoints[2] = getBtmLine(2);   // T2: æ¸¬åº•
            // T3: ä¸­ç¹¼ (åå½ˆä¸€åŠ)
            chartPoints[3] = (getBtmLine(2) + getTopLine(4)) / 2;
            
            // --- ç¬¬äºŒæ³¢æ¸¬è©¦ ---
            chartPoints[4] = getTopLine(4);   // T4: æ”»é ‚ (é«˜é»é™ä½)
            chartPoints[5] = getBtmLine(5);   // T5: æ¸¬åº• (ä½é»é™ä½)
            
            // T6: ä¸­ç¹¼
            chartPoints[6] = (getBtmLine(5) + getTopLine(7)) / 2;
            
            // --- æ±ºç­–æ™‚åˆ» ---
            chartPoints[7] = breakPrice;      // T7: æ”»é ‚ (æ±ºç­–é»)

            // å¡«ç©º
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBull,
                stop: priceBtmAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleBtm, y2: v.flagStartHigh, color: '#e74c3c', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (ä¸‹é™)
                    { x1: 1, x2: t_break, y1: v.flagStartHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'ä¸‹é™å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (ä¸‹é™)
                    { x1: 1, x2: t_break, y1: v.flagStartLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'ä¸‹é™æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.poleBtm, y2: v.flagStartHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (ç´…è™›ç·š - çªç ´)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (ç¶ è™›ç·š - åè½‰)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'åè½‰' },
                    
                    // I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸Š)
                    { x1: t_break-2, x2: t_break-2, y1: getBtmLine(t_break-2), y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    // å¾ T7 (Top) ç›´æ¥ç•«ä¸‹ä¾†
                    { x1: t_break, x2: t_break, y1: getTopLine(t_break), y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' }
                ],
                
                extraMarkers: [
                    // 1. æ±ºç­–é» (T7 - åœ¨é ‚éƒ¨)
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    // 2. å¤šæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    // 3. ç©ºæ–¹ç›®æ¨™
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
    // --- å¿«æ¼²ä¸‰è§’é£„æ——ç³»åˆ— (Bull Pennants) ---
	bullPennantUp: {
        name: "15. å¿«æ¼²ä¸Šå‡ä¸‰è§’é£„æ—— (Rising Wedge) - å¯¬ç‰ˆæ¥”å‹æ”»é ‚",
        type: "bull", // ä¸­æ€§åå¤š
        inputs: [
            { id: "poleBtm", label: "èµ·æ¼²é» (ä½)", default: 10 },
            { id: "flagStartHigh", label: "æ——é¢èµ·é» (é ‚)", default: 90 },
            { id: "flagStartLow", label: "æ——é¢èµ·é» (åº•)", default: 45 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ€¥æ¼²å¾Œé€²å…¥ã€Œä¸Šå‡æ¥”å‹ã€æ•´ç†ã€‚ä¸‹æ–¹æ”¯æ’ç·šæ¯”ä¸Šæ–¹å£“åŠ›ç·šæ›´é™¡ï¼Œåƒ¹æ ¼åœ¨å‰µé«˜çš„åŒæ™‚ï¼Œæ³¢å‹•å€é–“å»è¢«å£“ç¸®(æ”¶æ–‚)ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åå¤šã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>æ¥”å‹é ‚ç«¯(å£“åŠ›ç·š)</strong>ã€‚æ­¤å‹æ…‹å¸¸æš—ç¤ºå¤šé ­å‹•èƒ½è€—ç›¡(åƒ¹æ¼²é‡ç¸®)ï¼Œè‹¥T7ç„¡æ³•å¼·å‹¢å™´å‡ºï¼Œæ¥µæ˜“å½¢æˆå‡çªç ´å¾Œçš„åè½‰ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´æ¥”å‹é ‚ç«¯ã€‚ç›®æ¨™ = æ”¯æ’ç·š(ä¸‹ç·£) + æ——æ¡¿é•·ã€‚<br>
            2. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šé ‚ç«¯å—é˜»å›è·Œã€‚ç›®æ¨™ = å£“åŠ›ç·š(ä¸Šç·£) - æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.flagStartHigh - v.poleBtm; 
            
            // ==========================================
            // ğŸ“ æ¥µè‡´æ”¶æ–‚å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // â˜… æ±ºç­–é» T7
            const t_target = v.duration - 1;

            // å¹¾ä½•åƒæ•¸è¨­å®š (æ¥µè‡´æ”¶æ–‚)
            // ä¸Šæ–¹è¿‘ä¹èµ°å¹³ (ç·©å‡)
            const slopeTop = 1.0; 
            // ä¸‹æ–¹æ€¥é€Ÿè¿½è¶• (é™¡å‡) -> ç‚ºäº†åœ¨ 6 æ ¼å…§è¿½ä¸Š 45 çš„å·®è·ï¼Œæ–œç‡è¦å¾ˆå¤§
            const slopeBtm = 6.5; 

            // å»ºç«‹æ–¹ç¨‹å¼
            const getTopLine = (t) => v.flagStartHigh + slopeTop * (t - t_pole_end);
            const getBtmLine = (t) => v.flagStartLow + slopeBtm * (t - t_pole_end);

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // â˜… T7 æ±ºç­–é»ï¼šå¼·åˆ¶è²¼åœ¨ã€Œæ¥”å‹é ‚ç«¯ (å£“åŠ›ç·š)ã€
            const breakPrice = priceTopAtBreak;

            // â˜… ä¿å®ˆç›®æ¨™åƒ¹è¨ˆç®—
            // å¤šæ–¹ï¼šå¾è¼ƒä½çš„æ”¯æ’ç·šåŠ ä¸Š H
            const targetBull = getBtmLine(t_break-2) + poleHeight;

            // ç©ºæ–¹ï¼šå¾è¼ƒé«˜çš„å£“åŠ›ç·šæ‰£é™¤ H
            let targetBear = priceTopAtBreak - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            // å»ºæ§‹ K ç·šè·¯å¾‘ (å¯¬ç‰ˆ -> æ¥µçª„)
            let chartPoints = [];
            
            chartPoints[0] = v.poleBtm;       // T0
            chartPoints[1] = v.flagStartHigh; // T1 (é ‚)
            
            // --- å¯¬å»£çš„ç¬¬ä¸€æ³¢ ---
            chartPoints[2] = getBtmLine(2);   // T2 (åº•) - æ­¤æ™‚è·é›¢é ‚é‚„å¾ˆé 
            
            // T3: ä¸­ç¹¼ (ç¨å¾®æ‹‰é«˜ä¸€é»)
            chartPoints[3] = (getBtmLine(2) + getTopLine(4)) / 2;
            
            // --- å£“ç¸®çš„ç¬¬äºŒæ³¢ ---
            chartPoints[4] = getTopLine(4);   // T4 (æ”»é ‚)
            chartPoints[5] = getBtmLine(5);   // T5 (æ¸¬åº•) - æ­¤æ™‚åº•å·²ç¶“å¢Šå¾ˆé«˜äº†
            
            // T6: ä¸­ç¹¼ (ç©ºé–“è®Šå°)
            chartPoints[6] = (getBtmLine(5) + getTopLine(7)) / 2;
            
            // --- çª’æ¯çš„æ±ºç­–é» ---
            chartPoints[7] = breakPrice;      // T7 (é ‚) - å¹¾ä¹èˆ‡åº•è²¼åœ¨ä¸€èµ·

            // å¡«ç©º
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBull,
                stop: priceBtmAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleBtm, y2: v.flagStartHigh, color: '#e74c3c', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (ç·©å‡)
                    { x1: 1, x2: t_break, y1: v.flagStartHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'æ”¶æ–‚å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (æ€¥å‡) -> è¦–è¦ºä¸Šæœƒçœ‹åˆ°é€™æ¢ç·šå¾€ä¸Šè¡å»æ’å£“åŠ›ç·š
                    { x1: 1, x2: t_break, y1: v.flagStartLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'æ”¶æ–‚æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.poleBtm, y2: v.flagStartHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (ç´…è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (ç¶ è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'åè½‰' },
                    
                    // I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸Š)
                    { x1: t_break-2, x2: t_break-2, y1: getBtmLine(t_break-2), y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: t_break, x2: t_break, y1: priceTopAtBreak, y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' }
                ],
                
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
	bullPennantFlat: {
        name: "16. å¿«æ¼²æ°´å¹³ä¸‰è§’é£„æ—— (Symmetrical Triangle) - æ¥µè‡´æ”¶æ–‚è¡¨æ…‹",
        type: "bull", // ä¸­æ€§åå¤š
        inputs: [
            { id: "poleBtm", label: "èµ·æ¼²é» (ä½)", default: 10 },
            { id: "flagStartHigh", label: "æ——é¢èµ·é» (é ‚)", default: 90 }, // ä¸‰è§’å½¢é ‚
            { id: "flagStartLow", label: "æ——é¢èµ·é» (åº•)", default: 50 }, // ä¸‰è§’å½¢åº•
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ€¥æ¼²å¾Œï¼Œè‚¡åƒ¹é€²å…¥ã€Œé«˜é»é™ä½ã€ä½é»å¢Šé«˜ã€çš„å°ç¨±æ”¶æ–‚æ•´ç†ã€‚éš¨è‘—æ™‚é–“æ¨ç§»ï¼ŒKç·šæ³¢å‹•å¹…åº¦å¾å¯¬å»£(T1)é€æ¼¸è¢«å£“ç¸®è‡³çª’æ¯(T7)ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åå¤šã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>ä¸‰è§’å½¢æ”¶æ–‚å°–ç«¯</strong>ã€‚é€™æ˜¯ä¸€å€‹ä¸­æ€§å‹æ…‹ï¼Œä»£è¡¨å¤šç©ºåŠ›é“æš«æ™‚å¹³è¡¡ï¼Œå¿…é ˆç­‰å¾…å¯¦è³ªçªç ´æ–¹å‘ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (é›™å‘å°ç¨±)ã€‘</strong><br>
            1. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´æ”¶æ–‚æœ«ç«¯ã€‚ç›®æ¨™ = çªç ´é» + æ——æ¡¿é•·ã€‚<br>
            2. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šè·Œç ´æ”¶æ–‚æœ«ç«¯ã€‚ç›®æ¨™ = çªç ´é» - æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.flagStartHigh - v.poleBtm; 
            
            // ==========================================
            // ğŸ“ å°ç¨±ä¸‰è§’å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // â˜… æ±ºç­–é» T7
            const t_target = v.duration - 1;

            // è¨ˆç®—æ”¶æ–‚ä¸­å¿ƒ (Midpoint)
            // å‡è¨­æ”¶æ–‚åˆ° T9 (æ¯” T7 ç¨æ™šï¼Œè®“ T7 é‚„æœ‰ä¸€é»é»é–‹å£)
            const t_apex = 9;
            const midPrice = (v.flagStartHigh + v.flagStartLow) / 2;

            // è¨ˆç®—æ–œç‡ (è®“å…©æ¢ç·šåœ¨ t_apex äº¤æœƒæ–¼ midPrice)
            const slopeTop = (midPrice - v.flagStartHigh) / (t_apex - t_pole_end); // è² æ–œç‡
            const slopeBtm = (midPrice - v.flagStartLow) / (t_apex - t_pole_end);  // æ­£æ–œç‡

            // å»ºç«‹æ–¹ç¨‹å¼
            const getTopLine = (t) => v.flagStartHigh + slopeTop * (t - t_pole_end);
            const getBtmLine = (t) => v.flagStartLow + slopeBtm * (t - t_pole_end);

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // â˜… T7 æ±ºç­–é»ï¼šä½æ–¼å…©ç·šä¸­é–“ (æ”¶æ–‚æœ«ç«¯)
            const breakPrice = (priceTopAtBreak + priceBtmAtBreak) / 2;

            // â˜… ç›®æ¨™åƒ¹è¨ˆç®— (å¾çªç ´é»èµ·ç®—)
            // å¤šæ–¹ï¼šçªç ´é» + H
            const targetBull = breakPrice + poleHeight;

            // ç©ºæ–¹ï¼šçªç ´é» - H
            let targetBear = breakPrice - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            // å»ºæ§‹ K ç·šè·¯å¾‘ (å¯¬ç‰ˆæ”¶æ–‚éœ‡ç›ª)
            let chartPoints = [];
            
            chartPoints[0] = v.poleBtm;       // T0
            chartPoints[1] = v.flagStartHigh; // T1: é ‚ (é–‹å£æœ€å¤§)
            
            // --- ç¬¬ä¸€æ³¢ (å¯¬) ---
            chartPoints[2] = getBtmLine(2);   // T2: åº•
            // T3: ä¸­ç¹¼
            chartPoints[3] = (getBtmLine(2) + getTopLine(4)) / 2;
            
            // --- ç¬¬äºŒæ³¢ (çª„) ---
            chartPoints[4] = getTopLine(4);   // T4: é ‚ (é«˜é»é™ä½)
            chartPoints[5] = getBtmLine(5);   // T5: åº• (ä½é»å¢Šé«˜)
            
            // T6: ä¸­ç¹¼
            chartPoints[6] = (getBtmLine(5) + getTopLine(7)) / 2;
            
            // --- æ±ºç­–æ™‚åˆ» (å°–ç«¯) ---
            chartPoints[7] = breakPrice;      // T7: ä¸­å¿ƒé»

            // å¡«ç©º
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBull,
                stop: priceBtmAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleBtm, y2: v.flagStartHigh, color: '#e74c3c', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (å‘å³ä¸‹)
                    { x1: 1, x2: t_break, y1: v.flagStartHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'æ”¶æ–‚å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (å‘å³ä¸Š)
                    { x1: 1, x2: t_break, y1: v.flagStartLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'æ”¶æ–‚æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.poleBtm, y2: v.flagStartHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (ç´…è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (ç¶ è™›ç·š)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'åè½‰' },
                    
                    // I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸Š)
                    { x1: t_break, x2: t_break, y1: breakPrice, y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: t_break, x2: t_break, y1: breakPrice, y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' }
                ],
                
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },
	bullPennantDown: {
        name: "17. å¿«æ¼²ä¸‹é™ä¸‰è§’é£„æ—— (Falling Wedge) - å¯¬ç‰ˆæ´—ç›¤è¡¨æ…‹",
        type: "bull", // ä¸­æ€§åå¤š
        inputs: [
            { id: "poleBtm", label: "èµ·æ¼²é» (ä½)", default: 10 },
            { id: "flagStartHigh", label: "æ——é¢èµ·é» (é ‚)", default: 90 },
            { id: "flagStartLow", label: "æ——é¢èµ·é» (åº•)", default: 60 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ€¥æ¼²å¾Œé€²å…¥ã€Œä¸‹é™æ¥”å‹ã€æ•´ç†ã€‚ä¸Šæ–¹å£“åŠ›ç·šé™¡é™(å£“ç›¤)ï¼Œä¸‹æ–¹æ”¯æ’ç·šç·©é™(æƒœå”®)ï¼Œå…©ç·šå‘å³ä¸‹æ”¶æ–‚ã€‚é€™æ˜¯ä¸€ç¨®å¼·å‹¢çš„æ´—ç›¤å‹æ…‹ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>æ­¤ç‚º<strong>ã€Œä¸­æ€§åå¤šã€</strong>å‹æ…‹ã€‚T7 æ±ºç­–é»ä½æ–¼<strong>æ¥”å‹ä¸Šç·£(å£“åŠ›ç·š)</strong>ã€‚æ­¤è™•ç‚ºå¤šç©ºåˆ†æ°´å¶ºï¼šçªç ´å³ç‚ºã€Œå™´å‡ºæ®µã€çš„é–‹å§‹ï¼›è‹¥å—é˜»å›è½å‰‡éœ€é˜²ç¯„è¶¨å‹¢è½‰ç©ºã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ä¿å®ˆé›™è»Œ)ã€‘</strong><br>
            1. <strong>å¤šæ–¹(ç´…)</strong>ï¼šçªç ´ä¸‹é™å£“åŠ›ã€‚ç›®æ¨™ = æ”¯æ’ç·š(ä¸‹ç·£) + æ——æ¡¿é•·ã€‚<br>
            2. <strong>ç©ºæ–¹(ç¶ )</strong>ï¼šå£“åŠ›å—é˜»å›è·Œã€‚ç›®æ¨™ = å£“åŠ›ç·š(ä¸Šç·£) - æ——æ¡¿é•·ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æ——æ¡¿é«˜åº¦ H
            const poleHeight = v.flagStartHigh - v.poleBtm; 
            
            // ==========================================
            // ğŸ“ ä¸‹é™æ¥”å‹å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_pole_end = 1;   
            const t_break = 7;      // â˜… æ±ºç­–é» T7
            const t_target = v.duration - 1;

            // å¹¾ä½•åƒæ•¸è¨­å®š (ä¸‹é™æ”¶æ–‚)
            // ä¸Šæ–¹å£“å¾—å¿« (Steep)
            const slopeTop = -2.5; 
            // ä¸‹æ–¹è·Œå¾—æ…¢ (Gentle) -> å½¢æˆæ¥”å‹
            const slopeBtm = -0.8; 

            // å»ºç«‹æ–¹ç¨‹å¼
            const getTopLine = (t) => v.flagStartHigh + slopeTop * (t - t_pole_end);
            const getBtmLine = (t) => v.flagStartLow + slopeBtm * (t - t_pole_end);

            // è¨ˆç®— T7 ç•¶ä¸‹çš„é€šé“é‚Šç•Œåƒ¹
            const priceTopAtBreak = getTopLine(t_break);
            const priceBtmAtBreak = getBtmLine(t_break);

            // â˜… T7 æ±ºç­–é»ï¼šå¼·åˆ¶è²¼åœ¨ã€Œä¸‹é™å£“åŠ›ç·š (ä¸Šç·£)ã€
            const breakPrice = priceTopAtBreak;

            // â˜… ä¿å®ˆç›®æ¨™åƒ¹è¨ˆç®—
            // å¤šæ–¹ï¼šå¾è¼ƒä½çš„æ”¯æ’ç·šåŠ ä¸Š H (ä¿å®ˆæ¸¬å¹…)
            const targetBull = getBtmLine(t_break-2) + poleHeight;

            // ç©ºæ–¹ï¼šå¾è¼ƒé«˜çš„å£“åŠ›ç·šæ‰£é™¤ H
            let targetBear = getTopLine(t_break) - poleHeight;
            if (targetBear < 0) targetBear = 0; 

            // å»ºæ§‹ K ç·šè·¯å¾‘ (å¯¬ç‰ˆä¸‹é™éœ‡ç›ª)
            let chartPoints = [];
            
            chartPoints[0] = v.poleBtm;       // T0
            chartPoints[1] = v.flagStartHigh; // T1: é ‚
            
            // --- ç¬¬ä¸€æ³¢ ---
            chartPoints[2] = getBtmLine(2);   // T2: æ¸¬åº•
            // T3: ä¸­ç¹¼
            chartPoints[3] = (getBtmLine(2) + getTopLine(4)) / 2;
            
            // --- ç¬¬äºŒæ³¢ (æ”¶æ–‚ä¸­) ---
            chartPoints[4] = getTopLine(4);   // T4: æ”»é ‚ (é«˜é»å¤§å¹…é™ä½)
            chartPoints[5] = getBtmLine(5);   // T5: æ¸¬åº• (ä½é»å¾®å¹…é™ä½)
            
            // T6: ä¸­ç¹¼
            chartPoints[6] = (getBtmLine(5) + getTopLine(7)) / 2;
            
            // --- æ±ºç­–æ™‚åˆ» ---
            chartPoints[7] = breakPrice;      // T7: é ‚ç«¯æ±ºç­–

            // å¡«ç©º
            for (let i = 8; i <= t_target; i++) chartPoints.push(null); 

            return {
                entry: breakPrice,
                target: targetBull,
                stop: priceBtmAtBreak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ——æ¡¿
                    { x1: 0, x2: 1, y1: v.poleBtm, y2: v.flagStartHigh, color: '#e74c3c', label: 'æ——æ¡¿' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (é™¡é™)
                    { x1: 1, x2: t_break, y1: v.flagStartHigh, y2: priceTopAtBreak, color: '#2ecc71', label: 'æ”¶æ–‚å£“åŠ›' },
                    
                    // C. ä¸‹æ–¹æ”¯æ’ç·š (ç·©é™)
                    { x1: 1, x2: t_break, y1: v.flagStartLow, y2: priceBtmAtBreak, color: '#2ecc71', label: 'æ”¶æ–‚æ”¯æ’' },

                    // D. ç›®æ¨™åƒ¹ç·š-å¤š
                    { x1: t_break, x2: t_target, y1: targetBull, y2: targetBull, color: '#e74c3c', label: 'ç›®æ¨™åƒ¹-å¤š' },
                    
                    // E. ç›®æ¨™åƒ¹ç·š-ç©º
                    { x1: t_break, x2: t_target, y1: targetBear, y2: targetBear, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹-ç©º' },

                    // F. æ¸¬å¹… H
                    { x1: 0.5, x2: 0.5, y1: v.poleBtm, y2: v.flagStartHigh, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // G. å¤šæ–¹è·¯å¾‘ (ç´…è™›ç·š - çªç ´)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBull, color: '#e74c3c', dashed: true, label: 'çªç ´' },
                    
                    // H. ç©ºæ–¹è·¯å¾‘ (ç¶ è™›ç·š - åè½‰)
                    { x1: t_break, x2: t_target, y1: breakPrice, y2: targetBear, color: '#2ecc71', dashed: true, label: 'åè½‰' },
                    
                    // I. å¤šæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸Š)
                    { x1: t_break-2, x2: t_break-2, y1: getBtmLine(t_break-2), y2: targetBull, color: '#3498db', dashed: true, label: 'å‘ä¸Šæ¸¬å¹…' },
                    
                    // J. ç©ºæ–¹è·¯å¾‘ç¤ºæ„ (è—è‰²è™›ç·š - å‘ä¸‹)
                    // å¾ T7 (Top) ç›´æ¥ç•«ä¸‹ä¾†
                    { x1: t_break, x2: t_break, y1: getTopLine(t_break), y2: targetBear, color: '#3498db', dashed: true, label: 'å‘ä¸‹æ¸¬å¹…' }
                ],
                
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: t_break,
                        yValue: breakPrice,
                        backgroundColor: '#95a5a6',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    },
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBull,
                        backgroundColor: '#e74c3c',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'å¤šæ–¹'
                    },
                    {
                        type: 'point',
                        xValue: t_target,
                        yValue: targetBear,
                        backgroundColor: '#2ecc71',
                        radius: 8,
                        borderColor: 'white',
                        borderWidth: 2,
                        label: 'ç©ºæ–¹'
                    }
                ]
            };
        }
    },

    // ------------------------------------------
    // C. ä¸‹è·Œå‹æ…‹ (Bearish)
    // ------------------------------------------
	vTop: {
        name: "1. å€’Vå­—å‹ (Inverted V) - å°–é ­åè½‰",
        type: "bear", // æ˜ç¢ºçš„ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "startPrice", label: "èµ·æ¼²é ¸ç·š", default: 50 },
            { id: "peakPrice", label: "æœ€é«˜åƒ¹", default: 90 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹å‘ˆç¾å™´å‡ºå¼æ€¥æ¼²ï¼Œéš¨å¾Œåœ¨ç„¡é è­¦ä¸‹å‡ºç¾ã€Œå°–é ­åè½‰ã€æ€¥æ®ºã€‚å·¦å´æ€éº¼æ¼²ï¼Œå³å´å°±æ€éº¼è·Œï¼Œå®Œå…¨æŠ¹æ»…æ¼²å¹…ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>T7 æ±ºç­–é»ç‚º<strong>ã€Œå›æ¸¬é ¸ç·šã€</strong>(åœ–ä¸­è—é»è™•)ã€‚æ€¥è·Œç ´ç·šå¾Œé€šå¸¸æœƒæœ‰å¾®å¹…åå½ˆï¼Œæ¸¬è©¦é ¸ç·šå£“åŠ›ï¼Œæ­¤ç‚ºç¢ºèªç©ºé ­çš„æœ€å¾Œé€ƒå‘½/æ”¾ç©ºé»ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ç©ºæ–¹)ã€‘</strong><br>
            1. <strong>é€²å ´</strong>ï¼šT7 åå½ˆæ¸¬è©¦é ¸ç·šä¸éæ™‚æ”¾ç©ºã€‚<br>
            2. <strong>ç›®æ¨™</strong>ï¼šé ¸ç·š - (æœ€é«˜åƒ¹ - é ¸ç·š)ã€‚å³å‘ä¸‹æ˜ ç…§ä¸€æ®µç­‰å¹…è·Œå¹…ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—é«˜åº¦ H
            const height = v.peakPrice - v.startPrice;
            
            // ==========================================
            // ğŸ“ å€’Vå­—å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_start = 0;
            const t_peak = 3;     // T3 è¦‹é ‚
            const t_return = 6;   // T6 å›åˆ°èµ·é» (è·Œç ´)
            const t_test = 7;     // â˜… T7 å›æ¸¬é ¸ç·š (æ±ºç­–é»)
            const t_target = v.duration - 1;

            // é ¸ç·š (æ°´å¹³)
            const neckline = v.startPrice;

            // â˜… ç©ºæ–¹ç›®æ¨™åƒ¹è¨ˆç®— (å‘ä¸‹ç­‰å¹…æ¸¬è·)
            // Target = é ¸ç·š - H
            let targetPrice = neckline - height;
            // ç‚ºäº†ç•«åœ–ç¾è§€ï¼Œå¦‚æœç›®æ¨™åƒ¹æ˜¯è² çš„ï¼Œé™åˆ¶åœ¨ 0 æˆ–ä½é»
            if (targetPrice < 5) targetPrice = 5;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // T0: èµ·æ¼²
            chartPoints[0] = neckline;
            
            // T1~T2: æ€¥æ¼²ä¸­é€”
            chartPoints[1] = neckline + height * 0.4;
            chartPoints[2] = neckline + height * 0.8;
            
            // T3: å°–é ­é ‚ (çˆ†é‡)
            chartPoints[3] = v.peakPrice;
            
            // T4~T5: æ€¥æ®ºä¸­é€”
            chartPoints[4] = neckline + height * 0.7; // æ®ºå¾—æ¯”æ¼²å¾—å¿«ä¸€é»
            chartPoints[5] = neckline + height * 0.3;
            
            // T6: å›åˆ°é ¸ç·š (è·Œç ´å‰å¤•/å‰›å¥½è·Œç ´)
            chartPoints[6] = neckline - (height * 0.05); // å¾®ç ´
            
            // T7: â˜… åå½ˆå›æ¸¬é ¸ç·š (æ±ºç­–é»)
            // ç¢°åˆ°é ¸ç·šå°±ä¸‹ä¾†ï¼Œä»£è¡¨å£“åŠ›ç¢ºèª
            chartPoints[7] = neckline;

            // T8~T11: çºŒè·Œè‡³ç›®æ¨™
            // æ¨¡æ“¬åœ–ä¸­å³å´çš„ç®­é ­è·¯å¾‘
            for (let i = 8; i <= t_target; i++) {
                // ç·šæ€§éæ¸›åˆ°ç›®æ¨™åƒ¹
                const progress = (i - 7) / (t_target - 7);
                chartPoints[i] = neckline - (neckline - targetPrice) * progress;
            }

            return {
                entry: neckline, // åœ¨é ¸ç·šè™•é€²å ´ç©º
                target: targetPrice,
                stop: v.peakPrice, // åœæè¨­åœ¨å¤©èŠ±æ¿(æˆ–è¨­ç‚º H çš„ä¸€åŠ)
                
                points: chartPoints,
                
                trendlines: [
                    // A. é ¸ç·š (ç¶ è‰²æ°´å¹³ç·š)
                    { x1: 0, x2: t_target, y1: neckline, y2: neckline, color: '#2ecc71', label: 'é ¸ç·š(æ”¯æ’/å£“åŠ›)' },
                    
                    // B. ä¸Šæ¼²è·¯å¾‘ (å·¦å´)
                    { x1: 0, x2: t_peak, y1: neckline, y2: v.peakPrice, color: '#e74c3c', label: 'æ€¥æ¼²' },
                    
                    // C. ä¸‹è·Œè·¯å¾‘ (å³å´)
                    { x1: t_peak, x2: t_return, y1: v.peakPrice, y2: neckline, color: '#2ecc71', label: 'æ€¥æ®º' },

                    // D. ç›®æ¨™åƒ¹æ¸¬å¹…ç·š (è—è‰²è™›ç·š - å‘ä¸‹)
                    { x1: t_test, x2: t_test, y1: neckline, y2: targetPrice, color: '#3498db', dashed: true, label: 'è·Œå¹…æ»¿è¶³' },
                    
                    // E. é«˜åº¦æ¸¬é‡ (è—è‰²è™›ç·š - å‘ä¸Š)
                    { x1: t_peak, x2: t_peak, y1: neckline, y2: v.peakPrice, color: '#3498db', dashed: true, label: 'æ¼²å¹…H' },
                    
                    // F. çºŒè·Œè·¯å¾‘ (ç©ºæ–¹èµ°å‹¢)
                    { x1: t_test, x2: t_target, y1: neckline, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ä¸»è·Œæ®µ' }
                ],
            };
        }
    },
	nTop: {
        name: "2. å€’Nå­—é ‚ (Inverted N-Top) - å¼±å‹¢åå½ˆæ®º",
        type: "bear", // ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "neckline", label: "é ¸ç·šæ”¯æ’", default: 50 },
            { id: "peakPrice", label: "é ­éƒ¨æœ€é«˜åƒ¹", default: 90 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹å‰µé«˜(é ­éƒ¨)å¾Œå›æª”ï¼Œéš¨å¾Œå‡ºç¾ã€Œå¼±å‹¢åå½ˆã€ã€‚å³è‚©(T5)åƒ…åå½ˆè‡³è·Œå¹…çš„ 1/2 å³ç„¡åŠ›ä¸Šæ”»ï¼Œå½¢æˆå€’ N å­—çµæ§‹ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>T7 æ±ºç­–é»ç‚º<strong>ã€Œè·Œç ´é ¸ç·šã€</strong>ã€‚ä½†çœŸæ­£çš„ç©ºæ–¹ç™¼å‹•é»å§‹æ–¼ T5 (å³è‚©ç¢ºèªä¸éé«˜)ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (å‹™å¯¦ç©ºæ–¹)ã€‘</strong><br>
            1. <strong>é€²å ´</strong>ï¼šT5 å³è‚©è½‰æŠ˜å‘ä¸‹æ™‚ä½ˆå±€ç©ºå–®ã€‚<br>
            2. <strong>ç›®æ¨™</strong>ï¼šå³è‚©é«˜é»(T5) - é ­éƒ¨é«˜åº¦(H)ã€‚æ­¤æ¸¬å¹…å¾åå½ˆé ‚é»èµ·ç®—ï¼Œç²åˆ©ç›®æ¨™è¼ƒå®¹æ˜“é”æˆã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—é ­éƒ¨é«˜åº¦ H
            const headHeight = v.peakPrice - v.neckline;
            
            // è¨ˆç®—å³å³°é«˜åº¦ (T5, 1/2 åå½ˆ)
            const bouncePrice = v.neckline + headHeight * 0.5;

            // ==========================================
            // ğŸ“ å€’Nå­—å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_start = 0;
            const t_head = 2;     // T2: é ­éƒ¨
            const t_neck_1 = 4;   // T4: é ¸ç·š
            const t_bounce = 5;   // T5: å³è‚© (1/2)
            const t_break = 7;    // T7: è·Œç ´
            const t_target = v.duration - 1;

            // â˜… ä¿®æ­£ç›®æ¨™åƒ¹å…¬å¼ï¼šTarget = T5 - H
            let targetPrice = bouncePrice - headHeight;
            if (targetPrice < 5) targetPrice = 5;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            chartPoints[0] = v.neckline;
            chartPoints[1] = v.neckline + headHeight * 0.6;
            chartPoints[2] = v.peakPrice; // é ­éƒ¨
            chartPoints[3] = v.neckline + headHeight * 0.4;
            chartPoints[4] = v.neckline; // å›æ¸¬é ¸ç·š
            
            // T5: å³è‚©
            chartPoints[5] = bouncePrice;
            
            chartPoints[6] = v.neckline + (bouncePrice - v.neckline) * 0.3; 
            
            // T7: è·Œç ´é ¸ç·š
            chartPoints[7] = v.neckline; 

            // T8~End: æ®ºè‡³ç›®æ¨™
            for (let i = 8; i <= t_target; i++) {
                const progress = (i - 7) / (t_target - 7);
                // é€™è£¡ç¨å¾®èª¿æ•´æ›²ç·šï¼Œè®“å®ƒæœ€å¾Œæ”¶åœ¨ targetPrice
                // ç‚ºäº†è¦–è¦ºé€£è²«ï¼Œå¾é ¸ç·š(T7) é€£åˆ° Target
                chartPoints[i] = v.neckline - (v.neckline - targetPrice) * progress;
            }

            return {
                entry: bouncePrice, // å»ºè­°é€²å ´é»æ”¹ç‚º T5 (å› æ¸¬å¹…å¾é€™é–‹å§‹)
                target: targetPrice,
                stop: v.peakPrice, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. é ¸ç·š
                    { x1: 0, x2: t_target, y1: v.neckline, y2: v.neckline, color: '#2ecc71', label: 'é ¸ç·š' },
                    
                    // B. é ­éƒ¨é«˜åº¦æ¸¬é‡ (H)
                    { x1: t_head, x2: t_head, y1: v.neckline, y2: v.peakPrice, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // C. 1/2 åå½ˆæ¨™ç¤º
                    //{ x1: t_bounce, x2: t_bounce, y1: v.neckline, y2: bouncePrice, color: '#3498db', dashed: true },
                    
                    // D. â˜… ç›®æ¨™åƒ¹æ¸¬å¹… (å¾ T5 å¾€ä¸‹ç•« H)
                    { x1: t_bounce, x2: t_bounce, y1: bouncePrice, y2: targetPrice, color: '#3498db', dashed: true, label: 'è·Œå¹…H (å¾T5ç®—)' },
                    
                    // E. ç›®æ¨™åƒ¹æ°´å¹³ç·š (è¦–è¦ºè¼”åŠ©)
                    //{ x1: t_bounce, x2: t_target, y1: targetPrice, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ç›®æ¨™åƒ¹' },
                    
                    // F. Kç·šè·¯å¾‘é€£ç·š
                    { x1: 0, x2: t_head, y1: v.neckline, y2: v.peakPrice, color: '#e74c3c' },
                    { x1: t_head, x2: t_neck_1, y1: v.peakPrice, y2: v.neckline, color: '#2ecc71' },
                    { x1: t_neck_1, x2: t_bounce, y1: v.neckline, y2: bouncePrice, color: '#e74c3c' },
                    { x1: t_bounce, x2: t_break, y1: bouncePrice, y2: v.neckline, color: '#2ecc71' },
                    { x1: t_break, x2: t_target, y1: v.neckline, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'å´©è·Œ' }
                ],
            };
        }
    },
	hsTop: {
        name: "3. é ­å°–é ‚ (Head & Shoulders) - ç¶“å…¸æ¸¬å¹…æ®º",
        type: "bear", // ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "neckline", label: "é ¸ç·šæ”¯æ’", default: 50 },
            { id: "headPeak", label: "é ­éƒ¨æœ€é«˜åƒ¹", default: 90 },
            { id: "shoulderPeak", label: "è‚©éƒ¨é«˜åº¦", default: 70 }, // å·¦å³è‚©é«˜åº¦
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>å¾é ¸ç·šèµ·æ¼²ï¼Œç¶“æ­·ã€Œå·¦è‚©ã€é ­éƒ¨ã€å³è‚©ã€ä¸‰æ¬¡æ”»é ‚ã€‚å³è‚©åå½ˆç„¡åŠ›(åƒ…é”ç´„ 1/2 è™•)ï¼Œä¸”å¤šæ¬¡å›æ¸¬é ¸ç·šæ”¯æ’ï¼Œé¡¯ç¤ºå¤šé ­å¤§å‹¢å·²å»ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>T7 æ±ºç­–é»ç‚º<strong>ã€Œè·Œç ´é ¸ç·šã€</strong>ã€‚åœ–ä¸­æ¨¡æ“¬äº†è·Œç ´å¾Œçš„ã€Œå›æ¸¬å‹•ä½œã€(Retest)ï¼Œæ­¤ç‚ºç¢ºèªé ¸ç·šç”±æ”¯æ’è½‰å£“åŠ›çš„é—œéµæ™‚åˆ»ï¼Œä¹Ÿæ˜¯çµ•ä½³ç©ºé»ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ç©ºæ–¹)ã€‘</strong><br>
            1. <strong>é€²å ´</strong>ï¼šè·Œç ´é ¸ç·š(T7)æˆ–å›æ¸¬é ¸ç·šä¸é(T8)æ™‚ã€‚<br>
            2. <strong>ç›®æ¨™</strong>ï¼šé ¸ç·š - (é ­éƒ¨ - é ¸ç·š)ã€‚å³å‘ä¸‹æ˜ ç…§ã€Œç­‰å¹…æ¸¬è·ã€ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—é ­éƒ¨é«˜åº¦ H
            const headHeight = v.headPeak - v.neckline;
            
            // ==========================================
            // ğŸ“ é ­è‚©é ‚å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_start = 0;
            const t_l_shoulder = 1; // T1: å·¦è‚©
            const t_neck_1 = 2;     // T2: é ¸ç·š
            const t_head = 3;       // T3: é ­éƒ¨
            const t_neck_2 = 4;     // T4: é ¸ç·š
            const t_r_shoulder = 5; // T5: å³è‚©
            const t_break = 7;      // â˜… T7: è·Œç ´é ¸ç·š (æ±ºç­–é»)
            const t_retest = 8;     // T8: å›æ¸¬ (Kiss Goodbye)
            const t_target = v.duration - 1;

            // â˜… ç›®æ¨™åƒ¹è¨ˆç®—ï¼šTarget = é ¸ç·š - H
            let targetPrice = v.neckline - headHeight;
            if (targetPrice < 5) targetPrice = 5;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // T0: â˜… èµ·é» (ä¿®æ­£ï¼šå°é½Šé ¸ç·š)
            chartPoints[0] = v.neckline;
            
            // T1: å·¦è‚©
            chartPoints[1] = v.shoulderPeak; 
            
            // T2: å›é ¸ç·š
            chartPoints[2] = v.neckline;     
            
            // T3: é ­éƒ¨
            chartPoints[3] = v.headPeak;     
            
            // T4: å›é ¸ç·š
            chartPoints[4] = v.neckline;     
            
            // T5: å³è‚©
            chartPoints[5] = v.shoulderPeak; 
            
            // T6: è·Œç ´å‰å¤• (é€¼è¿‘é ¸ç·š)
            chartPoints[6] = v.neckline + (v.shoulderPeak - v.neckline) * 0.3;
            
            // T7: â˜… è·Œç ´é ¸ç·š
            chartPoints[7] = v.neckline; 

            // T8: å›æ¸¬ (ç¨å¾®åå½ˆä¸€ä¸‹ï¼Œç¢°åˆ°é ¸ç·šä¸‹ç·£)
            chartPoints[8] = v.neckline - 1; 

            // T9~End: æ®ºè‡³ç›®æ¨™
            for (let i = 9; i <= t_target; i++) {
                const progress = (i - 8) / (t_target - 8);
                chartPoints[i] = v.neckline - (v.neckline - targetPrice) * progress;
            }

            return {
                entry: v.neckline,
                target: targetPrice,
                stop: v.shoulderPeak, 
                
                points: chartPoints,
                
                trendlines: [
                    // A. é ¸ç·š (ç¶ è‰²æ°´å¹³ç·š)
                    { x1: 0, x2: t_target, y1: v.neckline, y2: v.neckline, color: '#2ecc71', label: 'é ¸ç·š' },
                    
                    // B. é ­éƒ¨é«˜åº¦æ¸¬é‡ (H)
                    { x1: t_head, x2: t_head, y1: v.neckline, y2: v.headPeak, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // C. å³è‚© 1/2 é«˜åº¦æ¨™ç¤º
                    { x1: t_neck_2, x2: t_break, y1: v.shoulderPeak, y2: v.shoulderPeak, color: '#9b59b6', label: '1/2å£“åŠ›' },
                    
                    // D. ç›®æ¨™åƒ¹æ¸¬å¹… (å¾é ¸ç·šå¾€ä¸‹ç•« H)
                    { x1: t_break, x2: t_break, y1: v.neckline, y2: targetPrice, color: '#3498db', dashed: true, label: 'è·Œå¹…H' },
                    
                    // E. ç›®æ¨™åƒ¹æ°´å¹³ç·š
                    //{ x1: t_break, x2: t_target, y1: targetPrice, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ç›®æ¨™åƒ¹' },
                    
                    // F. è·¯å¾‘é€£ç·š
                    // å·¦è‚©æ®µ (å¾é ¸ç·šé–‹å§‹)
                    { x1: 0, x2: t_l_shoulder, y1: v.neckline, y2: v.shoulderPeak, color: '#e74c3c' },
                    { x1: t_l_shoulder, x2: t_neck_1, y1: v.shoulderPeak, y2: v.neckline, color: '#2ecc71' },
                    // é ­éƒ¨æ®µ
                    { x1: t_neck_1, x2: t_head, y1: v.neckline, y2: v.headPeak, color: '#e74c3c' },
                    { x1: t_head, x2: t_neck_2, y1: v.headPeak, y2: v.neckline, color: '#2ecc71' },
                    // å³è‚©æ®µ
                    { x1: t_neck_2, x2: t_r_shoulder, y1: v.neckline, y2: v.shoulderPeak, color: '#e74c3c' },
                    { x1: t_r_shoulder, x2: t_break, y1: v.shoulderPeak, y2: v.neckline, color: '#2ecc71' },
                    
                    // G. å´©è·Œè·¯å¾‘ (å«å›æ¸¬)
                    { x1: t_break, x2: t_retest, y1: v.neckline, y2: chartPoints[8], color: '#e74c3c', dashed: true },
                    { x1: t_retest, x2: t_target, y1: chartPoints[8], y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ä¸»è·Œæ®µ' }
                ],
            };
        }
    },
	complexHsTop: {
        name: "4. è¤‡å¼é ­å°–é ‚ (Complex H&S) - å¤šè‚©ç›¤æ•´æ®º",
        type: "bear", // ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "neckline", label: "é ¸ç·šæ”¯æ’", default: 50 },
            { id: "headPeak", label: "é ­éƒ¨æœ€é«˜åƒ¹", default: 90 },
            { id: "shoulderPeak", label: "è‚©éƒ¨é«˜åº¦", default: 70 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 15 } // é–‹åˆ°15ä»¥å®¹ç´T14
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>æ¯”æ¨™æº–é ­è‚©é ‚æ›´è¤‡é›œï¼Œæ“æœ‰ã€Œé›™å·¦è‚©ã€èˆ‡ã€Œé›™å³è‚©ã€çš„äº”å³°çµæ§‹ã€‚é¡¯ç¤ºä¸»åŠ›åœ¨é«˜æª”å‡ºè²¨æ™‚é–“æ‹‰é•·ï¼Œç±Œç¢¼æ¾å‹•æ›´åš´é‡ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>T12 æ±ºç­–é»ç‚º<strong>ã€Œè·Œç ´é ¸ç·šã€</strong>ã€‚ç”±æ–¼ç¶“æ­·äº†é•·æ™‚é–“çš„ã€Œå¤šè‚©ã€ç›¤æ•´ï¼Œä¸€æ—¦é ¸ç·šå¤±å®ˆï¼Œç´¯ç©çš„å¥—ç‰¢è³£å£“å°‡å¼•ç™¼æ›´æ·±å¹…çš„å´©è·Œã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ç©ºæ–¹)ã€‘</strong><br>
            1. <strong>é€²å ´</strong>ï¼šT11 åå½ˆä¸éé«˜æ™‚(æ¿€é€²)ï¼Œæˆ– T12 è·Œç ´é ¸ç·šæ™‚(ä¿å®ˆ)ã€‚<br>
            2. <strong>ç›®æ¨™</strong>ï¼šé ¸ç·š - (é ­éƒ¨ - é ¸ç·š)ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—é ­éƒ¨é«˜åº¦ H
            const headHeight = v.headPeak - v.neckline;
            
            // ==========================================
            // ğŸ“ T14 æ™‚é–“è»¸è¦åŠƒ (ç¸½é•· 14æ ¼)
            // ==========================================
            // T0 start
            // Left M: T0->T1(å³°)->T2(åº•)->T3(å³°)->T4(åº•)
            // Head V: T4->T6(é ‚)->T8(åº•)  <-- é ­éƒ¨æ™‚é–“æ‹‰é•·ä¸€é»é¡¯å¾—å¤§å™¨
            // Right M: T8->T9(å³°)->T10(åº•)->T11(å³°)->T12(è·Œç ´)
            // Drop: T12->T14
            
            const t_break = 12; // æ±ºç­–é»å»¶å¾Œåˆ° T12
            const t_target = 14;

            // â˜… ç›®æ¨™åƒ¹è¨ˆç®—
            let targetPrice = v.neckline - headHeight;
            if (targetPrice < 5) targetPrice = 5;

            // å»ºæ§‹ K ç·šè·¯å¾‘ (æ•´æ•¸é»ä½ç²¾ç¢ºå®šç¾©)
            let chartPoints = [];
            
            // --- å·¦å° M ---
            chartPoints[0] = v.neckline;
            chartPoints[1] = v.shoulderPeak; 
            chartPoints[2] = v.neckline;     // è²¼é ¸
            chartPoints[3] = v.shoulderPeak;
            chartPoints[4] = v.neckline;     // è²¼é ¸ (æ¥é ­éƒ¨)
            
            // --- ä¸­é–“å€’ V (é ­) ---
            // T5 æ˜¯ä¸Šæ¼²ä¸­é€”
            chartPoints[5] = (v.neckline + v.headPeak) / 2; 
            chartPoints[6] = v.headPeak;     // é ­é ‚
            // T7 æ˜¯ä¸‹è·Œä¸­é€”
            chartPoints[7] = (v.neckline + v.headPeak) / 2;
            chartPoints[8] = v.neckline;     // è²¼é ¸ (æ¥å³è‚©)
            
            // --- å³å° M ---
            chartPoints[9] = v.shoulderPeak;
            chartPoints[10] = v.neckline;    // è²¼é ¸
            chartPoints[11] = v.shoulderPeak;
            chartPoints[12] = v.neckline;    // â˜… T12 è·Œç ´é»
            
            // --- å´©è·Œæ®µ ---
            // T13
            chartPoints[13] = v.neckline - (v.neckline - targetPrice) * 0.5;
            // T14 ç›®æ¨™
            chartPoints[14] = targetPrice;

            return {
                entry: v.neckline,
                target: targetPrice,
                stop: v.shoulderPeak,
                
                points: chartPoints,
                
                trendlines: [
                    // A. é ¸ç·š (è²«ç©¿å…¨å ´)
                    { x1: 0, x2: t_target, y1: v.neckline, y2: v.neckline, color: '#2ecc71', label: 'é ¸ç·š(éµæ¿)' },
                    
                    // ====================================
                    // B. å·¦å° M (Left M) - T0~T4
                    // ====================================
                    { x1: 0, x2: 1, y1: v.neckline, y2: v.shoulderPeak, color: '#e74c3c' },
                    { x1: 1, x2: 2, y1: v.shoulderPeak, y2: v.neckline, color: '#2ecc71' },
                    { x1: 2, x2: 3, y1: v.neckline, y2: v.shoulderPeak, color: '#e74c3c' },
                    { x1: 3, x2: 4, y1: v.shoulderPeak, y2: v.neckline, color: '#2ecc71' },

                    // ====================================
                    // C. ä¸­é–“å€’ V (Head) - T4~T8
                    // ====================================
                    { x1: 4, x2: 6, y1: v.neckline, y2: v.headPeak, color: '#e74c3c' }, // ç·©æ¼²æ”»é ­
                    { x1: 6, x2: 8, y1: v.headPeak, y2: v.neckline, color: '#2ecc71' }, // ç·©è·Œå›é ¸
                    
                    // ====================================
                    // D. å³å° M (Right M) - T8~T12
                    // ====================================
                    { x1: 8, x2: 9, y1: v.neckline, y2: v.shoulderPeak, color: '#e74c3c' },
                    { x1: 9, x2: 10, y1: v.shoulderPeak, y2: v.neckline, color: '#2ecc71' },
                    { x1: 10, x2: 11, y1: v.neckline, y2: v.shoulderPeak, color: '#e74c3c' },
                    { x1: 11, x2: 12, y1: v.shoulderPeak, y2: v.neckline, color: '#2ecc71' }, // â˜… T12 è·Œç ´

                    // ====================================
                    // E. æ¸¬å¹…èˆ‡å´©è·Œ
                    // ====================================
                    
                    // é ­éƒ¨é«˜åº¦ H (ç•«åœ¨ T6)
                    { x1: 6, x2: 6, y1: v.neckline, y2: v.headPeak, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // è·Œå¹… H (å¾ T12 å¾€ä¸‹ç•«)
                    { x1: 12, x2: 12, y1: v.neckline, y2: targetPrice, color: '#3498db', dashed: true, label: 'è·Œå¹…H' },
                    
                    // å´©è·Œè·¯å¾‘
                    { x1: 12, x2: 14, y1: v.neckline, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ä¸»è·Œæ®µ' }
                ],
            };
        }
    },
	doubleTop: {
        name: "5. é›™é‡é ‚/Mé ­ (Double Top) - é ¸ç·šè·Œç ´æ®º",
        type: "bear", // ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "neckline", label: "é ¸ç·šæ”¯æ’", default: 50 },
            { id: "peakPrice", label: "å·¦å³°é«˜åº¦", default: 90 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹å…©åº¦æ”»é ‚å¤±æ•—ï¼Œå½¢æˆé¡ä¼¼è‹±æ–‡å­—æ¯ã€ŒMã€çš„èµ°å‹¢ã€‚åœ–ä¸­å³å³°ç•¥ä½æ–¼å·¦å³°ï¼Œé¡¯ç¤ºå¤šé ­å‹•èƒ½è¡°é€€ï¼Œä¸”ä¸Šæ–¹å£“åŠ›ç·šé€æ¼¸å£“ä½ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>T8 æ±ºç­–é»ç‚º<strong>ã€Œè·Œç ´é ¸ç·šã€</strong>(è—é»è™•)ã€‚å…©å³°ä¹‹é–“çš„ä½é»(T4)ç¢ºç«‹äº†é ¸ç·šä½ç½®ï¼Œä¸€æ—¦æ­¤æ”¯æ’å¤±å®ˆï¼Œä¸Šæ–¹å¥—ç‰¢è³£å£“å°‡å…¨æ•¸æ¹§å‡ºã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ç©ºæ–¹)ã€‘</strong><br>
            1. <strong>é€²å ´</strong>ï¼šT8 è·Œç ´é ¸ç·šæ™‚ã€‚<br>
            2. <strong>ç›®æ¨™</strong>ï¼šé ¸ç·š - (é ­éƒ¨ - é ¸ç·š)ã€‚å³å‘ä¸‹æ˜ ç…§ã€Œç­‰å¹…æ¸¬è·ã€ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—å·¦å³°é«˜åº¦ H
            const headHeight = v.peakPrice - v.neckline;
            
            // è¨­å®šå³å³°é«˜åº¦ (ç•¥ä½ï¼Œæ¨¡æ“¬åœ–ä¸­ç¶ è‰²å£“åŠ›ç·šå‘ä¸‹)
            const peak2 = v.neckline + headHeight * 0.95; 

            // ==========================================
            // ğŸ“ Mé ­å¹¾ä½•é‹ç®— (å°ç¨±çµæ§‹)
            // ==========================================
            
            const t_start = 0;
            const t_peak1 = 2;    // å·¦å³°
            const t_mid = 4;      // ä¸­é–“è°·åº• (é ¸ç·š)
            const t_peak2 = 6;    // å³å³°
            const t_break = 8;    // â˜… T8: è·Œç ´é ¸ç·š
            const t_target = v.duration - 1;

            // â˜… ç›®æ¨™åƒ¹è¨ˆç®—
            let targetPrice = v.neckline - headHeight;
            if (targetPrice < 5) targetPrice = 5;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // T0: èµ·é» (å°é½Šé ¸ç·š)
            chartPoints[0] = v.neckline;
            
            // T1: æ”»é ‚é€”ä¸­
            chartPoints[1] = v.neckline + headHeight * 0.6;
            
            // T2: å·¦å³°
            chartPoints[2] = v.peakPrice;
            
            // T3: å›æª”é€”ä¸­
            chartPoints[3] = v.neckline + headHeight * 0.4;
            
            // T4: â˜… é ¸ç·š (Mçš„ä¸­é–“)
            chartPoints[4] = v.neckline;
            
            // T5: åå½ˆé€”ä¸­
            chartPoints[5] = v.neckline + (peak2 - v.neckline) * 0.6;
            
            // T6: å³å³°
            chartPoints[6] = peak2;
            
            // T7: ä¸‹æ®ºé€”ä¸­
            chartPoints[7] = v.neckline + (peak2 - v.neckline) * 0.3;
            
            // T8: â˜… è·Œç ´é ¸ç·š (æ±ºç­–é»)
            chartPoints[8] = v.neckline;

            // T9~End: å´©è·Œè‡³ç›®æ¨™
            for (let i = 9; i <= t_target; i++) {
                const progress = (i - 8) / (t_target - 8);
                chartPoints[i] = v.neckline - (v.neckline - targetPrice) * progress;
            }

            return {
                entry: v.neckline,
                target: targetPrice,
                stop: peak2, // åœæè¨­åœ¨å³å³°
                
                points: chartPoints,
                
                trendlines: [
                    // A. é ¸ç·š (ç¶ è‰²æ°´å¹³ç·š)
                    { x1: 0, x2: t_target, y1: v.neckline, y2: v.neckline, color: '#2ecc71', label: 'é ¸ç·š' },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (é€£æ¥å…©å³°ï¼Œå¾®å¹…å‘ä¸‹)
                    { x1: t_peak1, x2: t_target, y1: v.peakPrice, y2: v.peakPrice - (v.peakPrice - peak2) * ((t_target - t_peak1)/(t_peak2 - t_peak1)), color: '#2ecc71', label: 'å£“åŠ›ç·š' },
                    
                    // C. é«˜åº¦æ¸¬é‡ H (åœ¨ä¸­é–“ç•«)
                    { x1: t_mid, x2: t_mid, y1: v.neckline, y2: v.peakPrice, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // D. è·Œå¹…æ¸¬é‡ H (å¾è·Œç ´é»å¾€ä¸‹ç•«)
                    { x1: t_break, x2: t_break, y1: v.neckline, y2: targetPrice, color: '#3498db', dashed: true, label: 'è·Œå¹…H' },
                    
                    // E. ç›®æ¨™åƒ¹æ°´å¹³ç·š
                    //{ x1: t_break, x2: t_target, y1: targetPrice, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ç›®æ¨™åƒ¹' },
                    
                    // F. Kç·šé€£ç·š
                    { x1: 0, x2: t_peak1, y1: v.neckline, y2: v.peakPrice, color: '#e74c3c' },
                    { x1: t_peak1, x2: t_mid, y1: v.peakPrice, y2: v.neckline, color: '#2ecc71' },
                    { x1: t_mid, x2: t_peak2, y1: v.neckline, y2: peak2, color: '#e74c3c' },
                    { x1: t_peak2, x2: t_break, y1: peak2, y2: v.neckline, color: '#2ecc71' },
                    { x1: t_break, x2: t_target, y1: v.neckline, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ä¸»è·Œæ®µ' }
                ],
            };
        }
    },
	roundingTop: {
        name: "6. åœ“å¼§é ‚ (Rounding Top) - ç·©è·Œå¹³å°æ®º",
        type: "bear", // ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "neckline", label: "é ¸ç·šæ”¯æ’", default: 50 },
            { id: "peakPrice", label: "åœ“å¼§é ‚é«˜", default: 90 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>è‚¡åƒ¹å‘ˆåœ“å¼§ç‹€ç·©æ­¥åšé ­ï¼Œå¤šç©ºå‹¢åŠ›åœ¨æ½›ç§»é»˜åŒ–ä¸­æ˜“ä½ã€‚åœ–ä¸­å³å´åœ¨å´©è·Œå‰å‡ºç¾ä¸€å€‹<strong>ã€Œå°å¹³å°æ•´ç†ã€</strong>(Handle)ï¼Œé€™æ˜¯æœ€å¾Œçš„é€ƒå‘½æ³¢ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>T8 æ±ºç­–é»ç‚º<strong>ã€Œåå½ˆå¤±æ•—è·Œç ´é ¸ç·šã€</strong>ã€‚æ­¤è™•ç¢ºèªå¹³å°æ•´ç†å¤±æ•—ï¼Œå¤šé ­æœ€å¾Œé˜²ç·šå´©æ½°ï¼Œå³å°‡é€²å…¥ä¸»è·Œæ®µã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ç©ºæ–¹)ã€‘</strong><br>
            1. <strong>é€²å ´</strong>ï¼šT8 è·Œç ´é ¸ç·šæ™‚ã€‚<br>
            2. <strong>ç›®æ¨™</strong>ï¼šé ¸ç·š - (é ‚éƒ¨ - é ¸ç·š)ã€‚å³å‘ä¸‹æ˜ ç…§ã€Œåœ“å¼§é«˜åº¦ã€ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—é«˜åº¦ H
            const height = v.peakPrice - v.neckline;
            
            // ==========================================
            // ğŸ“ åœ“å¼§é ‚å¹¾ä½•é‹ç®—
            // ==========================================
            
            const t_top_peak = 3;
            const t_touch_neck = 6;   // â˜… T6: å›åˆ°é ¸ç·š
            const t_handle_peak = 7;  // T7: åå½ˆé«˜é»
            const t_break = 8;        // â˜… T8: è·Œç ´
            const t_target = v.duration - 1;

            // â˜… ç›®æ¨™åƒ¹è¨ˆç®—
            let targetPrice = v.neckline - height;
            if (targetPrice < 5) targetPrice = 5;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            // --- åœ“å¼§ä¸»é«” (T0~T6) ---
            chartPoints[0] = v.neckline;
            chartPoints[1] = v.neckline + height * 0.65; // æ€¥æ¼²ä¸€é»
            chartPoints[2] = v.neckline + height * 0.95; // æ¥è¿‘é ‚
            chartPoints[3] = v.peakPrice;                // é ­é ‚
            chartPoints[4] = v.neckline + height * 0.90; // ç·©è·Œé–‹å§‹
            chartPoints[5] = v.neckline + height * 0.55; // åŠ é€Ÿè·Œ
            
            // T6: â˜… å®Œç¾è²¼é ¸ (æ”¯æ’æ¸¬è©¦)
            chartPoints[6] = v.neckline;
            
            // --- å³å´å¹³å° (èª˜å¤šåå½ˆ) ---
            // T7: å¼±å‹¢åå½ˆ (ç´„ 1/4 é«˜åº¦)
            const handleHeight = v.neckline + height * 0.25;
            chartPoints[7] = handleHeight;
            
            // --- å´©è·Œ ---
            // T8: â˜… è·Œç ´é ¸ç·š (æ±ºç­–é»)
            chartPoints[8] = v.neckline;

            // T9~End: æ®ºè‡³ç›®æ¨™
            for (let i = 9; i <= t_target; i++) {
                const progress = (i - 8) / (t_target - 8);
                chartPoints[i] = v.neckline - (v.neckline - targetPrice) * progress;
            }

            return {
                entry: v.neckline,
                target: targetPrice,
                stop: handleHeight, // åœæè¨­åœ¨åå½ˆé«˜é»
                
                points: chartPoints,
                
                trendlines: [
                    // A. é ¸ç·š (ç¶ è‰²æ°´å¹³ç·š)
                    { x1: 0, x2: t_target, y1: v.neckline, y2: v.neckline, color: '#2ecc71', label: 'é ¸ç·š' },
                    
                    // B. é ­éƒ¨é«˜åº¦æ¸¬é‡ H
                    { x1: t_top_peak, x2: t_top_peak, y1: v.neckline, y2: v.peakPrice, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // C. è·Œå¹…æ¸¬é‡ H
                    { x1: t_break, x2: t_break, y1: v.neckline, y2: targetPrice, color: '#3498db', dashed: true, label: 'è·Œå¹…H' },
                    
                    // D. åœ“å¼§ç¤ºæ„ç·š (ç´«è‰²)
                    // ä½¿ç”¨å¤šæ®µç·šé€¼è¿‘åœ“å¼§
                    //{ x1: 0, x2: 1.5, y1: v.neckline, y2: v.neckline + height*0.8, color: '#9b59b6' }, 
                    //{ x1: 1.5, x2: 4.5, y1: v.neckline + height*0.8, y2: v.neckline + height*0.8, color: '#9b59b6', label: 'åœ“å¼§é ‚' }, 
                    //{ x1: 4.5, x2: 6, y1: v.neckline + height*0.8, y2: v.neckline, color: '#9b59b6' },
                    
                    // E. ç›®æ¨™åƒ¹æ°´å¹³ç·š
                    //{ x1: t_break, x2: t_target, y1: targetPrice, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ç›®æ¨™åƒ¹' },
                    
                    // F. Kç·šé€£ç·š
                    // åœ“å¼§æ®µ
                    { x1: 0, x2: 3, y1: v.neckline, y2: v.peakPrice, color: '#e74c3c' },
                    { x1: 3, x2: 6, y1: v.peakPrice, y2: v.neckline, color: '#2ecc71' },
                    // å¹³å°åå½ˆæ®µ
                    { x1: 6, x2: 7, y1: v.neckline, y2: handleHeight, color: '#e74c3c', dashed: true, label: 'èª˜å¤š' },
                    { x1: 7, x2: 8, y1: handleHeight, y2: v.neckline, color: '#2ecc71' },
                    // ä¸»è·Œæ®µ
                    { x1: 8, x2: t_target, y1: v.neckline, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'ä¸»è·Œæ®µ' }				
                ],
            };
        }
    },
	ascRightTriTop: {
        name: "7. ä¸Šå‡ç›´è§’ä¸‰è§’é ‚ (Ascending Triangle Top) - èª˜å¤šå´©è·Œæ®º",
        type: "bear", // ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "neckline", label: "æ°´å¹³é ¸ç·š", default: 50 },
            { id: "highestPeak", label: "æœ€é«˜å³°å€¼", default: 90 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 15 } // å»¶é•·æ™‚é–“è»¸
        ],
        note: `
			<strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>é«˜é»æŒçºŒå¢Šé«˜(èª˜å¤š)ï¼Œä½†ä½é»æ­»å®ˆåœ¨åŒä¸€æ°´å¹³ç·šä¸Šã€‚é€™é€šå¸¸è¢«è¦–ç‚ºå¤šé ­å‹æ…‹ï¼Œçœ‹ä¼¼å¼·å‹¢ï¼Œä½† T6 å‰µé«˜å¾Œé­é‡æ²ˆé‡è³£å£“æ€¥æ®ºè‡³é ¸ç·š(T8)ï¼Œå› æ­¤ä¸€æ—¦ã€Œå‘ä¸‹è·Œç ´æ°´å¹³æ”¯æ’ã€ï¼Œæ®ºå‚·åŠ›æ¥µå¼·(å¤šæ®ºå¤š)ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>T9 çš„<strong>ã€Œ1/2 å¼±å‹¢åå½ˆã€</strong>æ˜¯é—œéµè­¦è¨Šï¼Œé¡¯ç¤ºå¤šé ­å·²ç„¡åŠ›å†æ”»ã€‚éš¨å¾Œ T10 å›æ¸¬é ¸ç·šï¼Œæœ€çµ‚æ–¼ <strong>T11 æ­£å¼è·Œç ´</strong>ã€‚é€™æ®µã€Œåå½ˆ-å›æ¸¬-è·Œç ´ã€çš„éç¨‹æ˜¯ä¸»åŠ›æœ€å¾Œçš„å‡ºè²¨ç¢ºèªã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ç©ºæ–¹)ã€‘</strong><br>
            1. <strong>é€²å ´</strong>ï¼šT9 åå½ˆä¸éé«˜(æ¿€é€²)ï¼Œæˆ– T11 è·Œç ´æ°´å¹³ç·š(ä¿å®ˆ)ã€‚<br>
            2. <strong>ç›®æ¨™</strong>ï¼šé ¸ç·š - (æœ€é«˜å³° - é ¸ç·š)ã€‚
        `,
        calc: (v) => {
            // è¨ˆç®—æœ€å¤§é«˜åº¦ H (å¾æœ€é«˜å³°ç®—)
            const height = v.highestPeak - v.neckline;
            
            // ç¬¬ä¸€å³°é«˜åº¦ (80%)
            const peak1 = v.neckline + height * 0.8;
            
            // T9 åå½ˆé«˜åº¦ (50%)
            const reboundPeak = v.neckline + height * 0.5;

            // ==========================================
            // ğŸ“ æ™‚é–“è»¸è¦åŠƒ (T0 ~ T14)
            // ==========================================
            // T0: èµ·
            // T2: å³°1
            // T4: å›é ¸
            // T6: å³°2 (æœ€é«˜)
            // T8: å›é ¸
            // T9: åå½ˆ (1/2)
            // T10: å›é ¸ (è²¼é½Š)
            // T11: è·Œç ´
            
            const t_break = 11;   // â˜… T11: è·Œç ´
            const t_target = 14;

            // â˜… ç›®æ¨™åƒ¹è¨ˆç®—
            let targetPrice = v.neckline - height;
            if (targetPrice < 5) targetPrice = 5;

            // å»ºæ§‹ K ç·šè·¯å¾‘
            let chartPoints = [];
            
            chartPoints[0] = v.neckline;
            chartPoints[1] = v.neckline + (peak1 - v.neckline) * 0.6;
            chartPoints[2] = peak1;        // T2: å³°1
            chartPoints[3] = v.neckline + (peak1 - v.neckline) * 0.4;
            chartPoints[4] = v.neckline;   // T4: è²¼é ¸
            chartPoints[5] = v.neckline + height * 0.6;
            chartPoints[6] = v.highestPeak;// T6: æœ€é«˜å³°
            chartPoints[7] = v.neckline + height * 0.3;
            chartPoints[8] = v.neckline;   // T8: è²¼é ¸ (æ€¥æ®ºå¾Œ)
            
            // â˜… T9: 1/2 å¼±å‹¢åå½ˆ
            chartPoints[9] = reboundPeak;
            
            // â˜… T10: å†æ¬¡è²¼é ¸ (ç©ºæ–¹è“„åŠ›)
            chartPoints[10] = v.neckline;
            
            // â˜… T11: è·Œç ´
            chartPoints[11] = v.neckline; // è¦–è¦ºä¸Šå‰›å¥½ç ´ç·š

            // T12~End: å´©è·Œ
            chartPoints[12] = v.neckline - (v.neckline - targetPrice) * 0.4;
            chartPoints[13] = v.neckline - (v.neckline - targetPrice) * 0.8;
            chartPoints[14] = targetPrice;

            return {
                entry: v.neckline,
                target: targetPrice,
                stop: reboundPeak, // åœæè¨­åœ¨ T9 é«˜é»
                
                points: chartPoints,
                
                trendlines: [
                    // A. æ°´å¹³é ¸ç·š (ç¶ è‰²)
                    { x1: 0, x2: t_target, y1: v.neckline, y2: v.neckline, color: '#2ecc71', label: 'æ°´å¹³æ”¯æ’' },
                    
                    // B. ä¸Šå‡å£“åŠ›ç·š (é€£æ¥ T2 å’Œ T6)
                    { x1: 2, x2: 7, y1: peak1, y2: v.highestPeak + (v.highestPeak-peak1)/4, color: '#2ecc71', label: 'èª˜å¤š' },
                    
                    // C. é«˜åº¦æ¸¬é‡ H
                    { x1: 6, x2: 6, y1: v.neckline, y2: v.highestPeak, color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // D. T9 åå½ˆé«˜åº¦ç¤ºæ„ (1/2)
                    { x1: 9, x2: 9, y1: v.neckline, y2: reboundPeak, color: '#9b59b6', dashed: true, label: '1/2' },
                    
                    // E. è·Œå¹…æ¸¬é‡ H (å¾ T11 å¾€ä¸‹ç•«)
                    { x1: 11, x2: 11, y1: v.neckline, y2: targetPrice, color: '#3498db', dashed: true, label: 'è·Œå¹…H' },
                    
                    // F. Kç·šé€£ç·š
                    { x1: 0, x2: 2, y1: v.neckline, y2: peak1, color: '#e74c3c' },
                    { x1: 2, x2: 4, y1: peak1, y2: v.neckline, color: '#2ecc71' },
                    { x1: 4, x2: 6, y1: v.neckline, y2: v.highestPeak, color: '#e74c3c' },
                    { x1: 6, x2: 8, y1: v.highestPeak, y2: v.neckline, color: '#2ecc71', label: 'æ€¥æ®º' },
                    // åå½ˆæ®µ
                    { x1: 8, x2: 9, y1: v.neckline, y2: reboundPeak, color: '#e74c3c' },
                    { x1: 9, x2: 10, y1: reboundPeak, y2: v.neckline, color: '#2ecc71' },
                    // å´©è·Œæ®µ
                    { x1: 10, x2: 11, y1: v.neckline, y2: v.neckline, color: '#2ecc71' }, // çŸ­æš«åœç•™
                    { x1: 11, x2: 14, y1: v.neckline, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'å´©è·Œ' }
                ],
            };
        }
    },
	ascWedge: {
        name: "8. ä¸Šå‡æ¥”å‹ (Ascending Wedge) - çª’æ¯é‡ç¸®æ®º",
        type: "bear", // ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "breakout", label: "è·Œç ´é» (æ”¯æ’ç·š)", default: 45 },
            { id: "high", label: "æ¥”å‹å°–ç«¯é«˜é»", default: 55 },
            { id: "width", label: "é–‹å£é«˜åº¦ (H)", default: 15 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>é«˜é»èˆ‡ä½é»åŒæ™‚å¢Šé«˜ï¼Œä½†ã€Œä¸‹æ–¹æ”¯æ’ç·š(é™¡)ã€æ¯”ã€Œä¸Šæ–¹å£“åŠ›ç·š(ç·©)ã€ä¸Šå‡å¾—æ›´å¿«ï¼Œå°è‡´å‹æ…‹å‘å³ä¸Šæ–¹æ”¶æ–‚ã€‚é€™ä»£è¡¨å¤šé ­é›–åœ¨å‰µé«˜ï¼Œä½†è²·ç›¤å‹•èƒ½é€æ¼¸æ¯ç«­ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>åœ–ä¸­ç´…è‰²è™›ç·šç®­é ­é¡¯ç¤ºï¼Œè·Œç ´ä¸Šå‡æ”¯æ’ç·šå¾Œï¼Œå¸¸æœ‰<strong>ã€Œåå½ˆå›æ¸¬ã€</strong>å‹•ä½œ(Kiss Goodbye)ã€‚ç¢ºèªå£“åŠ›ä¸éå¾Œï¼Œéš¨å³å±•é–‹ä¸»è·Œæ®µã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ã€‘</strong><br>
            1. è³£é»ï¼šè·Œç ´ä¸‹æ–¹æ”¯æ’ç·šæ™‚(è—é»)ã€‚<br>
            2. æ¸¬å¹…ï¼šæ¡ã€Œå‚ç›´ç­‰å¹…ã€æ¸¬é‡(è—è‰²è™›ç·š)ã€‚ç›®æ¨™åƒ¹ = è·Œç ´é» - æ¥”å‹æœ€å¯¬è™•é«˜åº¦ã€‚
        `,
        calc: (v) => {
            // ç©ºæ–¹ç›®æ¨™ = è·Œç ´é» - é«˜åº¦
            const target = v.breakout - v.width;
            
            // ==========================================
            // ğŸ“ é›™è»Œå¹¾ä½•é‹ç®— (Rising Wedge)
            // ==========================================
            
            // å®šç¾©æ™‚é–“è»¸
            // T0:èµ·æ¼² | T1:é«˜ | T2:ä½ | T3:å°–ç«¯é«˜ | T4:è·Œç ´ | T5:æ€¥æ®º | T6:å›æ¸¬
            const t0 = 0;
            const t3 = 3;
            const t4 = 4;

            // 1. å»ºç«‹ã€ä¸‹æ–¹æ”¯æ’ç·šã€‘æ–¹ç¨‹å¼ (é™¡å‡)
            // é€™æ¢ç·šæ˜¯é—œéµï¼Œé€šé T4 (Breakout)
            const p4 = v.breakout;
            // è¨­å®š T0 (èµ·æ¼²é») çš„é«˜åº¦ = è·Œç ´é» - é–‹å£å¯¬åº¦ (å› ç‚ºæ˜¯ä¸Šå‡ï¼Œèµ·é»è¼ƒä½)
            const p0 = v.breakout - v.width;
            
            // è¨ˆç®—æ–œç‡ m_supp (è¼ƒé™¡çš„æ­£æ–œç‡)
            const m_supp = (p4 - p0) / (t4 - t0);
            const getSupportLine = (t) => p0 + m_supp * (t - t0);

            // 2. å»ºç«‹ã€ä¸Šæ–¹å£“åŠ›ç·šã€‘æ–¹ç¨‹å¼ (ç·©å‡)
            // é€šé T3 (High - å°–ç«¯)
            const p3 = v.high;
            
            // ç‚ºäº†æ”¶æ–‚ï¼Œå£“åŠ›ç·šæ–œç‡å¿…é ˆæ¯”æ”¯æ’ç·šã€Œå¹³ç·©ã€
            // è¨­å®š m_res ç‚º m_supp çš„ 40%
            const m_res = m_supp * 0.4; 
            
            // åæ¨å£“åŠ›ç·šæˆªè·: y = mx + c => c = y - mx
            const c_res = p3 - (m_res * t3);
            const getResistLine = (t) => (m_res * t) + c_res;

            // 3. è¨ˆç®—é—œéµé»ä½
            // T1 (å‰é«˜): å¿…é ˆåœ¨å£“åŠ›ç·šä¸Š
            const p1 = getResistLine(1);
            // T2 (å‰ä½): å¿…é ˆåœ¨æ”¯æ’ç·šä¸Š
            const p2 = getSupportLine(2);
            // T6 (å›æ¸¬é»): å›åˆ°è·Œç ´é»é™„è¿‘ (ç¢ºèªæ”¯æ’è½‰å£“åŠ›)
            const p6 = v.breakout;

            return {
                entry: v.breakout,
                target: target,
                stop: v.high,
                
                // èµ°å‹¢å„ªåŒ–ï¼šé‹¸é½’ç‹€ä¸Šå‡å¾Œè·Œç ´
                // T0: èµ·æ¼²ä½é»
                // T1: å‰é«˜ (â˜…å°é½Šå£“åŠ›)
                // T2: å‰ä½ (â˜…å°é½Šæ”¯æ’)
                // T3: å°–ç«¯é«˜ (â˜…å°é½Šå£“åŠ›)
                // T4: è·Œç ´ (â˜…å°é½Šæ”¯æ’ - è—é»)
                // T5: æ€¥æ®º
                // T6: å›æ¸¬ (æ¨¡æ“¬ç´…è‰²è™›ç·šç®­é ­)
                // T7: é”æ¨™
                points: [
                    p0,                     // T0
                    p1,                     // T1
                    p2,                     // T2
                    p3,                     // T3
                    p4,                     // T4
                    p4 - v.width * 0.25,    // T5
                    p6,                     // T6 (å›æ¸¬)
                    target                  // T7
                ],
                
                trendlines: [
                    // A. ä¸‹æ–¹æ”¯æ’ç·š (é™¡) - é€£æ¥ T0 -> T4
                    { 
                        x1: 0, x2: 4.5, 
                        y1: p0, y2: getSupportLine(4.5), 
                        color: '#2ecc71', 
                        label: 'ä¸Šå‡æ”¯æ’ (é™¡)' 
                    },
                    
                    // B. ä¸Šæ–¹å£“åŠ›ç·š (ç·©) - é€£æ¥ T1 -> T3 -> å»¶ä¼¸é¡¯ç¤ºæ”¶æ–‚
                    { 
                        x1: 0.5, x2: 6, 
                        y1: getResistLine(0.5), y2: getResistLine(6), 
                        color: '#2ecc71', 
                        label: 'æ”¶æ–‚å£“åŠ› (ç·©)' 
                    },

                    // C. ç›®æ¨™åƒ¹ç·š
                    { x1: 6, x2: 7.5, y1: target, y2: target, color: '#2ecc71', label: 'ç›®æ¨™åƒ¹' },

                    // D. æ¸¬å¹…è™›ç·š (å·¦å´é–‹å£ H)
                    // æ¸¬é‡ T0 åˆ° å°æ‡‰ä¸Šæ–¹çš„è·é›¢
                    { x1: 0.2, x2: 0.2, y1: p0, y2: getResistLine(0), color: '#3498db', dashed: true, label: 'é«˜åº¦H' },
                    
                    // E. æ¸¬å¹…è™›ç·š (å³å´æŠ•å°„)
                    { x1: 7, x2: 7, y1: p4, y2: target, color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
                ],
                
                // è—è‰²è·Œç ´é»
                extraMarkers: [
                    {
                        type: 'point',
                        xValue: 4, // T4
                        yValue: p4,
                        backgroundColor: '#3498db',
                        radius: 6,
                        borderColor: 'white',
                        borderWidth: 2
                    }
                ]
            };
        }
    },
	broadeningTop: {
		name: "9. ä¸Šå‡æ“´å¼µå–‡å­é ‚ (Broadening Wedge) - å¤±æ§å¯¬å¹…æ®º",
		type: "bear",
		inputs: [
			{ id: "startPrice", label: "èµ·å§‹åƒ¹æ ¼", default: 40 },
			{ id: "spread", label: "æ“´å¼µåŠ›é“", default: 2.2 },
			{ id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 12 } // é–å®šç‚º12å€‹ç¯€é»
		],
		note: `
				<strong style="color: #e74c3c;">ã€å½¢æ…‹è­˜åˆ¥ã€‘</strong>é«˜é»æ›´é«˜(HH)ã€ä½é»æ›´é«˜(HL)ï¼Œä½†æ³¢å¹…æ”¾å¤§ï¼ˆå–‡å­ç‹€ï¼‰ã€‚é€™æ˜¯å¸‚å ´æƒ…ç·’å¤±æ§çš„è¡¨ç¾ã€‚<br>
				<strong style="color: #3498db;">ã€é—œéµè¨Šè™Ÿã€‘</strong>T8 è·Œç ´ä¸Šå‡è¶¨å‹¢ç·šï¼ŒT9 åå½ˆä¸éé«˜(é€ƒå‘½æ³¢)ç¢ºèªè½‰ç©ºã€‚<br>
				<strong>ã€æ“ä½œç­–ç•¥ã€‘</strong>è·Œç ´ T8 é€²å ´ï¼Œæˆ– T9 åå½ˆä¸éæ™‚åŠ ç¢¼ã€‚ç›®æ¨™åƒ¹ç‚ºã€Œè·Œç ´é» - å–‡å­å£é«˜åº¦(H)ã€ã€‚
			`,
		calc: (v) => {
			// ==========================================
			// ğŸ“ å¹¾ä½•å®šç¾©
			// ==========================================
			const p_start = v.startPrice;
			const s = v.spread;
			
			// ä¸Šè»Œé™¡(2.0)ï¼Œä¸‹è»Œç·©(0.7)ä½†å‘ä¸Š
			const getTop = (x) => p_start + (x * 1.8) + (x * 0.4 * s);
			const getBot = (x) => p_start + (x * 0.7) - (x * 0.2 * s);

			let cp = [];

			// --- éšæ®µä¸€ï¼šæ“´å¼µéœ‡ç›ª (T0-T5) ---
			cp[0] = p_start;
			cp[1] = getTop(1);
			cp[2] = getBot(2);
			cp[3] = getTop(3);
			cp[4] = getBot(4);
			cp[5] = getTop(5); // Peak (æœ€é«˜é»)

			// --- éšæ®µäºŒï¼šèª˜å¤šèˆ‡å¼±å‹¢åå½ˆ (T6-T7) ---
			
			// T6: è²¼é½Šä¸Šå‡è¶¨å‹¢ç·šä¸‹ç·£ (æ”¯æ’ä¼¼ä¹æœ‰æ•ˆ)
			cp[6] = getBot(6);

			// T7: åå½ˆä¸éå‰é«˜ 1/2
			// è¨ˆç®— T5 åˆ° T6 çš„è·Œå¹…
			const drop_wave = cp[5] - cp[6];
			// åå½ˆä¿‚æ•¸è¨­ç‚º 0.4 (å³ 40%ï¼Œç¬¦åˆ < 1/2 çš„æ¢ä»¶)
			cp[7] = cp[6] + (drop_wave * 0.4);

			// --- éšæ®µä¸‰ï¼šè·Œç ´èˆ‡å›æ¸¬ (T8-T9) ---

			// è¨ˆç®—æ¸¬å¹…ç›®æ¨™ (ä»¥ T5 é«˜åº¦è¨ˆç®—)
			const height_H = cp[5] - getBot(5);
			
			// T8: è·Œç ´ä¸Šå‡è¶¨å‹¢ç·š (æ±ºç­–é»)
			// åƒ¹æ ¼éœ€é¡¯è‘—ä½æ–¼ä¸‹è»Œ
			const t8_trend_price = getBot(8);
			cp[8] = t8_trend_price - (height_H * 0.25); 

			// T9: å›æ¸¬ä¸Šå‡è¶¨å‹¢ç·šä¸‹ç·£ (Kiss of Death)
			// åƒ¹æ ¼å›åˆ°å»¶ä¼¸è¶¨å‹¢ç·šé™„è¿‘ï¼Œä½†ç•¥ä½ä¸€é»é»
			const t9_trend_price = getBot(9);
			cp[9] = t9_trend_price - (height_H * 0.05);

			// --- éšæ®µå››ï¼šNå­—ä¸‹è·Œè‡³ç›®æ¨™ (T10-T11) ---
			
			// è¨­å®šæœ€çµ‚ç›®æ¨™åƒ¹ (è·Œç ´é» T8 - H)
			// ç‚ºäº†è¦–è¦ºå¹³è¡¡ï¼Œæˆ‘å€‘ç¨å¾®èª¿æ•´ç›®æ¨™åƒ¹è¨ˆç®—åŸºæº–
			let targetPrice = t8_trend_price - height_H;
			if (targetPrice < 2) targetPrice = 2;

			// T10: Nå­—ä¸‹è·Œçš„ä¸­ç¹¼ä½é» (åŠ é€Ÿè¶•åº•)
			cp[10] = cp[8] - (height_H * 0.4);

			// T11: æŠµé”ç›®æ¨™åƒ¹
			cp[11] = targetPrice;

			return {
				entry: cp[8], // T8 ç‚ºåšç©ºé»
				target: targetPrice,
				stop: cp[7],  // åœæè¨­åœ¨ T7 é«˜é»
				
				points: cp,

				trendlines: [
					// 1. ä¸Šå‡æ“´å¼µè¶¨å‹¢ç·š (ç¶ è‰²å¯¦ç·šåªç•«åˆ° T6/T7 é™„è¿‘)
					{ x1: 1, x2: 5.5, y1: cp[1], y2: getTop(5.5), color: '#2ecc71', width: 2 },
					{ x1: 0, x2: 6.5, y1: cp[0], y2: getBot(6.5), color: '#2ecc71', width: 2, label: 'ä¸Šå‡è¶¨å‹¢ç·š' },
					
					// 2. è¶¨å‹¢ç·šå»¶ä¼¸ (è™›ç·šï¼Œè®Šæˆå£“åŠ›)
					{ x1: 6.5, x2: 10, y1: getBot(6.5), y2: getBot(10), color: '#e74c3c', dashed: true, label: 'å£“åŠ›' },

					// 3. T7 åå½ˆå¹…åº¦ç¤ºæ„ (ç´°ç°ç·š)
					{ x1: 6, x2: 7, y1: cp[6] + (drop_wave * 0.5), y2: cp[6] + (drop_wave * 0.5), color: '#95a5a6', dashed: true, width: 1, label: '50%' },

					// 4. ç›®æ¨™åƒ¹æŠ•å°„
					{ x1: 8, x2: 8, y1: t8_trend_price, y2: targetPrice, color: '#3498db', dashed: true, arrow: 'end', label: 'H' },
					{ x1: 8, x2: 11, y1: targetPrice, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'Target' },

					// 5. èµ°å‹¢é€£ç·š
					{ x1: 0, x2: 1, y1: cp[0], y2: cp[1], color: '#e74c3c' },
					{ x1: 1, x2: 2, y1: cp[1], y2: cp[2], color: '#e74c3c' },
					{ x1: 2, x2: 3, y1: cp[2], y2: cp[3], color: '#e74c3c' },
					{ x1: 3, x2: 4, y1: cp[3], y2: cp[4], color: '#e74c3c' },
					{ x1: 4, x2: 5, y1: cp[4], y2: cp[5], color: '#e74c3c' }, 
					{ x1: 5, x2: 6, y1: cp[5], y2: cp[6], color: '#e74c3c' }, // å›æª”è²¼ç·š
					{ x1: 6, x2: 7, y1: cp[6], y2: cp[7], color: '#e74c3c', width: 2 }, // å¼±å½ˆ
					{ x1: 7, x2: 8, y1: cp[7], y2: cp[8], color: '#e74c3c', width: 3 }, // â˜… T8 å¯¦é«”é»‘Kè·Œç ´
					{ x1: 8, x2: 9, y1: cp[8], y2: cp[9], color: '#e74c3c', dashed: true }, // T9 å›æ¸¬
					{ x1: 9, x2: 10, y1: cp[9], y2: cp[10], color: '#e74c3c' }, // T10 Nå­—æ®º
					{ x1: 10, x2: 11, y1: cp[10], y2: cp[11], color: '#e74c3c', arrow: 'end' },
					
					// 6. æ¸¬å¹…è™›ç·š (H)
                    { x1: 5, x2: 5, y1: cp[5], y2: getBot(5), color: '#3498db', dashed: true, label: 'ç­‰å¹…H' }
				],

				extraMarkers: [
					{
						type: 'point',
						xValue: 6,
						yValue: cp[6],
						backgroundColor: '#f1c40f', // é»ƒç‡ˆè­¦ç¤º
						radius: 4,
						label: 'æ”¯æ’?'
					},
					{
						type: 'point',
						xValue: 7,
						yValue: cp[7],
						backgroundColor: '#95a5a6',
						radius: 4,
						label: '<50%'
					},
					{
						type: 'point',
						xValue: 8,
						yValue: cp[8],
						backgroundColor: '#e74c3c', // ç´…ç‡ˆåšç©º
						borderColor: 'white',
						borderWidth: 2,
						radius: 6,
						label: 'æ±ºç­–é»'
					},
					{
						type: 'point',
						xValue: 9,
						yValue: cp[9],
						backgroundColor: '#3498db', 
						radius: 4,
						label: 'å›æ¸¬'
					}
				]
			};
		}
	},
	diamondTop: {
        name: "10. å‰æ¼²è±å‹ (Diamond Top) - æ“´å¼µæ”¶æ–‚æ®º",
        type: "bear", // ç©ºæ–¹å‹æ…‹
        inputs: [
            { id: "centerPrice", label: "ä¸­å¿ƒåƒ¹æ ¼", default: 50 },
            { id: "diamondHeight", label: "è±å‹é«˜åº¦ (H)", default: 30 },
            { id: "duration", label: "é¡¯ç¤ºé€±æœŸ", default: 20 }
        ],
        note: `
            <strong style="color: #e74c3c;">ã€åœ–è§£ç‰¹å¾µã€‘</strong>çµåˆäº†ã€Œæ“´å¼µå–‡å­ã€èˆ‡ã€Œå°ç¨±ä¸‰è§’ã€çš„ç½•è¦‹å‹æ…‹ã€‚è‚¡åƒ¹å…ˆæ˜¯åŠ‡çƒˆéœ‡ç›ª(æ“´å¼µ)ï¼Œéš¨å¾Œæ³¢å‹•æ”¶çª„(æ”¶æ–‚)ï¼Œå½¢æˆç‹€ä¼¼é‘½çŸ³çš„é ‚éƒ¨ã€‚<br>
            <strong style="color: #9b59b6;">ã€é—œéµç´°ç¯€ã€‘</strong>T6 ç‚º<strong>ã€Œè·Œç ´å³ä¸‹æ”¯æ’ã€</strong>çš„é—œéµé»(è—é»)ã€‚åœ–ä¸­ç´…è‰²è™›ç·šé¡¯ç¤ºè·Œç ´å¾Œå¸¸æœ‰å›æ¸¬å‹•ä½œã€‚æ­¤å‹æ…‹ä¸€æ—¦ç¢ºèªï¼Œä¸‹è·Œç›®æ¨™é€šå¸¸éå¸¸æ˜ç¢ºä¸”æ·±é ã€‚<br>
            <strong>ã€æ“ä½œæˆ°ç•¥ (ç©ºæ–¹)ã€‘</strong><br>
        1. <strong>é€²å ´</strong>ï¼šT6 å¯¦è³ªè·Œç ´å³ä¸‹ä¸Šå‡è¶¨å‹¢ç·šæ™‚ã€‚<br>
        2. <strong>é˜²å®ˆ</strong>ï¼šT5 (å³è‚©é«˜é») æˆ– T3 (æœ€é«˜é»)ã€‚<br>
        3. <strong>ç›®æ¨™</strong>ï¼šè·Œç ´åƒ¹ - H (è±å‹æœ€å¯¬è™•çš„å‚ç›´é«˜åº¦)ã€‚
        `,
        calc: (v) => {
			const halfH = v.diamondHeight / 2;
			const p_center = v.centerPrice;
			
			// --- 1. åƒ¹æ ¼å®šç¾© ---
			const p_top = p_center + halfH;          // T3: é ‚
			const p_bottom = p_center - halfH;       // T4: åº•
			const p_t1 = p_center + halfH * 0.6;     // T1: å·¦è‚©é«˜
			const p_t2 = p_center - halfH * 0.6;     // T2: å·¦è‚©ä½
			const p_t5 = p_center + halfH * 0.5;     // T5: å³è‚©é«˜
			
			// è·Œç ´é» (T6): åœ¨å³ä¸‹æ”¯æ’ç·šä¸‹æ–¹ä¸€é»é»
			const p_break = p_bottom + (halfH * 0.25); 
			
			// å›æ¸¬é» (T7): åå½ˆæ¸¬è©¦é ¸ç·š
			const p_pullback = p_break + (halfH * 0.15);

			// ç›®æ¨™åƒ¹
			let targetPrice = p_break - v.diamondHeight;
			if (targetPrice < 2) targetPrice = 2;

			// --- 2. ç¯€é»ç”Ÿæˆ (å…± 12 é»: T0 ~ T11) ---
			let cp = []; // chartPoints ç°¡å¯«
			
			cp[0] = p_center - halfH * 0.8; // èµ·æ¼²
			cp[1] = p_t1;                   // æ“´å¼µä¸Š
			cp[2] = p_t2;                   // æ“´å¼µä¸‹
			cp[3] = p_top;                  // é‘½çŸ³é ‚
			cp[4] = p_bottom;               // é‘½çŸ³åº•
			cp[5] = p_t5;                   // æ”¶æ–‚ä¸Š
			cp[6] = p_break;                // â˜… è·Œç ´
			cp[7] = p_pullback;             // å›æ¸¬
			
			// T8 ~ T11: æ®ºç›¤éšæ®µ (åˆ†4æ®µè·Œåˆ°ç›®æ¨™)
			// ä½¿ç”¨ç·©è¡å‡½å¼è®“ä¸‹è·Œçœ‹èµ·ä¾†æœ‰åŠ é€Ÿæ„Ÿ
			const dropStart = cp[7];
			const totalDrop = dropStart - targetPrice;
			
			cp[8]  = dropStart - totalDrop * 0.3; // æ®º
			cp[9]  = dropStart - totalDrop * 0.6; // æ®º
			cp[10] = dropStart - totalDrop * 0.85; // æ®º
			cp[11] = targetPrice;                 // æŠµé”ç›®æ¨™

			return {
				entry: p_break,
				target: targetPrice,
				stop: p_t5,
				
				points: cp,
				
				trendlines: [
					// --- å¹¾ä½•é‚Šç•Œ (è—è‰²è™›ç·š) ---
					{ x1: 1, x2: 3, y1: cp[1], y2: cp[3], color: '#3498db', dashed: true }, // å·¦ä¸Š
					{ x1: 2, x2: 4, y1: cp[2], y2: cp[4], color: '#3498db', dashed: true }, // å·¦ä¸‹
					{ x1: 3, x2: 5, y1: cp[3], y2: cp[5], color: '#3498db', dashed: true }, // å³ä¸Š
					
					// â˜… é—œéµé ¸ç·š (T4 -> T6 å»¶ä¼¸)
					{ x1: 4, x2: 7, y1: cp[4], y2: p_break + (p_break - cp[4])*0.5, color: '#e67e22', width: 2, label: 'é ¸ç·š' },

					// --- æ¸¬é‡ç·š ---
					{ x1: 3.5, x2: 3.5, y1: cp[4], y2: cp[3], color: '#95a5a6', dashed: true, label: 'H' },
					{ x1: 6, x2: 11, y1: targetPrice, y2: targetPrice, color: '#2ecc71', dashed: true, label: 'Target' },

					// --- èµ°å‹¢é€£ç·š (Zigzag) ---
					{ x1: 0, x2: 1, y1: cp[0], y2: cp[1], color: '#e74c3c' },
					{ x1: 1, x2: 2, y1: cp[1], y2: cp[2], color: '#2ecc71' },
					{ x1: 2, x2: 3, y1: cp[2], y2: cp[3], color: '#e74c3c' },
					{ x1: 3, x2: 4, y1: cp[3], y2: cp[4], color: '#2ecc71' },
					{ x1: 4, x2: 5, y1: cp[4], y2: cp[5], color: '#e74c3c' },
					{ x1: 5, x2: 6, y1: cp[5], y2: cp[6], color: '#2ecc71', width: 2 }, // è·Œç ´
					{ x1: 6, x2: 7, y1: cp[6], y2: cp[7], color: '#e74c3c', dashed: true }, // å›æ¸¬
					{ x1: 7, x2: 11, y1: cp[7], y2: cp[11], color: '#27ae60', width: 2 },    // ä¸»è·Œ
					
					// æ¸¬å¹…è™›ç·š (H)
					{ x1: 6, x2: 6, y1: p_break, y2: targetPrice, color: '#3498db', dashed: true, label: 'é«˜åº¦H' }
				],
				
				extraMarkers: [
					{
						type: 'point',
						xValue: 6,
						yValue: cp[6],
						backgroundColor: '#e74c3c',
						radius: 5,
						label: 'Break'
					}
				]
			};
		}
    },
};

// ==========================================
// 3. æ ¸å¿ƒé‚è¼¯ (Logic)
// ==========================================
let myChart = null;

document.addEventListener('DOMContentLoaded', () => {
    updatePatternList(); // åˆå§‹åŒ–ï¼šæ ¹æ“šé è¨­åˆ†é¡è¼‰å…¥å‹æ…‹åˆ—è¡¨
});

// é€£å‹•é¸å–®é‚è¼¯ï¼šç•¶åˆ†é¡æ”¹è®Šæ™‚ï¼Œæ›´æ–°å‹æ…‹åˆ—è¡¨
function updatePatternList() {
    const category = document.getElementById('categorySelect').value;
    const patternSelect = document.getElementById('patternSelect');
    
    // æ¸…ç©ºç¾æœ‰é¸é …
    patternSelect.innerHTML = '';
    
    // æ ¹æ“šåˆ†é¡ç´¢å¼•å¡«å……æ–°é¸é …
    const patterns = categoryIndex[category];
    patterns.forEach(key => {
        const option = document.createElement('option');
        option.value = key;
        option.text = patternsDB[key].name;
        patternSelect.appendChild(option);
    });
    
    // è¼‰å…¥ç¬¬ä¸€å€‹å‹æ…‹çš„é…ç½®
    loadPatternConfig();
}

function loadPatternConfig() {
    const patternId = document.getElementById('patternSelect').value;
    const pattern = patternsDB[patternId];
    
    if (!pattern) return;

    document.getElementById('patternTitle').innerText = pattern.name;
    document.getElementById('patternNote').innerHTML = pattern.note;
    
    const badge = document.getElementById('patternBadge');
    badge.innerText = pattern.type === 'bull' ? 'çœ‹æ¼² (Bullish)' : (pattern.type === 'bear' ? 'çœ‹è·Œ (Bearish)' : 'ä¸­æ€§ (Neutral)');
    badge.className = `badge ${pattern.type}`;

    const inputsDiv = document.getElementById('dynamicInputs');
    inputsDiv.innerHTML = '';
    
    pattern.inputs.forEach(input => {
        const div = document.createElement('div');
        div.className = 'input-group';
        div.innerHTML = `
            <label>${input.label}</label>
            <input type="number" id="input_${input.id}" value="${input.default}" step="0.5">
        `;
        inputsDiv.appendChild(div);
    });

    calculateAndDraw();
}

// å‡è¨­ä½ åŸæœ¬çš„é‚è¼¯ä¸­ category æ˜¯ç›®å‰çš„å‹æ…‹åˆ†é¡ ('bullish', 'bearish', 'neutral')
function updateOlafQuote(category) {
    const quotes = olafQuotes[category] || olafQuotes['neutral'];
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    
    const textElement = document.getElementById('olaf-text');
    if (textElement) {
        textElement.innerText = randomQuote;
    }
}

function calculateAndDraw() {
    const patternId = document.getElementById('patternSelect').value;
    const pattern = patternsDB[patternId];
    const values = {};
    
    pattern.inputs.forEach(input => {
        values[input.id] = parseFloat(document.getElementById(`input_${input.id}`).value);
    });

    const result = pattern.calc(values);

    document.getElementById('entryDisplay').innerText = `$${result.entry.toFixed(2)}`;
    document.getElementById('targetDisplay').innerText = `$${result.target.toFixed(2)}`;
    document.getElementById('stopDisplay').innerText = `$${result.stop.toFixed(2)}`;
    
    let dirText = "";
    if (pattern.type === 'bull') dirText = "åšå¤š (Long)";
    else if (pattern.type === 'bear') dirText = "åšç©º (Short)";
    else dirText = "é †å‹¢æ“ä½œ (Follow Trend)";
    
    document.getElementById('directionDisplay').innerText = dirText;

    renderChart(result, pattern.type);
	
	// å‘¼å«é›ªå¯¶èªéŒ„å‡½æ•¸
    // å‡è¨­ä½ ç”¨ä¾†å­˜æ”¾ç›®å‰åˆ†é¡çš„è®Šæ•¸åç¨±æ˜¯ currentCategory
    // å¦‚æœä½ çš„è®Šæ•¸åç¨±ä¸åŒï¼Œè«‹æ›¿æ›å®ƒï¼ˆä¾‹å¦‚ï¼šdocument.getElementById('categorySelect').valueï¼‰
    const selectedCategory = document.getElementById('categorySelect').value;
    updateOlafQuote(selectedCategory);
}

function renderChart(result, type) {
    const ctx = document.getElementById('tradeChart').getContext('2d');
    if (myChart) myChart.destroy();

    const isBull = type === 'bull';
    const mainColor = isBull ? '#27ae60' : (type === 'bear' ? '#c0392b' : '#f39c12');
    
    // ç”¢ç”Ÿ X è»¸æ¨™ç±¤
    const labels = result.points.map((_, i) => i === result.points.length - 2 ? 'Entry' : `T${i}`);
    
    const annotations = {
        targetLine: {
            type: 'line', yMin: result.target, yMax: result.target,
            borderColor: '#2980b9', borderWidth: 2, borderDash: [6, 4],
            label: { display: true, content: `Target: ${result.target.toFixed(2)}`, position: 'end', backgroundColor: '#2980b9' }
        },
        stopLine: {
            type: 'line', yMin: result.stop, yMax: result.stop,
            borderColor: '#e74c3c', borderWidth: 1, borderDash: [4, 4],
            label: { display: true, content: `Stop: ${result.stop.toFixed(2)}`, position: 'start', backgroundColor: '#e74c3c', font: {size: 10} }
        },
        entryMarker: {
            type: 'point', xValue: result.points.length - 2, yValue: result.entry,
            backgroundColor: mainColor, radius: 6, borderWidth: 2, borderColor: 'white'
        }
    };
	
	// === æ–°å¢åŠŸèƒ½ï¼šæ”¯æ´é¡å¤–çš„è‡ªå®šç¾©æ¨™è¨˜ (Extra Markers) ===
    if (result.extraMarkers) {
        result.extraMarkers.forEach((marker, index) => {
            annotations[`extraMarker${index}`] = marker;
        });
    }

    if (result.trendlines) {
        result.trendlines.forEach((line, index) => {
            annotations[`trendline${index}`] = {
                type: 'line',
                xMin: line.x1, xMax: line.x2,
                yMin: line.y1, yMax: line.y2,
                borderColor: line.color, borderWidth: 2,
                borderDash: line.dashed ? [5, 5] : [],
                label: { display: false }
            };
        });
    }

    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'æ¨¡æ“¬èµ°å‹¢',
                data: result.points,
                borderColor: '#34495e',
                backgroundColor: 'rgba(52, 73, 94, 0.05)',
                borderWidth: 2.5,
                tension: 0.2,
                fill: true,
                pointRadius: 3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                annotation: { annotations: annotations },
                tooltip: { callbacks: { label: (ctx) => `åƒ¹æ ¼: ${ctx.raw.toFixed(2)}` } }
            },
            scales: { y: { grace: '20%' }, x: { display: false } }
        }
    });
}