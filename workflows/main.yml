name: æ¯æ—¥å°è‚¡ç›¤å¾Œè³‡æ–™æ›´æ–°

# è¨­å®šè§¸ç™¼æ¢ä»¶
on:
  schedule:
    # é€™æ˜¯ cron èªæ³•ï¼Œä»£è¡¨ã€ŒUTC æ™‚é–“æ¯å¤© 00:00 åŸ·è¡Œã€
    # æ³¨æ„: GitHub Actions ä½¿ç”¨ UTC æ™‚é–“ï¼Œå°ç£æ™‚é–“éœ€ +8 å°æ™‚
	# èªªæ˜:
    # åˆ†é˜: 0
    # å°æ™‚: 6 (UTC æ™‚é–“ï¼Œå°æ‡‰å°ç£æ™‚é–“ 14:00)
    # æ—¥æœŸ: * (ä¸é™)
    # æœˆä»½: * (ä¸é™)
    # æ˜ŸæœŸ: 1-5 (ä»£è¡¨é€±ä¸€åˆ°é€±äº”)
    - cron: '0 6 * * 1-5'
  # å…è¨±æ‰‹å‹•å¾ Actions é é¢è§¸ç™¼ï¼ˆæ–¹ä¾¿æ¸¬è©¦ç”¨ï¼‰
  workflow_dispatch:
  
# âš ï¸ é‡è¦ï¼šè¨­å®šæ¬Šé™ï¼Œå…è¨± Actions å¯«å…¥ Repo
permissions:
  contents: write

jobs:
  update-data:
    runs-on: ubuntu-latest

    steps:
      # 1. ä¸‹è¼‰ä½ çš„ç¨‹å¼ç¢¼åˆ°è™›æ“¬ç’°å¢ƒ
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. è¨­å®š Python ç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9' # ä¾æ“šä½ çš„éœ€æ±‚ä¿®æ”¹ç‰ˆæœ¬
          cache: 'pip' # å•Ÿç”¨å¿«å–ä»¥åŠ é€Ÿå®‰è£

      # 3. å®‰è£ä¾è³´å¥—ä»¶ (å¦‚æœæœ‰ requirements.txt)
      - name: Install dependencies
        run: |
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # 4. åŸ·è¡Œä½ çš„ Python è…³æœ¬
      - name: Run script
        run: python fetch_txf_5m_daily.py
        env:
          # å¦‚æœè…³æœ¬éœ€è¦ API Key æˆ–å¯†ç¢¼ï¼Œè«‹å¾ Secrets è®€å–
          #MY_API_KEY: ${{ secrets.MY_API_KEY }}
          # å¦‚æœä½ çš„ç¨‹å¼ç¢¼ä¹‹å¾Œéœ€è¦å‚³é€ Line Notify æˆ– Telegram é€šçŸ¥
          # å¯ä»¥åœ¨é€™è£¡åŠ å…¥ Tokenï¼Œä¸¦åœ¨ GitHub Secrets è¨­å®š
          #TZ: 'Asia/Taipei' # è¨­å®šç³»çµ±æ™‚å€ç’°å¢ƒè®Šæ•¸ (é¸ç”¨)
      
      # 5. è¨­å®š Git ä½¿ç”¨è€…èº«ä»½ (é¡¯ç¤ºåœ¨ Commit ç´€éŒ„ä¸­)
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
      # 6. åŠ å…¥æª”æ¡ˆ
          git add data_txf_5m_daily/txf_5m_daily.csv
          
      # 7. æäº¤ (å¦‚æœæ²’æœ‰æ–°è³‡æ–™ï¼Œcommit æœƒå¤±æ•—ï¼Œæ‰€ä»¥åŠ ä¸Š || exit 0 å¿½ç•¥éŒ¯èª¤)
          git commit -m "ğŸ“ˆ Auto update TX data: $(date +'%Y-%m-%d')" || exit 0
          
      # 8. æ¨é€å› GitHub
          git push